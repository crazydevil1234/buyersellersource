"use strict";var fabric=fabric||{version:"1.6.7"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function n(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function t(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function e(t,e){if(this.__eventListeners){if(0===arguments.length)for(t in this.__eventListeners)n.call(this,t);else if(1===arguments.length&&"object"==typeof t)for(var i in t)n.call(this,i,t[i]);else n.call(this,t,e);return this}}function i(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:t,stopObserving:e,fire:i,on:t,off:e,trigger:i}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(e){return void 0===e?this._objects:this._objects.filter(function(t){return t.type===e})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return-1<this.getObjects().indexOf(t)},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(o){var d=Math.sqrt,p=Math.atan2,s=Math.pow,a=Math.abs,c=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*c},radiansToDegrees:function(t){return t/c},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e),r=Math.abs(i-n),o=[t[0].y,t[1].y,t[2].y,t[3].y],s=fabric.util.array.min(o),a=fabric.util.array.max(o);return{left:i,top:s,width:r,height:Math.abs(s-a)}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(t){if(!t)return fabric;var e,i=t.split("."),n=i.length,r=o||fabric.window;for(e=0;e<n;++e)r=r[i[e]];return r},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),r.src=t}else e&&e.call(i,t)},enlivenObjects:function(t,e,r,o){function s(){++i===n&&e&&e(a)}var a=[],i=0,n=(t=t||[]).length;n?t.forEach(function(i,n){if(i&&i.type){var t=fabric.util.getKlass(i.type,r);t.async?t.fromObject(i,function(t,e){e||(a[n]=t,o&&o(i,a[n])),s()}):(a[n]=t.fromObject(i),o&&o(i,a[n]),s())}else s()}):e&&e(a)},groupSVGElements:function(t,e,i){var n;return n=new fabric.PathGroup(t,e),void 0!==i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,e,i,n,r,o){var s=n-e,a=r-i,c=d(s*s+a*a),l=p(a,s),u=o.length,h=0,f=!0;for(t.save(),t.translate(e,i),t.moveTo(0,0),t.rotate(l),e=0;e<c;)c<(e+=o[h++%u])&&(e=c),t[f?"lineTo":"moveTo"](e,0),f=!f;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(t){var e,i,n,r,o,s=t.prototype;for(e=s.stateProperties.length;e--;)r="set"+(n=(i=s.stateProperties[e]).charAt(0).toUpperCase()+i.slice(1)),s[o="get"+n]||(s[o]=new Function('return this.get("'+i+'")')),s[r]||(s[r]=new Function("value",'return this.set("'+i+'", value)'))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=p(t[1],t[0]),i=s(t[0],2)+s(t[1],2),n=d(i),r=(t[0]*t[3]-t[2]*t[1])/n,o=p(t[0]*t[2]+t[1]*t[3],i);return{angle:e/c,scaleX:n,scaleY:r,skewX:o/c,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,a(Math.tan(i*c)),1],r=[a(t),0,0,a(e)];return fabric.util.multiplyTransformMatrices(r,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){0<n&&(n<e?e-=n:e=0,n<i?i-=n:i=0);var r,o=!0,s=t.getImageData(e,i,2*n||1,2*n||1),a=s.data.length;for(r=3;r<a&&!1!==(o=s.data[r]<=0);r+=4);return s=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}}}("undefined"!=typeof exports?exports:this),function(){var L={},C={},M={},R=Array.prototype.join;function v(t,e,i,n,r,o,s){var a=R.call(arguments);if(L[a])return L[a];var c=Math.PI,l=s*c/180,u=Math.sin(l),h=Math.cos(l),f=0,d=0,p=-h*t*.5-u*e*.5,g=-h*e*.5+u*t*.5,v=(i=Math.abs(i))*i,m=(n=Math.abs(n))*n,b=g*g,y=p*p,_=v*m-v*b-m*y,x=0;if(_<0){var C=Math.sqrt(1-_/(v*m));i*=C,n*=C}else x=(r===o?-1:1)*Math.sqrt(_/(v*b+m*y));var w=x*i*g/n,S=-x*n*p/i,k=h*w-u*S+.5*t,O=u*w+h*S+.5*e,E=F(1,0,(p-w)/i,(g-S)/n),T=F((p-w)/i,(g-S)/n,(-p-w)/i,(-g-S)/n);0===o&&0<T?T-=2*c:1===o&&T<0&&(T+=2*c);for(var j=Math.ceil(Math.abs(T/c*2)),M=[],P=T/j,A=8/3*Math.sin(P/4)*Math.sin(P/4)/Math.sin(P/2),I=E+P,D=0;D<j;D++)M[D]=B(E,I,h,u,i,n,k,O,A,f,d),f=M[D][4],d=M[D][5],E=I,I+=P;return L[a]=M}function B(t,e,i,n,r,o,s,a,c,l,u){var h=R.call(arguments);if(C[h])return C[h];var f=Math.cos(t),d=Math.sin(t),p=Math.cos(e),g=Math.sin(e),v=i*r*p-n*o*g+s,m=n*r*p+i*o*g+a,b=l+c*(-i*r*d-n*o*f),y=u+c*(-n*r*d+i*o*f),_=v+c*(i*r*g+n*o*p),x=m+c*(n*r*g-i*o*p);return C[h]=[b,y,_,x,v,m],C[h]}function F(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);return r<=o?o-r:2*Math.PI-(r-o)}function m(t,e,i,n,r,o,s,a){var c=R.call(arguments);if(M[c])return M[c];var l,u,h,f,d,p,g,v,m=Math.sqrt,b=Math.min,y=Math.max,_=Math.abs,x=[],C=[[],[]];u=6*t-12*i+6*r,l=-3*t+9*i-9*r+3*s,h=3*i-3*t;for(var w=0;w<2;++w)if(0<w&&(u=6*e-12*n+6*o,l=-3*e+9*n-9*o+3*a,h=3*n-3*e),_(l)<1e-12){if(_(u)<1e-12)continue;0<(f=-h/u)&&f<1&&x.push(f)}else(g=u*u-4*h*l)<0||(0<(d=(-u+(v=m(g)))/(2*l))&&d<1&&x.push(d),0<(p=(-u-v)/(2*l))&&p<1&&x.push(p));for(var S,k,O,E=x.length,T=E;E--;)S=(O=1-(f=x[E]))*O*O*t+3*O*O*f*i+3*O*f*f*r+f*f*f*s,C[0][E]=S,k=O*O*O*e+3*O*O*f*n+3*O*f*f*o+f*f*f*a,C[1][E]=k;C[0][T]=t,C[1][T]=e,C[0][T+1]=s,C[1][T+1]=a;var j=[{x:b.apply(null,C[0]),y:b.apply(null,C[1])},{x:y.apply(null,C[0]),y:y.apply(null,C[1])}];return M[c]=j}fabric.util.drawArc=function(t,e,i,n){for(var r=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=[[],[],[],[]],u=v(n[5]-e,n[6]-i,r,o,a,c,s),h=0,f=u.length;h<f;h++)l[h][0]=u[h][0]+e,l[h][1]=u[h][1]+i,l[h][2]=u[h][2]+e,l[h][3]=u[h][3]+i,l[h][4]=u[h][4]+e,l[h][5]=u[h][5]+i,t.bezierCurveTo.apply(t,l[h])},fabric.util.getBoundsOfArc=function(t,e,i,n,r,o,s,a,c){for(var l,u=0,h=0,f=[],d=v(a-t,c-e,i,n,o,s,r),p=0,g=d.length;p<g;p++)l=m(u,h,d[p][0],d[p][1],d[p][2],d[p][3],d[p][4],d[p][5]),f.push({x:l[0].x+t,y:l[0].y+e}),f.push({x:l[1].x+t,y:l[1].y+e}),u=d[p][4],h=d[p][5];return f},fabric.util.getBoundsOfCurve=m}(),function(){var s=Array.prototype.slice;function i(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0==i)return-1;var n=0;if(0<arguments.length&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(0<n||-1)*Math.floor(Math.abs(n)))),i<=n)return-1;for(var r=0<=n?n:Math.max(i-Math.abs(n),0);r<i;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;n<r;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;i<n;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,o=this.length>>>0;r<o;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(1<arguments.length)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(t,e){for(var i=s.call(arguments,2),n=[],r=0,o=t.length;r<o;r++)n[r]=i.length?t[r][e].apply(t[r],i):t[r][e].call(t[r]);return n},min:function(t,e){return i(t,e,function(t,e){return t<e})},max:function(t,e){return i(t,e,function(t,e){return e<=t})}}}(),function(){function i(t,e,i){if(i)if(!fabric.isLikelyNode&&e instanceof Element)t=e;else if(e instanceof Array)t=e.map(function(t){return r(t,i)});else if(e instanceof Object)for(var n in e)t[n]=r(e[n],i);else t=e;else for(var n in e)t[n]=e[n];return t}function r(t,e){return i({},t,e)}fabric.util.object={extend:i,clone:r}}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(){function r(){}var o=Array.prototype.slice,s=Function.prototype.apply;Function.prototype.bind||(Function.prototype.bind=function(t){var e,i=this,n=o.call(arguments,1);return e=n.length?function(){return s.call(i,this instanceof r?this:t,n.concat(o.call(arguments)))}:function(){return s.call(i,this instanceof r?this:t,arguments)},r.prototype=this.prototype,e.prototype=new r,e})}(),function(){function o(){}function s(t,n,r){for(var e in n)e in t.prototype&&"function"==typeof t.prototype[e]&&-1<(n[e]+"").indexOf("callSuper")?t.prototype[e]=function(i){return function(){var t=this.constructor.superclass;this.constructor.superclass=r;var e=n[i].apply(this,arguments);if(this.constructor.superclass=t,"initialize"!==i)return e}}(e):t.prototype[e]=n[e],i&&(n.toString!==Object.prototype.toString&&(t.prototype.toString=n.toString),n.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=n.valueOf))}var a=Array.prototype.slice,i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}();function c(){}function l(t){var e=this.constructor.superclass.prototype[t];return 1<arguments.length?e.apply(this,a.call(arguments,1)):e.call(this)}fabric.util.createClass=function(){var t=null,e=a.call(arguments,0);function i(){this.initialize.apply(this,arguments)}"function"==typeof e[0]&&(t=e.shift()),i.superclass=t,i.subclasses=[],t&&(c.prototype=t.prototype,i.prototype=new c,t.subclasses.push(i));for(var n=0,r=e.length;n<r;n++)s(i,e[n],t);return i.prototype.initialize||(i.prototype.initialize=o),(i.prototype.constructor=i).prototype.callSuper=l,i}}(),function(){var n="unknown";function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;i<r;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var r,o,e,i,a=(e=0,function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)});function s(t,e){return{handler:e,wrappedHandler:function(e,i){return function(t){i.call(r(e),t||fabric.window.event)}}(t,e)}}i={},r=function(t){return i[t]},o=function(t,e){i[t]=e};var c,l,u=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),h=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),f={},d={};l=u?(c=function(t,e,i){t.addEventListener(e,i,!1)},function(t,e,i){t.removeEventListener(e,i,!1)}):h?(c=function(t,e,i){var n=a(t);o(n,t),f[n]||(f[n]={}),f[n][e]||(f[n][e]=[]);var r=s(n,i);f[n][e].push(r),t.attachEvent("on"+e,r.wrappedHandler)},function(t,e,i){var n,r=a(t);if(f[r]&&f[r][e])for(var o=0,s=f[r][e].length;o<s;o++)(n=f[r][e][o])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),f[r][e][o]=null)}):(c=function(t,e,i){var n=a(t);if(d[n]||(d[n]={}),!d[n][e]){d[n][e]=[];var r=t["on"+e];r&&d[n][e].push(r),t["on"+e]=function(r,o){return function(t){if(d[r]&&d[r][o])for(var e=d[r][o],i=0,n=e.length;i<n;i++)e[i].call(this,t||fabric.window.event)}}(n,e)}d[n][e].push(i)},function(t,e,i){var n=a(t);if(d[n]&&d[n][e])for(var r=d[n][e],o=0,s=r.length;o<s;o++)r[o]===i&&r.splice(o,1)}),fabric.util.addListener=c,fabric.util.removeListener=l;var p=function(t){return typeof t.clientX!=n?t.clientX:0},g=function(t){return typeof t.clientY!=n?t.clientY:0};function v(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]&&t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]}fabric.isTouchSupported&&(p=function(t){return v(t,"pageX","clientX")},g=function(t){return v(t,"pageY","clientY")}),fabric.util.getPointer=function(t){t||(t=fabric.window.event);var e=t.target||(typeof t.srcElement!=n?t.srcElement:null),i=fabric.util.getScrollLeftTop(e);return{x:p(t)+i.left,y:g(t)+i.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=.9999<=e?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,-1<e.indexOf("opacity")?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e){if("opacity"===n)r(t,e[n]);else i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n]}return t}}(),function(){var e=Array.prototype.slice;var t,c,i,n,r=function(t){return e.call(t,0)};try{t=r(fabric.document.childNodes)instanceof Array}catch(t){}function o(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function l(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}t||(r=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),c=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},i=fabric.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)},fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=r,fabric.util.makeElement=o,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=o(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=l,fabric.util.getElementOffset=function(t){var e,i,n=t&&t.ownerDocument,r={left:0,top:0},o={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return o;for(var a in s)o[s[a]]+=parseInt(c(t,a),10)||0;return e=n.documentElement,void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect()),i=l(t),{left:r.left+i.left-(e.clientLeft||0)+o.left,top:r.top+i.top-(e.clientTop||0)+o.top}},fabric.util.getElementStyle=c}(),function(){var s=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function a(){}fabric.util.request=function(t,e){e||(e={});var i=e.method?e.method.toUpperCase():"GET",n=e.onComplete||function(){},r=s(),o=e.body||e.parameters;return r.onreadystatechange=function(){4===r.readyState&&(n(r),r.onreadystatechange=a)},"GET"===i&&(o=null,"string"==typeof e.parameters&&(t=function(t,e){return t+(/\?/.test(t)?"&":"?")+e}(t,e.parameters))),r.open(i,t,!0),"POST"!==i&&"PUT"!==i||r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(o),r}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function d(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(f){d(function(t){f||(f={});var n,r=t||+new Date,o=f.duration||500,s=r+o,a=f.onChange||function(){},c=f.abort||function(){return!1},l=f.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},u="startValue"in f?f.startValue:0,e="endValue"in f?f.endValue:100,h=f.byValue||e-u;f.onStart&&f.onStart(),function t(e){n=e||+new Date;var i=s<n?o:n-r;c()?f.onComplete&&f.onComplete():(a(l(i,u,h,o)),s<n?f.onComplete&&f.onComplete():d(t))}(r)})},fabric.util.requestAnimFrame=d}(),function(){function s(t,e,i,n){return n=t<Math.abs(e)?(t=e,i/4):0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function a(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function r(t,e,i,n){return i-o(n-t,0,i,n)+e}function o(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,i,n){var r=0;return 0===t?e:1===(t/=n)?e+i:(r||(r=.3*n),-a(s(i,i,r,1.70158),t,n)+e)},easeOutElastic:function(t,e,i,n){var r=0;if(0===t)return e;if(1===(t/=n))return e+i;r||(r=.3*n);var o=s(i,i,r,1.70158);return o.a*Math.pow(2,-10*t)*Math.sin((t*n-o.s)*(2*Math.PI)/o.p)+o.c+e},easeInOutElastic:function(t,e,i,n){var r=0;if(0===t)return e;if(2===(t/=n/2))return e+i;r||(r=n*(.3*1.5));var o=s(i,i,r,1.70158);return t<1?-.5*a(o,t,n)+e:o.a*Math.pow(2,-10*(t-=1))*Math.sin((t*n-o.s)*(2*Math.PI)/o.p)*.5+o.c+e},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:r,easeOutBounce:o,easeInOutBounce:function(t,e,i,n){return t<n/2?.5*r(2*t,0,i,n)+e:.5*o(2*t-n,0,i,n)+.5*i+e}}}(),function(t){var s,e,i,a,n,c,_=t.fabric||(t.fabric={}),l=_.util.object.extend,o=_.util.string.capitalize,h=_.util.object.clone,u=_.util.toFixed,x=_.util.parseUnit,f=_.util.multiplyTransformMatrices,d=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,C=/^(symbol|image|marker|pattern|view|svg)$/i,p=/^(?:pattern|defs|symbol|metadata)$/i,g=/^(symbol|g|a|svg)$/i,r={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},v={stroke:"strokeOpacity",fill:"fillOpacity"};function m(t){return t in r?r[t]:t}function b(t,e,i,n){var r,o="[object Array]"===Object.prototype.toString.call(e);return"fill"!==t&&"stroke"!==t||"none"!==e?"strokeDashArray"===t?e=e.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?e=i&&i.transformMatrix?f(i.transformMatrix,_.parseTransformAttribute(e)):_.parseTransformAttribute(e):"visible"===t?(e="none"!==e&&"hidden"!==e,i&&!1===i.visible&&(e=!1)):"originX"===t?e="start"===e?"left":"end"===e?"right":"center":r=o?e.map(x):x(e,n):e="",!o&&isNaN(r)?e:r}function y(t,e){for(var i,n,r=[],o=0;o<e.length;o++)i=e[o],n=t.getElementsByTagName(i),r=r.concat(Array.prototype.slice.call(n));return r}function w(t,e){var i,n=!0;return(i=S(t,e.pop()))&&e.length&&(n=function(t,e){var i,n=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=S(t,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function S(t,e){var i,n=t.nodeName,r=t.getAttribute("class"),o=t.getAttribute("id");if(i=new RegExp("^"+n,"i"),e=e.replace(i,""),o&&e.length&&(i=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),r&&e.length)for(var s=(r=r.split(" ")).length;s--;)i=new RegExp("\\."+r[s]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function k(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,o=t.getElementsByTagName("*");for(r=0;r<o.length;r++)if(e===(n=o[r]).getAttribute("id"))return n}_.cssRules={},_.gradientDefs={},_.parseTransformAttribute=(s=[1,0,0,1,0,0],e=_.reNum,a="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")"+(i="(?:\\s+,?\\s*|,\\s*)")+"("+e+")"+i+"("+e+")"+i+"("+e+")"+i+"("+e+")"+i+"("+e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:"+i+"("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:"+i+"("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:"+i+"("+e+")"+i+"("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",n=new RegExp("^\\s*(?:"+("(?:"+a+"(?:"+i+"*"+a+")*)")+"?)\\s*$"),c=new RegExp(a,"g"),function(t){var r=s.concat(),o=[];if(!t||t&&!n.test(t))return r;t.replace(c,function(t){var e=new RegExp(a).exec(t).filter(function(t){return!!t}),i=e[1],n=e.slice(2).map(parseFloat);switch(i){case"translate":!function(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}(r,n);break;case"rotate":n[0]=_.util.degreesToRadians(n[0]),function(t,e){var i=e[0],n=3===e.length?e[1]:0,r=3===e.length?e[2]:0;t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i),t[4]=n-(t[0]*n+t[2]*r),t[5]=r-(t[1]*n+t[3]*r)}(r,n);break;case"scale":!function(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}(r,n);break;case"skewX":!function(t,e){t[2]=Math.tan(_.util.degreesToRadians(e[0]))}(r,n);break;case"skewY":!function(t,e){t[1]=Math.tan(_.util.degreesToRadians(e[0]))}(r,n);break;case"matrix":r=n}o.push(r.concat()),r=s.concat()});for(var e=o[0];1<o.length;)o.shift(),e=_.util.multiplyTransformMatrices(e,o[0]);return e});var O=new RegExp("^\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*$");function E(t){var e,i,n,r,o,s,a=t.getAttribute("viewBox"),c=1,l=1,u=t.getAttribute("width"),h=t.getAttribute("height"),f=t.getAttribute("x")||0,d=t.getAttribute("y")||0,p=t.getAttribute("preserveAspectRatio")||"",g=!a||!C.test(t.nodeName)||!(a=a.match(O)),v=!u||!h||"100%"===u||"100%"===h,m=g&&v,b={},y="";if(b.width=0,b.height=0,b.toBeParsed=m)return b;if(g)return b.width=x(u),b.height=x(h),b;if(e=-parseFloat(a[1]),i=-parseFloat(a[2]),n=parseFloat(a[3]),r=parseFloat(a[4]),v?(b.width=n,b.height=r):(b.width=x(u),b.height=x(h),c=b.width/n,l=b.height/r),"none"!==(p=_.util.parsePreserveAspectRatioAttribute(p)).alignX&&(l=c=l<c?l:c),1===c&&1===l&&0==e&&0==i&&0===f&&0===d)return b;if((f||d)&&(y=" translate("+x(f)+" "+x(d)+") "),o=y+" matrix("+c+" 0 0 "+l+" "+e*c+" "+i*l+") ","svg"===t.nodeName){for(s=t.ownerDocument.createElement("g");t.firstChild;)s.appendChild(t.firstChild);t.appendChild(s)}else o=(s=t).getAttribute("transform")+o;return s.setAttribute("transform",o),b}_.parseSVGDocument=function(t,e,i){if(t){!function(t){for(var e=y(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,o,s,a=e[i],c=a.getAttribute("xlink:href").substr(1),l=a.getAttribute("x")||0,u=a.getAttribute("y")||0,h=k(t,c).cloneNode(!0),f=(h.getAttribute("transform")||"")+" translate("+l+", "+u+")",d=e.length;if(E(h),/^svg$/i.test(h.nodeName)){var p=h.ownerDocument.createElement("g");for(r=0,s=(o=h.attributes).length;r<s;r++)n=o.item(r),p.setAttribute(n.nodeName,n.nodeValue);for(;h.firstChild;)p.appendChild(h.firstChild);h=p}for(r=0,s=(o=a.attributes).length;r<s;r++)"x"!==(n=o.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?f=n.nodeValue+" "+f:h.setAttribute(n.nodeName,n.nodeValue));h.setAttribute("transform",f),h.setAttribute("instantiated_by_use","1"),h.removeAttribute("id"),a.parentNode.replaceChild(h,a),e.length===d&&i++}}(t);var n=new Date,r=_.Object.__uid++,o=E(t),s=_.util.toArray(t.getElementsByTagName("*"));if(o.svgUid=r,0===s.length&&_.isLikelyNode){for(var a=[],c=0,l=(s=t.selectNodes('//*[name(.)!="svg"]')).length;c<l;c++)a[c]=s[c];s=a}var u=s.filter(function(t){return E(t),d.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,p)});!u||u&&!u.length?e&&e([],{}):(_.gradientDefs[r]=_.getGradientDefs(t),_.cssRules[r]=_.getCSSRules(t),_.parseElements(u,function(t){_.documentParsingTime=new Date-n,e&&e(t,o)},h(o),i))}};var T=function(t,e){e(!1)},j=function(){},M=function(){};function P(t,e,i){e[i]&&e[i].toSVG&&t.push('\t<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image>\n\t</pattern>\n')}var A=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+_.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+_.reNum+"))?\\s+(.*)");l(_,{parseFontDeclaration:function(t,e){var i=t.match(A);if(i){var n=i[1],r=i[3],o=i[4],s=i[5],a=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(e.fontSize=x(o)),a&&(e.fontFamily=a),s&&(e.lineHeight="normal"===s?1:s)}},getGradientDefs:function(t){var e,i,n,r=y(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),o=0,s={},a={};for(o=r.length;o--;)n=(e=r[o]).getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(a[i]=n.substr(1)),s[i]=e;for(i in a){var c=s[a[i]].cloneNode(!0);for(e=s[i];c.firstChild;)e.appendChild(c.firstChild)}return s},parseAttributes:function(i,t,e){if(i){var n,r,o={};void 0===e&&(e=i.getAttribute("svgUid")),i.parentNode&&g.test(i.parentNode.nodeName)&&(o=_.parseAttributes(i.parentNode,t,e)),r=o&&o.fontSize||i.getAttribute("font-size")||_.Text.DEFAULT_SVG_FONT_SIZE;var s=t.reduce(function(t,e){return(n=i.getAttribute(e))&&(e=m(e),n=b(e,n,o,r),t[e]=n),t},{});return(s=l(s,l(function(t,e){var i={};for(var n in _.cssRules[e])if(w(t,n.split(" ")))for(var r in _.cssRules[e][n])i[r]=_.cssRules[e][n][r];return i}(i,e),_.parseStyleAttribute(i)))).font&&_.parseFontDeclaration(s.font,s),function(t){for(var e in v)if(void 0!==t[v[e]]&&""!==t[e]){if(void 0===t[e]){if(!_.Object.prototype[e])continue;t[e]=_.Object.prototype[e]}if(0!==t[e].indexOf("url(")){var i=new _.Color(t[e]);t[e]=i.setAlpha(u(i.getAlpha()*t[v[e]],2)).toRgba()}}return t}(l(o,s))}},parseElements:function(t,e,i,n){new _.ElementsParser(t,e,i,n).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i&&("string"==typeof i?function(t,i){var n,r;t.replace(/;\s*$/,"").split(";").forEach(function(t){var e=t.split(":");n=m(e[0].trim().toLowerCase()),r=b(n,e[1].trim()),i[n]=r})}(i,e):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(n=b(i=m(r.toLowerCase()),t[r]),e[i]=n)}(i,e)),e},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){for(var e=t.getElementsByTagName("style"),l={},i=0,n=e.length;i<n;i++){var r=e[i].textContent||e[i].text;""!==(r=r.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&r.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){for(var e=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),i={},n=e[2].trim().replace(/;$/,"").split(/\s*;\s*/),r=0,o=n.length;r<o;r++){var s=n[r].split(/\s*:\s*/),a=m(s[0]),c=b(a,s[1],s[0]);i[a]=c}(t=e[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(l[t]?_.util.object.extend(l[t],i):l[t]=_.util.object.clone(i))})})}return l},loadSVGFromURL:function(i,n,r){function e(t){var e=t.responseXML;e&&!e.documentElement&&_.window.ActiveXObject&&t.responseText&&((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement||n&&n(null),_.parseSVGDocument(e.documentElement,function(t,e){M(i,{objects:_.util.array.invoke(t,"toObject"),options:e}),n&&n(t,e)},r)}i=i.replace(/^\n\s*/,"").trim(),T(i,function(t){t?j(i,function(t){var e=function(t){var e=t.objects,i=t.options;return{objects:e=e.map(function(t){return _[o(t.type)].fromObject(t)}),options:i}}(t);n(e.objects,e.options)}):new _.util.request(i,{method:"get",onComplete:e})})},loadSVGFromString:function(t,i,e){var n;if(t=t.trim(),"undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(t,"text/xml"))}else _.window.ActiveXObject&&((n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));_.parseSVGDocument(n.documentElement,function(t,e){i(t,e)},e)},createSVGFontFacesMarkup:function(t){for(var e,i,n,r,o,s,a="",c={},l=_.fontPaths,u=0,h=t.length;u<h;u++)if(i=(e=t[u]).fontFamily,-1!==e.type.indexOf("text")&&!c[i]&&l[i]&&(c[i]=!0,e.styles))for(o in n=e.styles)for(s in r=n[o])!c[i=r[s].fontFamily]&&l[i]&&(c[i]=!0);for(var f in c)a+=["\t\t@font-face {\n","\t\t\tfont-family: '",f,"';\n","\t\t\tsrc: url('",l[f],"');\n","\t\t}\n"].join("");return a&&(a=['\t<style type="text/css">',"<![CDATA[\n",a,"]]>","</style>\n"].join("")),a},createSVGRefElementsMarkup:function(t){var e=[];return P(e,t,"backgroundColor"),P(e,t,"overlayColor"),e.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.resolveGradient(n,"fill"),this.resolveGradient(n,"stroke"),this.reviver&&this.reviver(e,n),this.instances[i]=n,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(e,i){var n=this;return function(t){n.resolveGradient(t,"fill"),n.resolveGradient(t,"stroke"),n.reviver&&n.reviver(i,t),n.instances[e]=t,n.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i).prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}}}("undefined"!=typeof exports?exports:this),function(t){var f=t.fabric||(t.fabric={});function d(t){this.status=t,this.points=[]}f.Intersection?f.warn("fabric.Intersection is already defined"):(f.Intersection=d,f.Intersection.prototype={constructor:d,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},f.Intersection.intersectLineLine=function(t,e,i,n){var r,o=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),a=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!=a){var c=o/a,l=s/a;0<=c&&c<=1&&0<=l&&l<=1?(r=new d("Intersection")).appendPoint(new f.Point(t.x+c*(e.x-t.x),t.y+c*(e.y-t.y))):r=new d}else r=new d(0==o||0==s?"Coincident":"Parallel");return r},f.Intersection.intersectLinePolygon=function(t,e,i){for(var n,r,o,s=new d,a=i.length,c=0;c<a;c++)n=i[c],r=i[(c+1)%a],o=d.intersectLineLine(t,e,n,r),s.appendPoints(o.points);return 0<s.points.length&&(s.status="Intersection"),s},f.Intersection.intersectPolygonPolygon=function(t,e){for(var i=new d,n=t.length,r=0;r<n;r++){var o=t[r],s=t[(r+1)%n],a=d.intersectLinePolygon(o,s,e);i.appendPoints(a.points)}return 0<i.points.length&&(i.status="Intersection"),i},f.Intersection.intersectPolygonRectangle=function(t,e,i){var n=e.min(i),r=e.max(i),o=new f.Point(r.x,n.y),s=new f.Point(n.x,r.y),a=d.intersectLinePolygon(n,o,t),c=d.intersectLinePolygon(o,r,t),l=d.intersectLinePolygon(r,s,t),u=d.intersectLinePolygon(s,n,t),h=new d;return h.appendPoints(a.points),h.appendPoints(c.points),h.appendPoints(l.points),h.appendPoints(u.points),0<h.points.length&&(h.status="Intersection"),h})}("undefined"!=typeof exports?exports:this),function(t){var l=t.fabric||(t.fabric={});function u(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function h(t,e,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}l.Color?l.warn("fabric.Color is already defined."):(l.Color=u,l.Color.prototype={_tryParsingColor:function(t){var e;t in u.colorNameMap&&(t=u.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=u.sourceFromHex(t)),e||(e=u.sourceFromRgb(t)),e||(e=u.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var n,r,o,s=l.util.array.max([t,e,i]),a=l.util.array.min([t,e,i]);if(o=(s+a)/2,s===a)n=r=0;else{var c=s-a;switch(r=.5<o?c/(2-s-a):c/(s+a),s){case t:n=(e-i)/c+(e<i?6:0);break;case e:n=(i-t)/c+2;break;case i:n=(t-e)/c+4}n/=6}return[Math.round(360*n),Math.round(100*r),Math.round(100*o)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof u||(t=new u(t));for(var e=[],i=this.getAlpha(),n=this.getSource(),r=t.getSource(),o=0;o<3;o++)e.push(Math.round(.5*n[o]+.5*r[o]));return e[3]=i,this.setSource(e),this}},l.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,l.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},l.Color.fromRgb=function(t){return u.fromSource(u.sourceFromRgb(t))},l.Color.sourceFromRgb=function(t){var e=t.match(u.reRGBa);if(e){var i=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),n=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),r=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(i,10),parseInt(n,10),parseInt(r,10),e[4]?parseFloat(e[4]):1]}},l.Color.fromRgba=u.fromRgb,l.Color.fromHsl=function(t){return u.fromSource(u.sourceFromHsl(t))},l.Color.sourceFromHsl=function(t){var e=t.match(u.reHSLa);if(e){var i,n,r,o=(parseFloat(e[1])%360+360)%360/360,s=parseFloat(e[2])/(/%$/.test(e[2])?100:1),a=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0==s)i=n=r=a;else{var c=a<=.5?a*(1+s):a+s-a*s,l=2*a-c;i=h(l,c,o+1/3),n=h(l,c,o),r=h(l,c,o-1/3)}return[Math.round(255*i),Math.round(255*n),Math.round(255*r),e[4]?parseFloat(e[4]):1]}},l.Color.fromHsla=u.fromHsl,l.Color.fromHex=function(t){return u.fromSource(u.sourceFromHex(t))},l.Color.sourceFromHex=function(t){if(t.match(u.reHex)){var e=t.slice(t.indexOf("#")+1),i=3===e.length||4===e.length,n=8===e.length||4===e.length,r=i?e.charAt(0)+e.charAt(0):e.substring(0,2),o=i?e.charAt(1)+e.charAt(1):e.substring(2,4),s=i?e.charAt(2)+e.charAt(2):e.substring(4,6),a=n?i?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(r,16),parseInt(o,16),parseInt(s,16),parseFloat((parseInt(a,16)/255).toFixed(2))]}},l.Color.fromSource=function(t){var e=new u;return e.setSource(t),e})}("undefined"!=typeof exports?exports:this),function(){function h(t){var e,i,n,r=t.getAttribute("style"),o=t.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:1<o?1:o,r){var s=r.split(/\s*;\s*/);""===s[s.length-1]&&s.pop();for(var a=s.length;a--;){var c=s[a].split(/\s*:\s*/),l=c[0].trim(),u=c[1].trim();"stop-color"===l?e=u:"stop-opacity"===l&&(n=u)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),i=(e=new fabric.Color(e)).getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:o,color:e.toRgb(),opacity:n}}function f(t,e,i){var n,r=0,o=1,s="";for(var a in e)"Infinity"===e[a]?e[a]=1:"-Infinity"===e[a]&&(e[a]=0),n=parseFloat(e[a],10),o="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(o*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i&&t.left||0):"y1"!==a&&"y2"!==a||(o*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i&&t.top||0),e[a]=n*o+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var c=t.ry/t.rx;s=" scale(1, "+c+")",e.y1&&(e.y1/=c),e.y2&&(e.y2/=c)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(t){var e,i,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-t.width/2:"y1"!==r&&"y2"!==r||(n[r]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var o=0;o<this.colorStops.length;o++)e.push("<stop ",'offset="',100*this.colorStops[o].offset+"%",'" style="stop-color:',this.colorStops[o].color,null!==this.colorStops[o].opacity?";stop-opacity: "+this.colorStops[o].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,n,r=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+e.width/2:"y1"!==n&&"y2"!==n||(r[n]+=-this.offsetY+e.height/2);"linear"===this.type?i=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(i=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var o=0,s=this.colorStops.length;o<s;o++){var a=this.colorStops[o].color,c=this.colorStops[o].opacity,l=this.colorStops[o].offset;void 0!==c&&(a=new fabric.Color(a).setAlpha(c).toRgba()),i.addColorStop(parseFloat(l),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(t,e){var i,n,r,o=t.getElementsByTagName("stop"),s=t.getAttribute("gradientUnits")||"objectBoundingBox",a=t.getAttribute("gradientTransform"),c=[];"linear"===(i="linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial")?n=function(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}(t):"radial"===i&&(n=function(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}(t));for(var l=o.length;l--;)c.push(h(o[l]));r=f(e,n,s);var u=new fabric.Gradient({type:i,coords:n,colorStops:c,offsetX:-e.left,offsetY:-e.top});return!a&&""===r||(u.gradientTransform=fabric.parseTransformAttribute((a||"")+r)),u},forObject:function(t,e){return e||(e={}),f(t,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r=this.offsetX/t.getWidth(),o=this.offsetY/t.getHeight(),s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){var o=t.fabric||(t.fabric={}),s=o.util.toFixed;o.Shadow?o.warn("fabric.Shadow is already defined."):(o.Shadow=o.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var e in"string"==typeof t&&(t=this._parseShadow(t)),t)this[e]=t[e];this.id=o.Object.__uid++},_parseShadow:function(t){var e=t.trim(),i=o.Shadow.reOffsetsAndBlur.exec(e)||[];return{color:(e.replace(o.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var e=40,i=40,n=o.Object.NUM_FRACTION_DIGITS,r=o.util.rotateVector({x:this.offsetX,y:this.offsetY},o.util.degreesToRadians(-t.angle));return t.width&&t.height&&(e=100*s((Math.abs(r.x)+this.blur)/t.width,n)+20,i=100*s((Math.abs(r.y)+this.blur)/t.height,n)+20),t.flipX&&(r.x*=-1),t.flipY&&(r.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+e+'%" width="'+(100+2*e)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+s(this.blur?this.blur/2:0,n)+'"></feGaussianBlur>\n\t<feOffset dx="'+s(r.x,n)+'" dy="'+s(r.y,n)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var e={},i=o.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(t){this[t]!==i[t]&&(e[t]=this[t])},this),e}}),o.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var n=fabric.util.object.extend,t=fabric.util.getElementOffset,c=fabric.util.removeFromArray,a=fabric.util.toFixed,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var i=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,i,n){return"string"==typeof t?fabric.util.loadImage(t,function(t){t&&(this[e]=new fabric.Image(t,n)),i&&i(t)},this,n&&n.crossOrigin):(n&&t.setOptions(n),this[e]=t,i&&i(t)),this},__setBgOverlayColor:function(e,i,n){if(i&&i.source){var r=this;fabric.util.loadImage(i.source,function(t){r[e]=new fabric.Pattern({source:t,repeat:i.repeat,offsetX:i.offsetX,offsetY:i.offsetY}),n&&n()})}else this[e]=i,n&&n();return this},_createCanvasElement:function(t){var e=fabric.util.createCanvasElement(t);if(e.style||(e.style={}),!e)throw i;if(void 0===e.getContext)throw i;return e},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var e,i=this._activeGroup;this.viewportTransform=t;for(var n=0,r=this._objects.length;n<r;n++)(e=this._objects[n]).group||e.setCoords();return i&&i.setCoords(),this.renderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),n[0]=e,n[3]=e;var r=fabric.util.transformPoint(t,n);return n[4]+=i.x-r.x,n[5]+=i.y-r.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(t,e){var i={objects:this._toObjects(t,e)};return n(i,this.__serializeBgOverlay(t,e)),fabric.util.populateWithProperties(this,i,e),i},_toObjects:function(e,i){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(t){return this._toObject(t,e,i)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor};return this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(i.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(i.overlayImage=this._toObject(this.overlayImage,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,n=e.width||this.width,r=e.height||this.height,o='viewBox="0 0 '+this.width+" "+this.height+'" ',s=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?o='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,o='viewBox="'+a(-i[4]/i[0],s)+" "+a(-i[5]/i[3],s)+" "+a(this.width/i[0],s)+" "+a(this.height/i[3],s)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',r,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var i,n=0,r=this.getObjects(),o=r.length;n<o;n++)(i=r[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,i,n,r=this._activeGroup;if(t===r)for(e=(n=r._objects).length;e--;)i=n[e],c(this._objects,i),this._objects.unshift(i);else c(this._objects,t),this._objects.unshift(t);return this.renderAll&&this.renderAll()},bringToFront:function(t){if(!t)return this;var e,i,n,r=this._activeGroup;if(t===r)for(n=r._objects,e=0;e<n.length;e++)i=n[e],c(this._objects,i),this._objects.push(i);else c(this._objects,t),this._objects.push(t);return this.renderAll&&this.renderAll()},sendBackwards:function(t,e){if(!t)return this;var i,n,r,o,s,a=this._activeGroup;if(t===a)for(s=a._objects,i=0;i<s.length;i++)n=s[i],0!==(r=this._objects.indexOf(n))&&(o=r-1,c(this._objects,n),this._objects.splice(o,0,n));else 0!==(r=this._objects.indexOf(t))&&(o=this._findNewLowerIndex(t,r,e),c(this._objects,t),this._objects.splice(o,0,t));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(t,e,i){var n;if(i)for(var r=(n=e)-1;0<=r;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var i,n,r,o,s,a=this._activeGroup;if(t===a)for(i=(s=a._objects).length;i--;)n=s[i],(r=this._objects.indexOf(n))!==this._objects.length-1&&(o=r+1,c(this._objects,n),this._objects.splice(o,0,n));else(r=this._objects.indexOf(t))!==this._objects.length-1&&(o=this._findNewUpperIndex(t,r,e),c(this._objects,t),this._objects.splice(o,0,t));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(t,e,i){var n;if(i)for(var r=(n=e)+1;r<this._objects.length;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e+1;return n},moveTo:function(t,e){return c(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),n(fabric.StaticCanvas.prototype,fabric.Observable),n(fabric.StaticCanvas.prototype,fabric.Collection),n(fabric.StaticCanvas.prototype,fabric.DataURLExporter),n(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,o=this._points.length;r<o;r++){var s=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,o=t.length;r<o;r++){var s=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}else this.canvas.renderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;i<n;i++){var r=this.points[i],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),e.push(o)}var s=new fabric.Group(e,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;o<s;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});c.canvas=this.canvas,this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;n<r;n++)i[e=t[n].left+""+t[n].top]||(i[e]=t[n]);var o=[];for(e in i)o.push(i[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;i<n;i++){var r=this.sprayChunkPoints[i];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,o=0;o<this.density;o++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var c=fabric.util.getPointer,s=fabric.util.degreesToRadians,h=fabric.util.radiansToDegrees,f=Math.atan2,l=Math.abs,u=fabric.StaticCanvas.supports("setLineDash");for(var t in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e=this.getActiveGroup(),i=this.getActiveObject(),n=[],r=[];if(!e&&!i||this.preserveObjectStacking)n=this._objects;else{for(var o=0,s=this._objects.length;o<s;o++)t=this._objects[o],e&&e.contains(t)||t===i?r.push(t):n.push(t);e&&(e._set("_objects",r),n.push(e)),i&&n.push(i)}return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.viewportTransform,o=this.restorePointerVpt(e),s=fabric.util.transformPoint(o,n);return fabric.util.transformPoint(s,r)},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners,o=this.contextCache,s=t.selectionBackgroundColor;t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",o.save(),o.transform.apply(o,this.viewportTransform),t.render(o),o.restore(),t.active&&t._renderControls(o),t.hasBorders=n,t.transparentCorners=r,t.selectionBackgroundColor=s;var a=fabric.util.isTransparent(o,e,i,this.targetFindTolerance);return this.clearContext(o),a},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,e){if(e){var i=this.getPointer(t),n=e._findTargetCorner(this.getPointer(t,!0)),r=this._getActionFromCorner(e,n,t),o=this._getOriginFromCorner(e,n);this._currentTransform={target:e,action:r,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:o.x,originY:o.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,left:e.left,top:e.top,theta:s(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:o.x,originY:o.y},this._resetCurrentTransform()}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,o=e-i.offsetY,s=!n.get("lockMovementX")&&n.left!==r,a=!n.get("lockMovementY")&&n.top!==o;return s&&n.set("left",r),a&&n.set("top",o),s||a},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},o=e.target.skewX,s="left",a="right",c="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=0<t?1:-1,"y"===i&&(o=e.target.skewY,s="top",a="bottom",n="originY"),r[-1]=s,r[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===o?(e.skewSign=-c*t*l,e[n]=r[-t]):(o=0<o?1:-1,e.skewSign=o,e[n]=r[o*c*l])},_skewObject:function(t,e,i){var n,r=this._currentTransform,o=r.target,s=o.get("lockSkewingX"),a=o.get("lockSkewingY");if(s&&"x"===i||a&&"y"===i)return!1;var c,l,u=o.getCenterPoint(),h=o.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=o.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],d=o._getTransformedDimensions();return this._changeSkewTransformOrigin(h-f,r,i),c=o.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],l=o.translateToOriginPoint(u,r.originX,r.originY),n=this._setObjectSkew(c,r,i,d),r.lastX=t,r.lastY=e,o.setPositionByOrigin(l,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,o,s,a,c,l,u,h,f,d,p=e.target,g=e.skewSign;return d="x"===i?(c="y",l="Y",u="X",f=0,p.skewY):(c="x",l="X",u="Y",f=p.skewX,0),a=p._getTransformedDimensions(f,d),r=(h=2*Math.abs(t)-a[i])<=2?0:(r=g*Math.atan(h/p["scale"+u]/(a[c]/p["scale"+l])),fabric.util.radiansToDegrees(r)),o=p["skew"+u]!==r,p.set("skew"+u,r),0!==p["skew"+l]&&(s=p._getTransformedDimensions(),r=n[c]/s[c]*p["scale"+l],p.set("scale"+l,r)),o},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(o&&s)return!1;var c,l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),u=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),h=r._getTransformedDimensions();return this._setLocalMouse(u,n),c=this._setObjectScale(u,n,o,s,i,a,h),r.setPositionByOrigin(l,n.originX,n.originY),c},_setObjectScale:function(t,e,i,n,r,o,s){var a,c,l,u,h=e.target,f=!1,d=!1,p=!1;return l=t.x*h.scaleX/s.x,u=t.y*h.scaleY/s.y,a=h.scaleX!==l,c=h.scaleY!==u,o&&l<=0&&l<h.scaleX&&(f=!0),o&&u<=0&&u<h.scaleY&&(d=!0),"equally"!==r||i||n?r?"x"!==r||h.get("lockUniScaling")?"y"!==r||h.get("lockUniScaling")||d||n||h.set("scaleY",u)&&(p=p||c):f||i||h.set("scaleX",l)&&(p=p||a):(f||i||h.set("scaleX",l)&&(p=p||a),d||n||h.set("scaleY",u)&&(p=p||c)):f||d||(p=this._scaleObjectEqually(t,h,e,s)),e.newScaleX=l,e.newScaleY=u,f||d||this._flipObject(e,r),p},_scaleObjectEqually:function(t,e,i,n){var r,o=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX;return i.newScaleX=i.original.scaleX*o/s,i.newScaleY=i.original.scaleY*o/s,r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),l(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,l(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var i=this._currentTransform;if(i.target.get("lockRotation"))return!1;var n=f(i.ey-i.top,i.ex-i.left),r=f(e-i.top,t-i.left),o=h(r-n+i.theta),s=!0;if(o<0&&(o=360+o),o%=360,0<i.target.snapAngle){var a=i.target.snapAngle,c=i.target.snapThreshold||a,l=Math.ceil(o/a)*a,u=Math.floor(o/a)*a;Math.abs(o-u)<c?o=u:Math.abs(o-l)<c&&(o=l),i.target.angle===o&&(s=!1)}return i.target.angle=o,s},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,r=l(i),o=l(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(0<i?0:-i),e.ey-(0<n?0:-n),r,o)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!u){var s=e.ex+.5-(0<i?0:r),a=e.ey+.5-(0<n?0:o);t.beginPath(),fabric.util.drawDashedLine(t,s,a,s+r,a,this.selectionDashArray),fabric.util.drawDashedLine(t,s,a+o-1,s+r,a+o-1,this.selectionDashArray),fabric.util.drawDashedLine(t,s,a,s,a+o,this.selectionDashArray),fabric.util.drawDashedLine(t,s+r-1,a,s+r-1,a+o,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(0<i?0:r),e.ey+.5-(0<n?0:o),r,o)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n=this.getPointer(t,!0),r=this.getActiveGroup(),o=this.getActiveObject();if(r&&!e&&this._checkTarget(n,r))return this._fireOverOutEvents(r,t),r;if(o&&o._findTargetCorner(n))return this._fireOverOutEvents(o,t),o;if(o&&this._checkTarget(n,o)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(o,t),o;i=o}this.targets=[];var s=this._searchPossibleTargets(this._objects,n);return t[this.altSelectionKey]&&s&&i&&s!==i&&(s=i),this._fireOverOutEvents(s,t),s}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r,o=t.length;o--;)if(this._checkTarget(e,t[o])){"group"===(i=t[o]).type&&i.subTargetCheck&&(n=this._normalizePointer(i,e),(r=this._searchPossibleTargets(i._objects,n))&&this.targets.push(r));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,e,i){i||(i=this.upperCanvasEl);var n,r=c(t),o=i.getBoundingClientRect(),s=o.width||0,a=o.height||0;return s&&a||("top"in o&&"bottom"in o&&(a=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(s=Math.abs(o.right-o.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,e||(r=this.restorePointerVpt(r)),n=0===s||0===a?{width:1,height:1}:{width:i.width/s,height:i.height/a},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),(this._activeObject=t).set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){(this._activeGroup=t)&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var e=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:e}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;e<i;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),i=this.getActiveObject();return(i||e)&&this.fire("before:selection:cleared",{target:i||e,e:t}),this.deactivateAll(),(i||e)&&(this.fire("selection:cleared",{e:t,target:i}),i&&i.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e)this._objects[e]&&this._objects[e].active&&this._objects[e]._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(e){if(e.group&&e.group===this.getActiveGroup()){var i={};return["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(t){i[t]=e[t]}),this.getActiveGroup().realizeTransform(e),i}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n;n=this._realizeGroupTransformOnObject(e),this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)}}),fabric.StaticCanvas)"prototype"!==t&&(fabric.Canvas[t]=fabric.StaticCanvas[t]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var r={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},i=fabric.util.addListener,n=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){n(fabric.window,"resize",this._onResize),n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"mouseout",this._onMouseOut),n(this.upperCanvasEl,"mouseenter",this._onMouseEnter),n(this.upperCanvasEl,"wheel",this._onMouseWheel),n(this.upperCanvasEl,"contextmenu",this._onContextMenu),n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove),n(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var e=this;setTimeout(function(){i(e.upperCanvasEl,"mousedown",e._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e,i=!0,n=this._currentTransform,r=this._groupSelector,o=!r||0===r.left&&0===r.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{n&&(this._finalizeCurrentTransform(),i=!n.actionPerformed),e=i?this.findTarget(t,!0):n.target;var s=this._shouldRender(e,this.getPointer(t));e||!o?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),s&&this.renderAll()}},_handleCursorAndEvent:function(t,e,i){this._setCursorFromEvent(t,e),this._handleEvent(t,i,e||null)},_handleEvent:function(t,e,i){var n=i,r=this.targets||[],o={e:t,target:n,subTargets:r};this.fire("mouse:"+e,o),n&&n.fire("mouse"+e,o);for(var s=0;s<r.length;s++)r[s].fire("mouse"+e,o)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e=this.findTarget(t),i=this.getPointer(t,!0);if("which"in t?3===t.which:2===t.button)this.fireRightClick&&this._handleEvent(t,"down",e||null);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){this._previousPointer=i;var n=this._shouldRender(e,i),r=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,i):r&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&(!e.selectable||!e.__corner&&r||(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),e.selectable&&this.setActiveObject(e,t))),this._handleEvent(t,"down",e||null),n&&this.renderAll()}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&1<t.touches.length)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null)}},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action,a=!1;"rotate"===s?(a=this._rotateObject(n,r))&&this._fire("rotating",o,t):"scale"===s?(a=this._onScale(t,e,n,r))&&this._fire("scaling",o,t):"scaleX"===s?(a=this._scaleObject(n,r,"x"))&&this._fire("scaling",o,t):"scaleY"===s?(a=this._scaleObject(n,r,"y"))&&this._fire("scaling",o,t):"skewX"===s?(a=this._skewObject(n,r,"x"))&&this._fire("skewing",o,t):"skewY"===s?(a=this._skewObject(n,r,"y"))&&this._fire("skewing",o,t):(a=this._translateObject(n,r))&&(this._fire("moving",o,t),this.setCursor(o.moveCursor||this.moveCursor)),e.actionPerformed=a},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor;if(e.selectable){var n=this.getActiveGroup(),r=e._findTargetCorner&&(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this._setCornerCursor(r,e,t):this.setCursor(i)}else this.setCursor(i);return!0},_setCornerCursor:function(t,e,i){if(t in r)this.setCursor(this._getRotatedCornerCursor(t,e,i));else{if("mtr"!==t||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(t,e,i){var n=Math.round(e.getAngle()%360/45);return n<0&&(n+=8),n+=r[t],i[this.altActionKey]&&r[t]%2==0&&(n+=2),n%=8,this.cursorMap[n]}})}(),function(){var u=Math.min,h=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){var i=this.getActiveGroup();e===i&&!(e=this.findTarget(t,!0))||(i?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(i,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):1<e.length&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var t,e=[],i=this._groupSelector.ex,n=this._groupSelector.ey,r=i+this._groupSelector.left,o=n+this._groupSelector.top,s=new fabric.Point(u(i,r),u(n,o)),a=new fabric.Point(h(i,r),h(n,o)),c=i===r&&n===o,l=this._objects.length;l--&&!((t=this._objects[l])&&t.selectable&&t.visible&&(t.intersectsWithRect(s,a)||t.isContainedWithinRect(s,a)||t.containsPoint(s)||t.containsPoint(a))&&(t.set("active",!0),e.push(t),c)););return e},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var n=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),o=this.getHeight(),s=(i.width||this.getWidth())*n,a=(i.height||this.getHeight())*n,c=this.getZoom()*n,l=this.viewportTransform,u=[c,0,0,c,(l[4]-i.left)*n,(l[5]-i.top)*n],h=this.interactive;this.viewportTransform=u,this.interactive&&(this.interactive=!1),r!==s||o!==a?this.setDimensions({width:s,height:a}):this.renderAll();var f=this.__toDataURL(t,e,i);return h&&(this.interactive=h),this.viewportTransform=l,this.setDimensions({width:r,height:o}),f},__toDataURL:function(t,e){var i=this.contextContainer.canvas;return"jpg"===t&&(t="jpeg"),n?i.toDataURL("image/"+t,e):i.toDataURL("image/"+t)},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t);this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,function(){for(var t in delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,n)r[t]=n[t];e&&e()})},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()}else e&&e()},__setBgOverlay:function(e,t,i,n){var r=this;t?"backgroundImage"===e||"overlayImage"===e?fabric.Image.fromObject(t,function(t){r[e]=t,i[e]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){i[e]=!0,n&&n()}):i[e]=!0},_enlivenObjects:function(t,e,i){var n=this;if(t&&0!==t.length){var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e)}),n.renderOnAddRemove=r,e&&e()},null,i)}else e&&e()},_toDataURL:function(e,i){this.clone(function(t){i(t.toDataURL(e))})},_toDataURLWithMultiplier:function(e,i,n){this.clone(function(t){n(t.toDataURLWithMultiplier(e,i))})},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){e&&e(t)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){var a=t.fabric||(t.fabric={}),e=a.util.object.extend,n=a.util.toFixed,i=a.util.string.capitalize,o=a.util.degreesToRadians,r=a.StaticCanvas.supports("setLineDash");a.Object||(a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof a.Gradient||this.set("fill",new a.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof a.Gradient||this.set("stroke",new a.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof a.Pattern||this.set("fill",new a.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof a.Pattern||this.set("stroke",new a.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=a.util.getFunctionBody(t.clipTo);void 0!==e&&(this.clipTo=new Function("ctx",e))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(o(this.skewX)),1,0,0),t.transform(1,Math.tan(o(this.skewY)),0,1,0,0)},toObject:function(t){var e=a.Object.NUM_FRACTION_DIGITS,i={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,e),top:n(this.top,e),width:n(this.width,e),height:n(this.height,e),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,e),scaleX:n(this.scaleX,e),scaleY:n(this.scaleY,e),angle:n(this.getAngle(),e),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:n(this.skewX,e),skewY:n(this.skewY,e)};return a.util.populateWithProperties(this,i,t),this.includeDefaultValues||(i=this._removeDefaultValues(i)),i},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(e){var i=a.util.getKlass(e.type).prototype;return i.stateProperties.forEach(function(t){e[t]===i[t]&&delete e[t],"[object Array]"===Object.prototype.toString.call(e[t])&&"[object Array]"===Object.prototype.toString.call(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t]}),e},toString:function(){return"#<fabric."+i(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){return("scaleX"===t||"scaleY"===t)&&(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof a.Shadow||(e=new a.Shadow(e)),this[t]=e,"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,e){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),e||this.transform(t),this._setOpacity(t),this._setShadow(t),this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&a.util.clipContext(this,t),this._render(t,e),this.clipTo&&t.restore(),t.restore())},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this._removeShadow(t))},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),r?t.setLineDash(e):i&&i(t))},_renderControls:function(t,e){if(!(!this.active||e||this.group&&this.group!==this.canvas.getActiveGroup())){var i,n=this.getViewportTransform(),r=this.calcTransformMatrix();r=a.util.multiplyTransformMatrices(n,r),i=a.util.qrDecompose(r),t.save(),t.translate(i.translateX,i.translateY),t.lineWidth=1*this.borderScaleFactor,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(o(i.angle)),this.drawBordersInGroup(t,i)):(t.rotate(o(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,n=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(e*=a.devicePixelRatio,i*=a.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(e+i)*(n.scaleX+n.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*e*n.scaleX,t.shadowOffsetY=this.shadow.offsetY*i*n.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore()}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore()}},clone:function(t,e){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(e),t):new a.Object(this.toObject(e))},cloneAsImage:function(e,t){var i=this.toDataURL(t);return a.util.loadImage(i,function(t){e&&e(new a.Image(t))}),this},toDataURL:function(t){t||(t={});var e=a.util.createCanvasElement(),i=this.getBoundingRect();e.width=i.width,e.height=i.height,a.util.wrapElement(e,"div");var n=new a.StaticCanvas(e,{enableRetinaScaling:t.enableRetinaScaling});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(n.backgroundColor="#fff");var r={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new a.Point(n.getWidth()/2,n.getHeight()/2),"center","center");var o=this.canvas;n.add(this);var s=n.toDataURL(t);return this.set(r).setCoords(),this.canvas=o,n.dispose(),n=null,s},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,e){e||(e={});var i={colorStops:[]};for(var n in i.type=e.type||(e.r1||e.r2?"radial":"linear"),i.coords={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},(e.r1||e.r2)&&(i.coords.r1=e.r1,i.coords.r2=e.r2),e.gradientTransform&&(i.gradientTransform=e.gradientTransform),e.colorStops){var r=new a.Color(e.colorStops[n]);i.colorStops.push({offset:n,color:r.toRgb(),opacity:r.getAlpha()})}return this.set(t,a.Gradient.forObject(this,i))},setPatternFill:function(t){return this.set("fill",new a.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new a.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=new a.Point(e.x,e.y),n=this._getLeftTopCoords();return this.angle&&(i=a.util.rotatePoint(i,n,a.util.degreesToRadians(-this.angle))),{x:i.x-n.x,y:i.y-n.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,e(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians,u={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,e,i,n,r){var o,s,a,c=t.x,l=t.y;return"string"==typeof e?e=u[e]:e-=.5,"string"==typeof n?n=u[n]:n-=.5,"string"==typeof i?i=h[i]:i-=.5,"string"==typeof r?r=h[r]:r-=.5,s=r-i,((o=n-e)||s)&&(a=this._getTransformedDimensions(),c=t.x+o*a.x,l=t.y+s*a.y),new fabric.Point(c,l)},translateToCenterPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,e,i,"center","center");return this.angle?fabric.util.rotatePoint(n,t,a(this.angle)):n},translateToOriginPoint:function(t,e,i){var n=this.translateToGivenOrigin(t,"center","center",e,i);return this.angle?fabric.util.rotatePoint(n,t,a(this.angle)):n},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(t,e,i){var n,r,o=this.getCenterPoint();return n=void 0!==e&&void 0!==i?this.translateToGivenOrigin(o,"center","center",e,i):new fabric.Point(this.left,this.top),r=new fabric.Point(t.x,t.y),this.angle&&(r=fabric.util.rotatePoint(r,o,-a(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(t){var e,i,n=a(this.angle),r=this.getWidth(),o=Math.cos(n)*r,s=Math.sin(n)*r;e="string"==typeof this.originX?u[this.originX]:this.originX-.5,i="string"==typeof t?u[t]:t-.5,this.left+=o*(i-e),this.top+=s*(i-e),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function n(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var x=fabric.util.degreesToRadians,c=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(t,e){var i=n(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(i,t,e).status},intersectsWithObject:function(t){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(n(this.oCoords),n(t.oCoords)).status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)},isContainedWithinObject:function(t){for(var e=n(this.oCoords),i=0;i<4;i++)if(!t.containsPoint(e[i]))return!1;return!0},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r=0;for(var o in e)if(!((n=e[o]).o.y<t.y&&n.d.y<t.y||n.o.y>=t.y&&n.d.y>=t.y||((n.o.x===n.d.x&&n.o.x>=t.x?n.o.x:(0,i=(n.d.y-n.o.y)/(n.d.x-n.o.x),-(t.y-0*t.x-(n.o.y-i*n.o.x))/(0-i)))>=t.x&&(r+=1),2!==r)))break;return r},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var t=x(this.angle),e=this.getViewportTransform(),i=this._calculateCurrentDimensions(),n=i.x,r=i.y;n<0&&(n=Math.abs(n));var o=Math.sin(t),s=Math.cos(t),a=0<n?Math.atan(r/n):0,c=n/Math.cos(a)/2,l=Math.cos(a+t)*c,u=Math.sin(a+t)*c,h=fabric.util.transformPoint(this.getCenterPoint(),e),f=new fabric.Point(h.x-l,h.y-u),d=new fabric.Point(f.x+n*s,f.y+n*o),p=new fabric.Point(f.x-r*o,f.y+r*s),g=new fabric.Point(h.x+l,h.y+u),v=new fabric.Point((f.x+p.x)/2,(f.y+p.y)/2),m=new fabric.Point((d.x+f.x)/2,(d.y+f.y)/2),b=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),y=new fabric.Point((g.x+p.x)/2,(g.y+p.y)/2),_=new fabric.Point(m.x+o*this.rotatingPointOffset,m.y-s*this.rotatingPointOffset);return this.oCoords={tl:f,tr:d,br:g,bl:p,ml:v,mt:m,mr:b,mb:y,mtr:_},this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=x(this.angle),e=Math.cos(t),i=Math.sin(t);return[e,i,-i,e,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),e=[1,0,0,1,t.x,t.y],i=this._calcRotateMatrix(),n=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),r=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return r=c(r,e),r=c(r,i),r=c(r,n)},_calcDimensionsTransformMatrix:function(t,e,i){var n=[1,0,Math.tan(x(t)),1],r=[1,Math.tan(x(e)),0,1],o=this.scaleX*(i&&this.flipX?-1:1),s=this.scaleY*(i&&this.flipY?-1:1),a=c([o,0,0,s],n,!0);return c(a,r,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function h(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(t){var e=this.fillRule,i=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",a=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=h("fill",this.fill);return[h("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",r,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",s,"; ",u,"fill-rule: ",e,"; ","opacity: ",a,";",l,c].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=this.getSkewX()%360,n=this.getSkewY()%360,r=this.getCenterPoint(),o=fabric.Object.NUM_FRACTION_DIGITS,s="path-group"===this.type?"":"translate("+t(r.x,o)+" "+t(r.y,o)+")",a=0!==e?" rotate("+t(e,o)+")":"",c=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,o)+" "+t(this.scaleY,o)+")",l=0!=i?" skewX("+t(i,o)+")":"",u=0!=n?" skewY("+t(n,o)+")":"",h="path-group"===this.type?this.width:0,f=this.flipX?" matrix(-1 0 0 1 "+h+" 0) ":"",d="path-group"===this.type?this.height:0;return[s,a,c,f,this.flipY?" matrix(1 0 0 -1 0 "+d+")":"",l,u].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),function(){var r=fabric.util.object.extend;function e(e,t,i){var n={};i.forEach(function(t){n[t]=e[t]}),r(e[t],n,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return!function i(t,e){if(!fabric.isLikelyNode&&t instanceof Element)return t===e;if(t instanceof Array){if(t.length!==e.length)return!1;var n=e.concat().sort();return!t.concat().sort().some(function(t,e){return!i(n[e],t)})}if(t instanceof Object){for(var r in t)if(!i(t[r],e[r]))return!1;return!0}return t===e}(this.originalState,this)},saveState:function(t){return e(this,"originalState",this.stateProperties),t&&t.stateProperties&&e(this,"originalState",t.stateProperties),this},setupState:function(t){return this.originalState={},this.saveState(t),this}})}(),function(){var c=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var o in this.__corner=0,this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=o;return!1},_setCornerCoords:function(){var t,e,i=this.oCoords,n=c(45-this.angle),r=.707106*this.cornerSize,o=r*Math.cos(n),s=r*Math.sin(n);for(var a in i)t=i[a].x,e=i[a].y,i[a].corner={tl:{x:t-s,y:e-o},tr:{x:t+o,y:e-s},bl:{x:t-o,y:e+s},br:{x:t+s,y:e+o}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth,e=this.width,i=this.height,n=!0,r=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(r=e,n=i),r&&(i+=i<0?-t:t),n&&(e+=e<0?-t:t),{x:e,y:i}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),o=r.x/2,s=r.y/2,a=[{x:-o,y:-s},{x:o,y:-s},{x:-o,y:s},{x:o,y:s}],c=this._calcDimensionsTransformMatrix(t,e,!1);for(i=0;i<a.length;i++)a[i]=fabric.util.transformPoint(a[i],c);return{x:(n=fabric.util.makeBoundingBoxFromPoints(a)).width,y:n.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions(),i=e.x,n=e.y;return fabric.util.transformPoint(new fabric.Point(i,n),t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.group||!this.active)return this;t.save();var e=this.getCenterPoint(),i=this._calculateCurrentDimensions(),n=this.canvas.viewportTransform;return t.translate(e.x,e.y),t.scale(1/n[0],1/n[3]),t.rotate(c(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this;var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,n=e.x+i,r=e.y+i;if(t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-n/2,-r/2,n,r),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var o=-r/2;t.beginPath(),t.moveTo(0,o),t.lineTo(0,o-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e){if(!this.hasBorders)return this;var i=this._getNonTransformedDimensions(),n=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),r=fabric.util.transformPoint(i,n),o=1/this.borderScaleFactor,s=r.x+o+2*this.padding,a=r.y+o+2*this.padding;return t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-s/2,-a/2,s,a),t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(),i=e.x,n=e.y,r=this.cornerSize,o=-(i+r)/2,s=-(n+r)/2,a=this.transparentCorners?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,a,o,s),this._drawControl("tr",t,a,o+i,s),this._drawControl("bl",t,a,o,s+n),this._drawControl("br",t,a,o+i,s+n),this.get("lockUniScaling")||(this._drawControl("mt",t,a,o+i/2,s),this._drawControl("mb",t,a,o+i/2,s+n),this._drawControl("mr",t,a,o+i,s+n/2),this._drawControl("ml",t,a,o,s+n/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,o+i/2,s-this.rotatingPointOffset),t.restore(),this},_drawControl:function(t,e,i,n,r){if(this.isControlVisible(t)){var o=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":e.beginPath(),e.arc(n+o/2,r+o/2,o/2,0,2*Math.PI,!1),e[i](),s&&e.stroke();break;default:"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(n,r,o,o),e[i+"Rect"](n,r,o,o),s&&e.strokeRect(n,r,o,o)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){function i(){}var n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),o.renderAll(),r()},onComplete:function(){e.setCoords(),n()}}),this},fxCenterObjectV:function(e,t){function i(){}var n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return fabric.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),o.renderAll(),r()},onComplete:function(){e.setCoords(),n()}}),this},fxRemove:function(e,t){function i(){}var n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(t){e.set("opacity",t),o.renderAll(),r()},onComplete:function(){o.remove(e),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,i,n){var r,o=this;t=t.toString(),i=i?fabric.util.object.clone(i):{},~e.indexOf(".")&&(r=e.split("."));var s=r?this.get(r[0])[r[1]]:this.get(e);"from"in i||(i.from=s),t=~t.indexOf("=")?s+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(t){r?o[r[0]][r[1]]=t:o.set(e,t),n||i.onChange&&i.onChange()},onComplete:function(){n||(o.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){var r=t.fabric||(t.fabric={}),o=r.util.object.extend,i={x1:1,x2:1,y1:1,y2:1},s=r.StaticCanvas.supports("setLineDash");function e(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case c:return Math.max(this.get(n),this.get(r))}}}r.Line?r.warn("fabric.Line is already defined"):(r.Line=r.util.createClass(r.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==i[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&s){var n=this.calcLinePoints();t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2)}t.lineWidth=this.strokeWidth;var r=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r},_renderDashedStroke:function(t){var e=this.calcLinePoints();t.beginPath(),r.util.drawDashedLine(t,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return o(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),r.Line.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),r.Line.fromElement=function(t,e){var i=r.parseAttributes(t,r.Line.ATTRIBUTE_NAMES),n=[i.x1||0,i.y1||0,i.x2||0,i.y2||0];return new r.Line(n,o(i,e))},r.Line.fromObject=function(t,e){var i=[t.x1,t.y1,t.x2,t.y2],n=new r.Line(i,t);return e&&e(n),n})}("undefined"!=typeof exports?exports:this),function(t){var r=t.fabric||(t.fabric={}),u=Math.PI,o=r.util.object.extend;r.Circle?r.warn("fabric.Circle is already defined."):(r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*u,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0,r=(this.endAngle-this.startAngle)%(2*u);if(0==r)this.group&&"path-group"===this.group.type&&(i=this.left+this.radius,n=this.top+this.radius),e.push("<circle ",this.getSvgId(),'cx="'+i+'" cy="'+n+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var o=Math.cos(this.startAngle)*this.radius,s=Math.sin(this.startAngle)*this.radius,a=Math.cos(this.endAngle)*this.radius,c=Math.sin(this.endAngle)*this.radius,l=u<r?"1":"0";e.push('<path d="M '+o+" "+s," A "+this.radius+" "+this.radius," 0 ",+l+" 1"," "+a+" "+c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),r.Circle.fromElement=function(t,e){e||(e={});var i=r.parseAttributes(t,r.Circle.ATTRIBUTE_NAMES);if(!function(t){return"radius"in t&&0<=t.radius}(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=i.left||0,i.top=i.top||0;var n=new r.Circle(o(i,e));return n.left-=n.radius,n.top-=n.radius,n},r.Circle.fromObject=function(t,e){var i=new r.Circle(t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),function(t){var n=t.fabric||(t.fabric={});n.Triangle?n.warn("fabric.Triangle is already defined"):(n.Triangle=n.util.createClass(n.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),n.util.drawDashedLine(t,-e,i,0,-i,this.strokeDashArray),n.util.drawDashedLine(t,0,-i,e,i,this.strokeDashArray),n.util.drawDashedLine(t,e,i,-e,i,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",this.getSvgId(),'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),n.Triangle.fromObject=function(t,e){var i=new n.Triangle(t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),function(t){var r=t.fabric||(t.fabric={}),i=2*Math.PI,o=r.util.object.extend;r.Ellipse?r.warn("fabric.Ellipse is already defined."):(r.Ellipse=r.util.createClass(r.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,n=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',i,'" cy="',n,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),r.Ellipse.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),r.Ellipse.fromElement=function(t,e){e||(e={});var i=r.parseAttributes(t,r.Ellipse.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0;var n=new r.Ellipse(o(i,e));return n.top-=n.ry,n.left-=n.rx,n},r.Ellipse.fromObject=function(t,e){var i=new r.Ellipse(t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),function(t){var o=t.fabric||(t.fabric={}),r=o.util.object.extend;if(o.Rect)o.warn("fabric.Rect is already defined");else{var e=o.Object.prototype.stateProperties.concat();e.push("rx","ry","x","y"),o.Rect=o.util.createClass(o.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1!==this.width||1!==this.height){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,o=this.height,s=e?this.left:-this.width/2,a=e?this.top:-this.height/2,c=0!==i||0!==n,l=.4477152502;t.beginPath(),t.moveTo(s+i,a),t.lineTo(s+r-i,a),c&&t.bezierCurveTo(s+r-l*i,a,s+r,a+l*n,s+r,a+n),t.lineTo(s+r,a+o-n),c&&t.bezierCurveTo(s+r,a+o-l*n,s+r-l*i,a+o,s+r-i,a+o),t.lineTo(s+i,a+o),c&&t.bezierCurveTo(s+l*i,a+o,s,a+o-l*n,s,a+o-n),t.lineTo(s,a+n),c&&t.bezierCurveTo(s,a+l*n,s+l*i,a,s+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.beginPath(),o.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),o.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),o.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),o.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,n=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,n=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),o.Rect.ATTRIBUTE_NAMES=o.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),o.Rect.fromElement=function(t,e){if(!t)return null;e=e||{};var i=o.parseAttributes(t,o.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0;var n=new o.Rect(r(e?o.util.object.clone(e):{},i));return n.visible=n.visible&&0<n.width&&0<n.height,n},o.Rect.fromObject=function(t,e){var i=new o.Rect(t);return e&&e(i),i}}}("undefined"!=typeof exports?exports:this),function(t){var o=t.fabric||(t.fabric={});o.Polyline?o.warn("fabric.Polyline is already defined"):(o.Polyline=o.util.createClass(o.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,e){return o.Polygon.prototype.initialize.call(this,t,e)},_calcDimensions:function(){return o.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return o.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return o.Polygon.prototype.toSVG.call(this,t)},_render:function(t,e){o.Polygon.prototype.commonRender.call(this,t,e)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var e,i;t.beginPath();for(var n=0,r=this.points.length;n<r;n++)e=this.points[n],i=this.points[n+1]||e,o.util.drawDashedLine(t,e.x,e.y,i.x,i.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),o.Polyline.ATTRIBUTE_NAMES=o.SHARED_ATTRIBUTES.concat(),o.Polyline.fromElement=function(t,e){if(!t)return null;e||(e={});var i=o.parsePointsAttribute(t.getAttribute("points")),n=o.parseAttributes(t,o.Polyline.ATTRIBUTE_NAMES);return new o.Polyline(i,o.util.object.extend(n,e))},o.Polyline.fromObject=function(t,e){var i=new o.Polyline(t.points,t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),function(t){var r=t.fabric||(t.fabric={}),o=r.util.object.extend,s=r.util.array.min,a=r.util.array.max,c=r.util.toFixed;r.Polygon?r.warn("fabric.Polygon is already defined"):(r.Polygon=r.util.createClass(r.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=s(t,"x"),i=s(t,"y"),n=a(t,"x"),r=a(t,"y");this.width=n-e||0,this.height=r-i||0,this.minX=e||0,this.minY=i||0},toObject:function(t){return o(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,i=[],n=this._createBaseSVGMarkup(),r=0,o=this.points.length;r<o;r++)i.push(c(this.points[r].x,2),",",c(this.points[r].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),n.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(n.join("")):n.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t,e){var i,n=this.points.length;if(!n||isNaN(this.points[n-1].y))return!1;e||t.translate(-this.pathOffset.x,-this.pathOffset.y),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var r=0;r<n;r++)i=this.points[r],t.lineTo(i.x,i.y);return!0},_renderDashedStroke:function(t){r.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),r.Polygon.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polygon.fromElement=function(t,e){if(!t)return null;e||(e={});var i=r.parsePointsAttribute(t.getAttribute("points")),n=r.parseAttributes(t,r.Polygon.ATTRIBUTE_NAMES);return new r.Polygon(i,o(n,e))},r.Polygon.fromObject=function(t,e){var i=new r.Polygon(t.points,t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),function(t){var m=t.fabric||(t.fabric={}),b=m.util.array.min,y=m.util.array.max,r=m.util.object.extend,n=Object.prototype.toString,g=m.util.drawArc,_={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},x={m:"l",M:"L"};m.Path?m.warn("fabric.Path is already defined"):(m.Path=m.util.createClass(m.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.setOptions(e),t||(t=[]);var i="[object Array]"===n.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e),e.sourcePath&&this.setSourcePath(e.sourcePath))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,o=0,s=0,a=0,c=0,l=0,u=0,h=-this.pathOffset.x,f=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(f=h=0),t.beginPath();for(var d=0,p=this.path.length;d<p;++d){switch((e=this.path[d])[0]){case"l":a+=e[1],c+=e[2],t.lineTo(a+h,c+f);break;case"L":a=e[1],c=e[2],t.lineTo(a+h,c+f);break;case"h":a+=e[1],t.lineTo(a+h,c+f);break;case"H":a=e[1],t.lineTo(a+h,c+f);break;case"v":c+=e[1],t.lineTo(a+h,c+f);break;case"V":c=e[1],t.lineTo(a+h,c+f);break;case"m":o=a+=e[1],s=c+=e[2],t.moveTo(a+h,c+f);break;case"M":o=a=e[1],s=c=e[2],t.moveTo(a+h,c+f);break;case"c":i=a+e[5],n=c+e[6],l=a+e[3],u=c+e[4],t.bezierCurveTo(a+e[1]+h,c+e[2]+f,l+h,u+f,i+h,n+f),a=i,c=n;break;case"C":a=e[5],c=e[6],l=e[3],u=e[4],t.bezierCurveTo(e[1]+h,e[2]+f,l+h,u+f,a+h,c+f);break;case"s":i=a+e[3],n=c+e[4],u=null===r[0].match(/[CcSs]/)?(l=a,c):(l=2*a-l,2*c-u),t.bezierCurveTo(l+h,u+f,a+e[1]+h,c+e[2]+f,i+h,n+f),l=a+e[1],u=c+e[2],a=i,c=n;break;case"S":i=e[3],n=e[4],u=null===r[0].match(/[CcSs]/)?(l=a,c):(l=2*a-l,2*c-u),t.bezierCurveTo(l+h,u+f,e[1]+h,e[2]+f,i+h,n+f),a=i,c=n,l=e[1],u=e[2];break;case"q":i=a+e[3],n=c+e[4],l=a+e[1],u=c+e[2],t.quadraticCurveTo(l+h,u+f,i+h,n+f),a=i,c=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+h,e[2]+f,i+h,n+f),a=i,c=n,l=e[1],u=e[2];break;case"t":i=a+e[1],n=c+e[2],u=null===r[0].match(/[QqTt]/)?(l=a,c):(l=2*a-l,2*c-u),t.quadraticCurveTo(l+h,u+f,i+h,n+f),a=i,c=n;break;case"T":i=e[1],n=e[2],u=null===r[0].match(/[QqTt]/)?(l=a,c):(l=2*a-l,2*c-u),t.quadraticCurveTo(l+h,u+f,i+h,n+f),a=i,c=n;break;case"a":g(t,a+h,c+f,[e[1],e[2],e[3],e[4],e[5],e[6]+a+h,e[7]+c+f]),a+=e[6],c+=e[7];break;case"A":g(t,a+h,c+f,[e[1],e[2],e[3],e[4],e[5],e[6]+h,e[7]+f]),a=e[6],c=e[7];break;case"z":case"Z":a=o,c=s,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n="",r=0,o=this.path.length;r<o;r++)e.push(this.path[r].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(n=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),n,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],a=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c=0,l=this.path.length;c<l;c++){for(n=(t=this.path[c]).slice(1).trim(),s.length=0;i=a.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var u=0,h=s.length;u<h;u++)e=parseFloat(s[u]),isNaN(e)||r.push(e);var f=r[0],d=_[f.toLowerCase()],p=x[f]||f;if(r.length-1>d)for(var g=1,v=r.length;g<v;g+=d)o.push([f].concat(r.slice(g,g+d))),f=p;else o.push(r)}return o},_parseDimensions:function(){for(var t,e,i,n,r=[],o=[],s=null,a=0,c=0,l=0,u=0,h=0,f=0,d=0,p=this.path.length;d<p;++d){switch((t=this.path[d])[0]){case"l":l+=t[1],u+=t[2],n=[];break;case"L":l=t[1],u=t[2],n=[];break;case"h":l+=t[1],n=[];break;case"H":l=t[1],n=[];break;case"v":u+=t[1],n=[];break;case"V":u=t[1],n=[];break;case"m":a=l+=t[1],c=u+=t[2],n=[];break;case"M":a=l=t[1],c=u=t[2],n=[];break;case"c":e=l+t[5],i=u+t[6],h=l+t[3],f=u+t[4],n=m.util.getBoundsOfCurve(l,u,l+t[1],u+t[2],h,f,e,i),l=e,u=i;break;case"C":l=t[5],u=t[6],h=t[3],f=t[4],n=m.util.getBoundsOfCurve(l,u,t[1],t[2],h,f,l,u);break;case"s":e=l+t[3],i=u+t[4],f=null===s[0].match(/[CcSs]/)?(h=l,u):(h=2*l-h,2*u-f),n=m.util.getBoundsOfCurve(l,u,h,f,l+t[1],u+t[2],e,i),h=l+t[1],f=u+t[2],l=e,u=i;break;case"S":e=t[3],i=t[4],f=null===s[0].match(/[CcSs]/)?(h=l,u):(h=2*l-h,2*u-f),n=m.util.getBoundsOfCurve(l,u,h,f,t[1],t[2],e,i),l=e,u=i,h=t[1],f=t[2];break;case"q":e=l+t[3],i=u+t[4],h=l+t[1],f=u+t[2],n=m.util.getBoundsOfCurve(l,u,h,f,h,f,e,i),l=e,u=i;break;case"Q":h=t[1],f=t[2],n=m.util.getBoundsOfCurve(l,u,h,f,h,f,t[3],t[4]),l=t[3],u=t[4];break;case"t":e=l+t[1],i=u+t[2],f=null===s[0].match(/[QqTt]/)?(h=l,u):(h=2*l-h,2*u-f),n=m.util.getBoundsOfCurve(l,u,h,f,h,f,e,i),l=e,u=i;break;case"T":e=t[1],i=t[2],f=null===s[0].match(/[QqTt]/)?(h=l,u):(h=2*l-h,2*u-f),n=m.util.getBoundsOfCurve(l,u,h,f,h,f,e,i),l=e,u=i;break;case"a":n=m.util.getBoundsOfArc(l,u,t[1],t[2],t[3],t[4],t[5],t[6]+l,t[7]+u),l+=t[6],u+=t[7];break;case"A":n=m.util.getBoundsOfArc(l,u,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),l=t[6],u=t[7];break;case"z":case"Z":l=a,u=c}s=t,n.forEach(function(t){r.push(t.x),o.push(t.y)}),r.push(l),o.push(u)}var g=b(r)||0,v=b(o)||0;return{left:g,top:v,width:(y(r)||0)-g,height:(y(o)||0)-v}}}),m.Path.fromObject=function(i,n){var r;if("string"!=typeof i.path)return r=new m.Path(i.path,i),n&&n(r),r;m.loadSVGFromURL(i.path,function(t){var e=i.path;r=t[0],delete i.path,m.util.object.extend(r,i),r.setSourcePath(e),n&&n(r)})},m.Path.ATTRIBUTE_NAMES=m.SHARED_ATTRIBUTES.concat(["d"]),m.Path.fromElement=function(t,e,i){var n=m.parseAttributes(t,m.Path.ATTRIBUTE_NAMES);e&&e(new m.Path(n.d,r(n,i)))},m.Path.async=!0)}("undefined"!=typeof exports?exports:this),function(t){var h=t.fabric||(t.fabric={}),e=h.util.object.extend,i=h.util.array.invoke,n=h.Object.prototype.toObject;h.PathGroup?h.warn("fabric.PathGroup is already defined"):(h.PathGroup=h.util.createClass(h.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var e,i,n,r,o,s,a=[],c=[],l=this.paths.length;l--;){r=(n=this.paths[l]).height+n.strokeWidth,o=n.width+n.strokeWidth,e=[{x:n.left,y:n.top},{x:n.left+o,y:n.top},{x:n.left,y:n.top+r},{x:n.left+o,y:n.top+r}],s=this.paths[l].transformMatrix;for(var u=0;u<e.length;u++)i=e[u],s&&(i=h.util.transformPoint(i,s,!1)),a.push(i.x),c.push(i.y)}t.width=Math.max.apply(null,a),t.height=Math.max.apply(null,c)},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&h.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var e=0,i=this.paths.length;e<i;++e)this.paths[e].render(t,!0);this.clipTo&&t.restore(),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){return e(n.call(this,["sourcePath"].concat(t)),{paths:i(this.getObjects(),"toObject",t)})},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){var e=this.getObjects(),i=this.getPointByOrigin("left","top"),n="translate("+i.x+" "+i.y+")",r=this._createBaseSVGMarkup();r.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n");for(var o=0,s=e.length;o<s;o++)r.push("\t",e[o].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var i=this.getObjects()[0].get("fill")||"";return"string"==typeof i&&(i=i.toLowerCase(),this.getObjects().every(function(t){var e=t.get("fill")||"";return"string"==typeof e&&e.toLowerCase()===i}))},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),h.PathGroup.fromObject=function(n,r){"string"==typeof n.paths?h.loadSVGFromURL(n.paths,function(t){var e=n.paths;delete n.paths;var i=h.util.groupSVGElements(t,n,e);r(i)}):h.util.enlivenObjects(n.paths,function(t){delete n.paths,r(new h.PathGroup(t,n))})},h.PathGroup.async=!0)}("undefined"!=typeof exports?exports:this),function(t){var a=t.fabric||(t.fabric={}),e=a.util.object.extend,c=a.util.array.min,l=a.util.array.max,i=a.util.array.invoke;if(!a.Group){var n={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){if(t.__origHasControls=t.hasControls,t.hasControls=!1,!e){var i=t.getLeft(),n=t.getTop(),r=this.getCenterPoint();t.set({originalLeft:i,originalTop:n,left:i-r.x,top:n-r.y}),t.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),a.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){return e(this.callSuper("toObject",t),{objects:i(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&a.util.clipContext(this,t),this._transformDone=!0;for(var e=0,i=this._objects.length;e<i;e++)this._renderObject(this._objects[e],t);this.clipTo&&t.restore(),t.restore(),this._transformDone=!1}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;i<n;i++)this._objects[i]._renderControls(t)},_renderObject:function(t,e){if(t.visible){var i=t.hasRotatingPoint;t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var e=t.calcTransformMatrix(),i=a.util.qrDecompose(e),n=new a.Point(i.translateX,i.translateY);return t.scaleX=i.scaleX,t.scaleY=i.scaleY,t.skewX=i.skewX,t.skewY=i.skewY,t.angle=i.angle,t.flipX=!1,t.flipY=!1,t.setPositionByOrigin(n,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),delete t.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_calcBounds:function(t){for(var e,i,n,r=[],o=[],s=["tr","br","bl","tl"],a=0,c=this._objects.length,l=s.length;a<c;++a)for((e=this._objects[a]).setCoords(),n=0;n<l;n++)i=s[n],r.push(e.oCoords[i].x),o.push(e.oCoords[i].y);this.set(this._getBounds(r,o,t))},_getBounds:function(t,e,i){var n=a.util.invertTransform(this.getViewportTransform()),r=a.util.transformPoint(new a.Point(c(t),c(e)),n),o=a.util.transformPoint(new a.Point(l(t),l(e)),n),s={width:o.x-r.x||0,height:o.y-r.y||0};return i||(s.left=r.x||0,s.top=r.y||0,"center"===this.originX&&(s.left+=s.width/2),"right"===this.originX&&(s.left+=s.width),"center"===this.originY&&(s.top+=s.height/2),"bottom"===this.originY&&(s.top+=s.height)),s},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in n){if(this[t])return this[t];for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),a.Group.fromObject=function(e,i){a.util.enlivenObjects(e.objects,function(t){delete e.objects,i&&i(new a.Group(t,e,!0))})},a.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(t){var s=fabric.util.object.extend;if(t.fabric||(t.fabric={}),t.fabric.Image)fabric.warn("fabric.Image is already defined.");else{var e=fabric.Object.prototype.stateProperties.concat();e.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:e,initialize:function(t,e,i){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e,i)},getElement:function(){return this._element},setElement:function(t,e,i){var n,r;return this._element=t,this._originalElement=t,this._initConfig(i),n=0===this.resizeFilters.length?e:(r=this,function(){r.applyFilters(e,r.resizeFilters,r._filteredEl||r._originalElement,!0)}),0!==this.filters.length?this.applyFilters(n):n&&n(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var e=[],i=[],n=1,r=1;this.filters.forEach(function(t){t&&("Resize"===t.type&&(n*=t.scaleX,r*=t.scaleY),e.push(t.toObject()))}),this.resizeFilters.forEach(function(t){t&&i.push(t.toObject())});var o=s(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:e,resizeFilters:i});return o.width/=n,o.height/=r,o},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,n=-this.height/2,r="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,n=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(r="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i,'" y="',n,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',r,'"',"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=o}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var e=t?this._element:this._originalElement;return e?fabric.isLikelyNode?e._src:e.src:this.src||""},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,i,n){if(e=e||this.filters,i=i||this._originalElement){var r,o,s=fabric.util.createImage(),a=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,c=this.minimumScaleTrigger/a,l=this;if(0===e.length)return this._element=i,t&&t(this),i;var u=fabric.util.createCanvasElement();return u.width=i.width,u.height=i.height,u.getContext("2d").drawImage(i,0,0,i.width,i.height),e.forEach(function(t){t&&(n?(r=l.scaleX<c?l.scaleX:1,o=l.scaleY<c?l.scaleY:1,r*a<1&&(r*=a),o*a<1&&(o*=a)):(r=t.scaleX,o=t.scaleY),t.applyTo(u,r,o),n||"Resize"!==t.type||(l.width*=t.scaleX,l.height*=t.scaleY))}),s.width=u.width,s.height=u.height,fabric.isLikelyNode?(s.src=u.toBuffer(void 0,fabric.Image.pngCompression),l._element=s,n||(l._filteredEl=s),t&&t(l)):(s.onload=function(){l._element=s,n||(l._filteredEl=s),t&&t(l),s.onload=u=null},s.src=u.toDataURL("image/png")),u}},_render:function(t,e){var i,n,r,o=this._findMargins();i=e?this.left:-this.width/2,n=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,n,this.width,this.height),t.clip()),(r=!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):this._element)&&t.drawImage(r,i+o.marginX,n+o.marginY,o.width,o.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,n=this.height,r=0,o=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,n=this._element.height*e,"Mid"===this.alignX&&(r=(this.width-i)/2),"Max"===this.alignX&&(r=this.width-i),"Mid"===this.alignY&&(o=(this.height-n)/2),"Max"===this.alignY&&(o=this.height-n)),{width:i,height:n,marginX:r,marginY:o}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e,i){this.setElement(fabric.util.getById(t),i,e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(i,n){fabric.util.loadImage(i.src,function(e){fabric.Image.prototype._initFilters.call(i,i.filters,function(t){i.filters=t||[],fabric.Image.prototype._initFilters.call(i,i.resizeFilters,function(t){return i.resizeFilters=t||[],new fabric.Image(e,i,n)})})},null,i.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,e,i){var n,r=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);r.preserveAspectRatio&&(n=fabric.util.parsePreserveAspectRatioAttribute(r.preserveAspectRatio),s(r,n)),fabric.Image.fromURL(r["xlink:href"],e,s(i?fabric.util.object.clone(i):{},r))},fabric.Image.async=!0,fabric.Image.pngCompression=1}}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return 0<t?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){function e(){}var i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Brightness=r(n.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.brightness,o=0,s=n.length;o<s;o+=4)n[o]+=r,n[o+1]+=r,n[o+2]+=r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,i,n,r,o,s,a,c,l,u=this.matrix,h=t.getContext("2d"),f=h.getImageData(0,0,t.width,t.height),d=Math.round(Math.sqrt(u.length)),p=Math.floor(d/2),g=f.data,v=f.width,m=f.height,b=h.createImageData(v,m),y=b.data,_=this.opaque?1:0,x=0;x<m;x++)for(var C=0;C<v;C++){o=4*(x*v+C);for(var w=r=n=i=e=0;w<d;w++)for(var S=0;S<d;S++)s=C+S-p,(a=x+w-p)<0||m<a||s<0||v<s||(c=4*(a*v+s),l=u[w*d+S],e+=g[c]*l,i+=g[1+c]*l,n+=g[2+c]*l,r+=g[3+c]*l);y[o]=e,y[1+o]=i,y[2+o]=n,y[3+o]=r+_*(255-r)}h.putImageData(b,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.GradientTransparency=r(n.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.threshold,o=n.length,s=0,a=n.length;s<a;s+=4)n[s+3]=r+255*(o-s)/o;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=n.width*n.height*4,s=0;s<o;)e=(r[s]+r[s+1]+r[s+2])/3,r[s]=e,r[s+1]=e,r[s+2]=e,s+=4;i.putImageData(n,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=r.length;for(e=0;e<o;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];i.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(t){var u=t.fabric||(t.fabric={}),e=u.util.object.extend,i=u.Image.filters,n=u.util.createClass;i.Mask=n(i.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=-1<[0,1,2,3].indexOf(t.channel)?t.channel:0},applyTo:function(t){if(this.mask){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.mask.getElement(),s=u.util.createCanvasElement(),a=this.channel,c=n.width*n.height*4;s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(o,0,0,t.width,t.height);var l=s.getContext("2d").getImageData(0,0,t.width,t.height).data;for(e=0;e<c;e+=4)r[e+3]=l[e+a];i.putImageData(n,0,0)}},toObject:function(){return e(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),u.Image.filters.Mask.fromObject=function(e,i){u.util.loadImage(e.mask.src,function(t){e.mask=new u.Image(t,e.mask),i&&i(new u.Image.filters.Mask(e))})},u.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.noise,s=0,a=r.length;s<a;s+=4)e=(.5-Math.random())*o,r[s]+=e,r[s+1]+=e,r[s+2]+=e;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Pixelate=r(n.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,o,s,a,c=t.getContext("2d"),l=c.getImageData(0,0,t.width,t.height),u=l.data,h=l.height,f=l.width;for(i=0;i<h;i+=this.blocksize)for(n=0;n<f;n+=this.blocksize){r=u[e=4*i*f+4*n],o=u[e+1],s=u[e+2],a=u[e+3];for(var d=i,p=i+this.blocksize;d<p;d++)for(var g=n,v=n+this.blocksize;g<v;g++)u[e=4*d*f+4*g]=r,u[e+1]=o,u[e+2]=s,u[e+3]=a}c.putImageData(l,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveWhite=r(n.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,n,r=t.getContext("2d"),o=r.getImageData(0,0,t.width,t.height),s=o.data,a=this.threshold,c=this.distance,l=255-a,u=Math.abs,h=0,f=s.length;h<f;h+=4)e=s[h],i=s[h+1],n=s[h+2],l<e&&l<i&&l<n&&u(e-i)<c&&u(e-n)<c&&u(i-n)<c&&(s[h+3]=0);r.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia=n(i.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=o.length;for(e=0;e<s;e+=4)i=.3*o[e]+.59*o[e+1]+.11*o[e+2],o[e]=100+i,o[e+1]=50+i,o[e+2]=255+i;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Sepia2=n(i.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,n,r,o=t.getContext("2d"),s=o.getImageData(0,0,t.width,t.height),a=s.data,c=a.length;for(e=0;e<c;e+=4)i=a[e],n=a[e+1],r=a[e+2],a[e]=(.393*i+.769*n+.189*r)/1.351,a[e+1]=(.349*i+.686*n+.168*r)/1.203,a[e+2]=(.272*i+.534*n+.131*r)/2.14;o.putImageData(s,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(t){var p=t.fabric||(t.fabric={}),e=p.util.object.extend,i=p.Image.filters,n=p.util.createClass;i.Tint=n(i.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new p.Color(this.color).getAlpha()},applyTo:function(t){var e,i,n,r,o,s,a,c,l,u=t.getContext("2d"),h=u.getImageData(0,0,t.width,t.height),f=h.data,d=f.length;for(i=(l=new p.Color(this.color).getSource())[0]*this.opacity,n=l[1]*this.opacity,r=l[2]*this.opacity,c=1-this.opacity,e=0;e<d;e+=4)o=f[e],s=f[e+1],a=f[e+2],f[e]=i+o*c,f[e+1]=n+s*c,f[e+2]=r+a*c;u.putImageData(h,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),p.Image.filters.Tint.fromObject=function(t){return new p.Image.filters.Tint(t)}}("undefined"!=typeof exports?exports:this),function(t){var a=t.fabric||(t.fabric={}),e=a.util.object.extend,i=a.Image.filters,n=a.util.createClass;i.Multiply=n(i.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),o=r.data,s=o.length;for(i=new a.Color(this.color).getSource(),e=0;e<s;e+=4)o[e]*=i[0]/255,o[e+1]*=i[1]/255,o[e+2]*=i[2]/255;n.putImageData(r,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color})}}),a.Image.filters.Multiply.fromObject=function(t){return new a.Image.filters.Multiply(t)}}("undefined"!=typeof exports?exports:this),function(t){var y=t.fabric,e=y.Image.filters,i=y.util.createClass;e.Blend=i(e.BaseFilter,{type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var e,i,n,r,o,s,a,c,l,u,h=t.getContext("2d"),f=h.getImageData(0,0,t.width,t.height),d=f.data,p=!1;if(this.image){p=!0;var g=y.util.createCanvasElement();g.width=this.image.width,g.height=this.image.height;var v=new y.StaticCanvas(g);v.add(this.image),u=v.getContext("2d").getImageData(0,0,v.width,v.height).data}else e=(u=new y.Color(this.color).getSource())[0]*this.alpha,i=u[1]*this.alpha,n=u[2]*this.alpha;for(var m=0,b=d.length;m<b;m+=4)switch(r=d[m],o=d[m+1],s=d[m+2],p&&(e=u[m]*this.alpha,i=u[m+1]*this.alpha,n=u[m+2]*this.alpha),this.mode){case"multiply":d[m]=r*e/255,d[m+1]=o*i/255,d[m+2]=s*n/255;break;case"screen":d[m]=1-(1-r)*(1-e),d[m+1]=1-(1-o)*(1-i),d[m+2]=1-(1-s)*(1-n);break;case"add":d[m]=Math.min(255,r+e),d[m+1]=Math.min(255,o+i),d[m+2]=Math.min(255,s+n);break;case"diff":case"difference":d[m]=Math.abs(r-e),d[m+1]=Math.abs(o-i),d[m+2]=Math.abs(s-n);break;case"subtract":a=r-e,c=o-i,l=s-n,d[m]=a<0?0:a,d[m+1]=c<0?0:c,d[m+2]=l<0?0:l;break;case"darken":d[m]=Math.min(r,e),d[m+1]=Math.min(o,i),d[m+2]=Math.min(s,n);break;case"lighten":d[m]=Math.max(r,e),d[m+1]=Math.max(o,i),d[m+2]=Math.max(s,n)}h.putImageData(f,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),y.Image.filters.Blend.fromObject=function(t){return new y.Image.filters.Blend(t)}}("undefined"!=typeof exports?exports:this),function(t){var m=t.fabric||(t.fabric={}),P=Math.pow,A=Math.floor,I=Math.sqrt,D=Math.abs,b=Math.max,c=Math.round,r=Math.sin,L=Math.ceil,e=m.Image.filters,i=m.util.createClass;e.Resize=i(e.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){if(1!==e||1!==i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var n,r=t.width,o=t.height,s=c(r*e),a=c(o*i);"sliceHack"===this.resizeType&&(n=this.sliceByTwo(t,r,o,s,a)),"hermite"===this.resizeType&&(n=this.hermiteFastResize(t,r,o,s,a)),"bilinear"===this.resizeType&&(n=this.bilinearFiltering(t,r,o,s,a)),"lanczos"===this.resizeType&&(n=this.lanczosResize(t,r,o,s,a)),t.width=s,t.height=a,t.getContext("2d").putImageData(n,0,0)}},sliceByTwo:function(t,e,i,n,r){var o,s=t.getContext("2d"),a=.5,c=.5,l=1,u=1,h=!1,f=!1,d=e,p=i,g=m.util.createCanvasElement(),v=g.getContext("2d");for(n=A(n),r=A(r),g.width=b(n,e),g.height=b(r,i),e<n&&(a=2,l=-1),i<r&&(c=2,u=-1),o=s.getImageData(0,0,e,i),t.width=b(n,e),t.height=b(r,i),s.putImageData(o,0,0);!h||!f;)i=p,n*l<A((e=d)*a*l)?d=A(d*a):(d=n,h=!0),r*u<A(p*c*u)?p=A(p*c):(p=r,f=!0),o=s.getImageData(0,0,e,i),v.putImageData(o,0,0),s.clearRect(0,0,d,p),s.drawImage(g,0,0,e,i,0,0,d,p);return s.getImageData(0,0,n,r)},lanczosResize:function(t,p,g,v,m){var i,e=t.getContext("2d"),n=e.getImageData(0,0,p,g),b=e.getImageData(0,0,v,m),y=n.data,_=b.data,x=(i=this.lanczosLobes,function(t){if(i<t)return 0;if(t*=Math.PI,D(t)<1e-16)return 1;var e=t/i;return r(t)*r(e)/t/e}),C=this.rcpScaleX,w=this.rcpScaleY,S=2/this.rcpScaleX,k=2/this.rcpScaleY,O=L(C*this.lanczosLobes/2),E=L(w*this.lanczosLobes/2),T={},j={},M={};return function t(e){var i,n,r,o,s,a,c,l,u,h,f;for(j.x=(e+.5)*C,M.x=A(j.x),i=0;i<m;i++){for(j.y=(i+.5)*w,M.y=A(j.y),u=l=c=a=s=0,n=M.x-O;n<=M.x+O;n++)if(!(n<0||p<=n)){h=A(1e3*D(n-j.x)),T[h]||(T[h]={});for(var d=M.y-E;d<=M.y+E;d++)d<0||g<=d||(f=A(1e3*D(d-j.y)),T[h][f]||(T[h][f]=x(I(P(h*S,2)+P(f*k,2))/1e3)),0<(r=T[h][f])&&(s+=r,a+=r*y[o=4*(d*p+n)],c+=r*y[o+1],l+=r*y[o+2],u+=r*y[o+3]))}_[o=4*(i*v+e)]=a/s,_[o+1]=c/s,_[o+2]=l/s,_[o+3]=u/s}return++e<v?t(e):b}(0)},bilinearFiltering:function(t,e,i,n,r){var o,s,a,c,l,u,h,f,d,p=0,g=this.rcpScaleX,v=this.rcpScaleY,m=t.getContext("2d"),b=4*(e-1),y=m.getImageData(0,0,e,i).data,_=m.getImageData(0,0,n,r),x=_.data;for(a=0;a<r;a++)for(c=0;c<n;c++)for(l=g*c-(o=A(g*c)),u=v*a-(s=A(v*a)),d=4*(s*e+o),h=0;h<4;h++)f=y[d+h]*(1-l)*(1-u)+y[4+d+h]*l*(1-u)+y[d+b+h]*u*(1-l)+y[d+b+4+h]*l*u,x[p++]=f;return _},hermiteFastResize:function(t,e,i,n,r){for(var o=this.rcpScaleX,s=this.rcpScaleY,a=L(o/2),c=L(s/2),l=t.getContext("2d"),u=l.getImageData(0,0,e,i).data,h=l.getImageData(0,0,n,r),f=h.data,d=0;d<r;d++)for(var p=0;p<n;p++){for(var g=4*(p+d*n),v=0,m=0,b=0,y=0,_=0,x=0,C=0,w=(d+.5)*s,S=A(d*s);S<(d+1)*s;S++)for(var k=D(w-(S+.5))/c,O=(p+.5)*o,E=k*k,T=A(p*o);T<(p+1)*o;T++){var j=D(O-(T+.5))/a,M=I(E+j*j);1<M&&M<-1||0<(v=2*M*M*M-3*M*M+1)&&(C+=v*u[(j=4*(T+S*e))+3],b+=v,u[j+3]<255&&(v=v*u[j+3]/250),y+=v*u[j],_+=v*u[j+1],x+=v*u[j+2],m+=v)}f[g]=y/m,f[1+g]=_/m,f[2+g]=x/m,f[3+g]=C/b}return h},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),m.Image.filters.Resize.fromObject=function(t){return new m.Image.filters.Resize(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.ColorMatrix=r(n.BaseFilter,{type:"ColorMatrix",initialize:function(t){t||(t={}),this.matrix=t.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){var e,i,n,r,o,s=t.getContext("2d"),a=s.getImageData(0,0,t.width,t.height),c=a.data,l=c.length,u=this.matrix;for(e=0;e<l;e+=4)i=c[e],n=c[e+1],r=c[e+2],o=c[e+3],c[e]=i*u[0]+n*u[1]+r*u[2]+o*u[3]+u[4],c[e+1]=i*u[5]+n*u[6]+r*u[7]+o*u[8]+u[9],c[e+2]=i*u[10]+n*u[11]+r*u[12]+o*u[13]+u[14],c[e+3]=i*u[15]+n*u[16]+r*u[17]+o*u[18]+u[19];s.putImageData(a,0,0)},toObject:function(){return i(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(t){return new e.Image.filters.ColorMatrix(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Contrast=r(n.BaseFilter,{type:"Contrast",initialize:function(t){t=t||{},this.contrast=t.contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=259*(this.contrast+255)/(255*(259-this.contrast)),o=0,s=n.length;o<s;o+=4)n[o]=r*(n[o]-128)+128,n[o+1]=r*(n[o+1]-128)+128,n[o+2]=r*(n[o+2]-128)+128;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(t){return new e.Image.filters.Contrast(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Saturate=r(n.BaseFilter,{type:"Saturate",initialize:function(t){t=t||{},this.saturate=t.saturate||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=.01*-this.saturate,s=0,a=r.length;s<a;s+=4)e=Math.max(r[s],r[s+1],r[s+2]),r[s]+=e!==r[s]?(e-r[s])*o:0,r[s+1]+=e!==r[s+1]?(e-r[s+1])*o:0,r[s+2]+=e!==r[s+2]?(e-r[s+2])*o:0;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(t){return new e.Image.filters.Saturate(t)}}("undefined"!=typeof exports?exports:this),function(t){var d=t.fabric||(t.fabric={}),n=d.util.object.clone,p=d.util.toFixed,g=d.Object.NUM_FRACTION_DIGITS;if(d.Text)d.warn("fabric.Text is already defined");else{var e=d.Object.prototype.stateProperties.concat();e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),d.Text=d.util.createClass(d.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,text:!0,charSpacing:!0,textAlign:!0,strokeWidth:!1},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:e,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){this.__skipDimension||(t||(t=d.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&d.util.clipContext(this,t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;i<n;i++){var r=this._getLineWidth(t,i);e<r&&(e=r)}return e},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(t,e,i,n,r){var o,s,a=t.slice(0,-4);if(this[a].toLive){var c=-this.width/2+this[a].offsetX||0,l=-this.height/2+this[a].offsetY||0;e.save(),e.translate(c,l),n-=c,r-=l}if(0!==this.charSpacing)for(var u=this._getWidthOfCharSpacing(),h=0,f=(i=i.split("")).length;h<f;h++)o=i[h],s=e.measureText(o).width+u,e[t](o,n,r),n+=0<s?s:0;else e[t](i,n,r);this[a].toLive&&e.restore()},_renderTextLine:function(t,e,i,n,r,o){r-=this.fontSize*this._fontSizeFraction;var s=this._getLineWidth(e,o);if("justify"!==this.textAlign||this.width<s)this._renderChars(t,e,i,n,r,o);else for(var a,c=i.split(/\s+/),l=0,u=this._getWidthOfWords(e,c.join(" "),o,0),h=this.width-u,f=c.length-1,d=0<f?h/f:0,p=0,g=0,v=c.length;g<v;g++){for(;" "===i[l]&&l<i.length;)l++;a=c[g],this._renderChars(t,e,a,n+p,r,o,l),p+=this._getWidthOfWords(e,a,o,l)+d,l+=a.length}},_getWidthOfWords:function(t,e){var i=t.measureText(e).width;return 0!==this.charSpacing&&(i+=e.split("").length*this._getWidthOfCharSpacing()),0<i?i:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),o=0,s=this._textLines.length;o<s;o++){var a=this._getHeightOfLine(t,o),c=a/this.lineHeight,l=this._getLineWidth(t,o),u=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[o],n+u,r+i+c,o),i+=a}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokedashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextBackground:function(t){this._renderBackground(t),this._renderTextLinesBackground(t)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,i,n,r=0;t.fillStyle=this.textBackgroundColor;for(var o=0,s=this._textLines.length;o<s;o++)e=this._getHeightOfLine(t,o),0<(i=this._getLineWidth(t,o))&&(n=this._getLineLeftOffset(i),t.fillRect(this._getLeftOffset()+n,this._getTopOffset()+r,i,e/this.lineHeight)),r+=e;this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearCache:function(){var t=!1;if(this._forceClearCache)return!(this._forceClearCache=!1);for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){if(this.__lineWidths[e])return-1===this.__lineWidths[e]?this.width:this.__lineWidths[e];var i,n=this._textLines[e];return i=""===n?0:this._measureLine(t,e),(this.__lineWidths[e]=i)&&"justify"===this.textAlign&&1<n.split(/\s+/).length&&(this.__lineWidths[e]=-1),i},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var i,n=this._textLines[e],r=t.measureText(n).width,o=0;return 0!==this.charSpacing&&(o=(n.split("").length-1)*this._getWidthOfCharSpacing()),0<(i=r+o)?i:0},_renderTextDecoration:function(l){if(this.textDecoration){var u=this.height/2,h=this,t=[];-1<this.textDecoration.indexOf("underline")&&t.push(.85),-1<this.textDecoration.indexOf("line-through")&&t.push(.43),-1<this.textDecoration.indexOf("overline")&&t.push(-.12),0<t.length&&function(t){var e,i,n,r,o,s,a,c=0;for(e=0,i=h._textLines.length;e<i;e++){for(o=h._getLineWidth(l,e),s=h._getLineLeftOffset(o),a=h._getHeightOfLine(l,e),n=0,r=t.length;n<r;n++)l.fillRect(h._getLeftOffset()+s,c+(h._fontSizeMult-1+t[n])*h.fontSize-u,o,h.fontSize/15);c+=a}}(t)}},_getFontDeclaration:function(){return[d.isLikelyNode?this.fontWeight:this.fontStyle,d.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",d.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),this.drawSelectionBackground(t),e||this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",e)},toSVG:function(t){this.ctx||(this.ctx=d.util.createCanvasElement().getContext("2d"));var e=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(this.ctx),n=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e,n),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),n=""===i?"":' style="'+i+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',n,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],n=[],r=0;this._setSVGBg(n);for(var o=0,s=this._textLines.length;o<s;o++)this.textBackgroundColor&&this._setSVGTextLineBg(n,o,e,t,r),this._setSVGTextLineText(o,i,r,e,t,n),r+=this._getHeightOfLine(this.ctx,o);return{textSpans:i,textBgRects:n}},_setSVGTextLineText:function(t,e,i,n,r){var o=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-r+i-this.height/2;"justify"!==this.textAlign?e.push('\t\t\t<tspan x="',p(n+this._getLineLeftOffset(this._getLineWidth(this.ctx,t)),g),'" ','y="',p(o,g),'" ',this._getFillAttributes(this.fill),">",d.util.string.escapeXml(this._textLines[t]),"</tspan>\n"):this._setSVGTextLineJustifed(t,e,o,n)},_setSVGTextLineJustifed:function(t,e,i,n){var r=d.util.createCanvasElement().getContext("2d");this._setTextStyles(r);var o,s,a=this._textLines[t].split(/\s+/),c=this._getWidthOfWords(r,a.join("")),l=this.width-c,u=a.length-1,h=0<u?l/u:0,f=this._getFillAttributes(this.fill);for(n+=this._getLineLeftOffset(this._getLineWidth(r,t)),t=0,s=a.length;t<s;t++)o=a[t],e.push('\t\t\t<tspan x="',p(n,g),'" ','y="',p(i,g),'" ',f,">",d.util.string.escapeXml(o),"</tspan>\n"),n+=this._getWidthOfWords(r,o)+h},_setSVGTextLineBg:function(t,e,i,n,r){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',p(i+this._getLineLeftOffset(this._getLineWidth(this.ctx,e)),g),'" y="',p(r-this.height/2,g),'" width="',p(this._getLineWidth(this.ctx,e),g),'" height="',p(this._getHeightOfLine(this.ctx,e)/this.lineHeight,g),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',p(-this.width/2,g),'" y="',p(-this.height/2,g),'" width="',p(this.width,g),'" height="',p(this.height,g),'"></rect>\n')},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new d.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),d.Text.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),d.Text.DEFAULT_SVG_FONT_SIZE=16,d.Text.fromElement=function(t,e){if(!t)return null;var i=d.parseAttributes(t,d.Text.ATTRIBUTE_NAMES);(e=d.util.object.extend(e?d.util.object.clone(e):{},i)).top=e.top||0,e.left=e.left||0,"dx"in i&&(e.left+=i.dx),"dy"in i&&(e.top+=i.dy),"fontSize"in e||(e.fontSize=d.Text.DEFAULT_SVG_FONT_SIZE),e.originX||(e.originX="left");var n="";"textContent"in t?n=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(n=t.firstChild.data),n=n.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var r=new d.Text(n,e),o=r.getHeight()/r.height,s=((r.height+r.strokeWidth)*r.lineHeight-r.height)*o,a=r.getHeight()+s,c=0;return"left"===r.originX&&(c=r.getWidth()/2),"right"===r.originX&&(c=-r.getWidth()/2),r.set({left:r.getLeft()+c,top:r.getTop()-a/2+r.fontSize*(.18+r._fontSizeFraction)/r.lineHeight}),r},d.Text.fromObject=function(t,e){var i=new d.Text(t.text,n(t));return e&&e(i),i},d.util.createAccessors(d.Text)}}("undefined"!=typeof exports?exports:this),function(){var h=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(t,e){this.styles=e&&e.styles||{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;n<e;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this._getStyleDeclaration(r.lineIndex,r.charIndex)||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop;t.save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var t,e,i=this.text.split("");this.canvas&&this.canvas.contextTop?((e=this.canvas.contextTop).save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e)):(e=this.ctx).save(),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fontSize?i.fontSize:this.fontSize},getCurrentCharColor:function(t,e){var i=this._getStyleDeclaration(t,0===e?0:e-1);return i&&i.fill?i.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:i,top:n,leftOffset:r.left+r.lineLeft,topOffset:r.top}},_getCursorBoundariesOffsets:function(t,e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var i,n=0,r=0,o=0,s=0,a=0,c=0;c<this.selectionStart;c++)"\n"===t[c]?(a=0,s+=this._getHeightOfLine(this.ctx,r),r++,o=0):(a+=this._getWidthOfChar(this.ctx,t[c],r,o),o++),n=this._getLineLeftOffset(this._getLineWidth(this.ctx,r));return"cursor"===e&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r)/this.lineHeight-this.getCurrentCharFontSize(r,o)*(1-this._fontSizeFraction)),0!==this.charSpacing&&o===this._textLines[r].length&&(a-=this._getWidthOfCharSpacing()),i={top:s,left:0<a?a:0,lineLeft:n},this.cursorOffsetCache=i,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(e,n)):t.leftOffset,a=this.scaleX*this.canvas.getZoom(),c=this.cursorWidth/a;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s-c/2,t.top+t.topOffset,c,o)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),o=n.lineIndex,s=r.lineIndex,a=o;a<=s;a++){var c,l=this._getLineLeftOffset(this._getLineWidth(i,a))||0,u=this._getHeightOfLine(this.ctx,a),h=0,f=this._textLines[a];if(a===o){for(var d=0,p=f.length;d<p;d++)d>=n.charIndex&&(a!==s||d<r.charIndex)&&(h+=this._getWidthOfChar(i,f[d],a,d)),d<n.charIndex&&(l+=this._getWidthOfChar(i,f[d],a,d));d===f.length&&(h-=this._getWidthOfCharSpacing())}else if(o<a&&a<s)h+=this._getLineWidth(i,a)||5;else if(a===s){for(var g=0,v=r.charIndex;g<v;g++)h+=this._getWidthOfChar(i,f[g],a,g);r.charIndex===f.length&&(h-=this._getWidthOfCharSpacing())}c=u,(this.lineHeight<1||a===s&&1<this.lineHeight)&&(u/=this.lineHeight),i.fillRect(e.left+l,e.top+e.topOffset,0<h?h:0,u),e.topOffset+=c}},_renderChars:function(t,e,i,n,r,o,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);s=s||0;var a,c,l=this._getHeightOfLine(e,o),u="";e.save(),r-=l/this.lineHeight*this._fontSizeFraction;for(var h=s,f=i.length+s;h<=f;h++)a=a||this.getCurrentCharStyle(o,h),c=this.getCurrentCharStyle(o,h+1),!this._hasStyleChanged(a,c)&&h!==f||(this._renderChar(t,e,o,h-1,u,n,r,l),u="",a=c),u+=i[h-s];e.restore()},_renderCharsFast:function(t,e,i,n,r){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,o,s,a){var c,l,u,h,f,d,p,g,v,m=this._getStyleDeclaration(i,n);if(m?(l=this._getHeightOfChar(e,r,i,n),h=m.stroke,u=m.fill,d=m.textDecoration):l=this.fontSize,h=(h||this.stroke)&&"strokeText"===t,u=(u||this.fill)&&"fillText"===t,m&&e.save(),c=this._applyCharStylesGetWidth(e,r,i,n,m||null),d=d||this.textDecoration,m&&m.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing){g=this._getWidthOfCharSpacing();for(var b,y=c=0,_=(p=r.split("")).length;y<_;y++)b=p[y],u&&e.fillText(b,o+c,s),h&&e.strokeText(b,o+c,s),c+=0<(v=e.measureText(b).width+g)?v:0}else u&&e.fillText(r,o,s),h&&e.strokeText(r,o,s);!d&&""===d||(f=this._fontSizeFraction*a/this.lineHeight,this._renderCharDecoration(e,d,o,s,f,c,l)),m&&e.restore(),e.translate(c,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,o,s){if(e){var a,c,l=s/15,u={underline:n+s/10,"line-through":n-s*(this._fontSizeFraction+this._fontSizeMult-1)+l,overline:n-(this._fontSizeMult-this._fontSizeFraction)*s},h=["underline","line-through","overline"];for(a=0;a<h.length;a++)c=h[a],-1<e.indexOf(c)&&t.fillRect(i,u[c],o,l)}},_renderTextLine:function(t,e,i,n,r,o){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,n,r,o)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);for(var e,i,n,r,o,s,a=0,c=this._getLeftOffset(),l=this._getTopOffset(),u=0,h=this._textLines.length;u<h;u++)if(e=this._getHeightOfLine(t,u),""!==(r=this._textLines[u])&&this.styles&&this._getLineStyle(u)){i=this._getLineWidth(t,u),n=this._getLineLeftOffset(i);for(var f=0,d=r.length;f<d;f++)(s=this._getStyleDeclaration(u,f))&&s.textBackgroundColor&&(o=r[f],t.fillStyle=s.textBackgroundColor,t.fillRect(c+n+this._getWidthOfCharsAt(t,u,f),l+a,this._getWidthOfChar(t,o,u,f),e/this.lineHeight));a+=e}else a+=e},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(t,e,i,n,r){var o,s,a,c=r||this._getStyleDeclaration(i,n),l=h(c);if(this._applyFontStyles(l),a=this._getFontCache(l.fontFamily),s=this._getCacheProp(e,l),!c&&a[s]&&this.caching)return a[s];"string"==typeof l.shadow&&(l.shadow=new fabric.Shadow(l.shadow));var u=l.fill||this.fill;return t.fillStyle=u.toLive?u.toLive(t,this):u,l.stroke&&(t.strokeStyle=l.stroke&&l.stroke.toLive?l.stroke.toLive(t,this):l.stroke),t.lineWidth=l.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(l),l.shadow&&(l.scaleX=this.scaleX,l.scaleY=this.scaleY,l.canvas=this.canvas,l.getObjectScaling=this.getObjectScaling,this._setShadow.call(l,t)),this.caching&&a[s]?a[s]:(o=t.measureText(e).width,this.caching&&(a[s]=o),o)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,e,i){return i?this.styles[t]&&this.styles[t][e]?h(this.styles[t][e]):{}:this.styles[t]&&this.styles[t][e]?this.styles[t][e]:null},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,i,n){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,i);t.save();var r=this._applyCharStylesGetWidth(t,e,i,n);return 0!==this.charSpacing&&(r+=this._getWidthOfCharSpacing()),t.restore(),0<r?r:0},_getHeightOfChar:function(t,e,i){var n=this._getStyleDeclaration(e,i);return n&&n.fontSize?n.fontSize:this.fontSize},_getWidthOfCharsAt:function(t,e,i){var n,r,o=0;for(n=0;n<i;n++)r=this._textLines[e][n],o+=this._getWidthOfChar(t,r,e,n);return o},_measureLine:function(t,e){this._isMeasuring=!0;var i=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(i-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,0<i?i:0},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],n=this._getWidthOfWords(t,i,e,0),r=this.width-n,o=i.length-i.replace(this._reSpacesAndTabs,"").length,s=Math.max(r/o,t.measureText(" ").width);return this.__widthOfSpace[e]=s},_getWidthOfWords:function(t,e,i,n){for(var r=0,o=0;o<e.length;o++){var s=e[o];s.match(/\s/)||(r+=this._getWidthOfChar(t,s,i,o+n))}return r},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],n=this._getHeightOfChar(t,e,0),r=1,o=i.length;r<o;r++){var s=this._getHeightOfChar(t,e,r);n<s&&(n=s)}return this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e,i=0,n=0,r=this._textLines.length;n<r;n++)e=this._getHeightOfLine(t,n),i+=n===r-1?e/this.lineHeight:e;return i},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:h(this.styles,!0)})}}),fabric.IText.fromObject=function(t,e){var i=new fabric.IText(t.text,h(t));return e&&e(i),i}}(),function(){var u=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var e=this;this.on("added",function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))})},_initCanvasHandlers:function(t){t._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(t)}.bind(this),t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})}.bind(this),t.on("selection:cleared",t._canvasITextSelectionClearedHanlder),t.on("object:selected",t._canvasITextSelectionClearedHanlder),t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("selection:cleared",t._canvasITextSelectionClearedHanlder),t.off("object:selected",t._canvasITextSelectionClearedHanlder),t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&-1<i;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&-1<i;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.length;i<n;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&0<i&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll()),this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;e!==this.__selectionStartOnMouseDown&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top,this.hiddenTextarea.style.fontSize=t.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.text.split(""),e=this._getCursorBoundaries(t,"cursor"),i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getLineLeftOffset(this._getLineWidth(this.ctx,n)):e.leftOffset,a=this.calcTransformMatrix(),c={x:e.left+s,y:e.top+e.topOffset+o},l=this.canvas.upperCanvasEl,u=l.width-o,h=l.height-o;return c=fabric.util.transformPoint(c,a),(c=fabric.util.transformPoint(c,this.canvas.viewportTransform)).x<0&&(c.x=0),c.x>u&&(c.x=u),c.y<0&&(c.y=0),c.y>h&&(c.y=h),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1],i=e?t:t-1;this.removeStyleObject(e,i),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var i;if(1<this.selectionEnd-this.selectionStart&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),e||!this.isEmptyStyles())for(var n=0,r=t.length;n<r;n++)e&&(i=fabric.copiedTextStyle[n]),this.insertChar(t[n],n<r-1,i);else this.insertChar(t,!1)},insertChar:function(t,e,i){var n="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,n,i),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(t,e,i){this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={});var n={},r={};if(this.styles[t]&&this.styles[t][e-1]&&(n=this.styles[t][e-1]),i)r[0]=u(n),this.styles[t+1]=r;else{for(var o in this.styles[t])parseInt(o,10)>=e&&(r[parseInt(o,10)-e]=this.styles[t][o],delete this.styles[t][o]);this.styles[t+1]=r}this._forceClearCache=!0},insertCharStyleObject:function(t,e,i){var n=this.styles[t],r=u(n);for(var o in 0!==e||i||(e=1),r){var s=parseInt(o,10);e<=s&&(n[s+1]=r[s],r[s-1]||delete n[s])}this.styles[t][e]=i||u(n[e-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,i){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex;this._getLineStyle(r)||this._setLineStyle(r,{}),"\n"===t?this.insertNewlineStyleObject(r,o,e):this.insertCharStyleObject(r,o,i)},shiftLineStyles:function(t,e){var i=u(this.styles);for(var n in this.styles){var r=parseInt(n,10);t<r&&(this.styles[r+e]=i[r],i[r-e]||delete this.styles[r])}},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex;this._removeStyleObject(t,i,n,r)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(t,e,i,n){if(t){var r=this._getTextOnPreviousLine(e.lineIndex),o=r?r.length:0;for(n in this.styles[i-1]||(this.styles[i-1]={}),this.styles[i])this.styles[i-1][parseInt(n,10)+o]=this.styles[i][n];this.shiftLineStyles(e.lineIndex,-1)}else{var s=this.styles[i];s&&delete s[n];var a=u(s);for(var c in a){var l=parseInt(c,10);n<=l&&0!==l&&(s[l-1]=a[l],delete s[l])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):t<i&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){if(this.editable){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),n=0,r=0,o=0,s=0,a=0,c=this._textLines.length;a<c;a++){e=this._textLines[a],o+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getLineWidth(this.ctx,a);r=this._getLineLeftOffset(l)*this.scaleX;for(var u=0,h=e.length;u<h;u++){if(n=r,r+=this._getWidthOfChar(this.ctx,e[u],a,this.flipX?h-u:u)*this.scaleX,!(o<=i.y||r<=i.x))return this._getNewSelectionStartFromOffset(i,n,r,s+a,h);s++}if(i.y<o)return this._getNewSelectionStartFromOffset(i,n,r,s+a-1,h)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var o=n+(t.x-e<i-t.x?0:1);return this.flipX&&(o=r-o),o>this.text.length&&(o=this.text.length),o}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){this.isEditing&&!this._copyDone?t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()):this._copyDone=!1},onInput:function(t){if(this.isEditing&&!this.inCompositionMode){var e,i,n,r=this.selectionStart||0,o=this.selectionEnd||0,s=this.text.length,a=this.hiddenTextarea.value.length;i=s<a?(n="left"===this._selectionDirection?o:r,e=a-s,this.hiddenTextarea.value.slice(n,n+e)):(e=a-s+o-r,this.hiddenTextarea.value.slice(r,r+e)),this.insertChars(i),t.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){var e=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(e,!1),this.prevCompositionLength=e.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){if(this.selectionStart!==this.selectionEnd){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0}},paste:function(t){var e=null,i=this._getClipboardData(t),n=!0;i?(e=i.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(n=!1)):e=fabric.copiedText,e&&this.insertChars(e,n),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var i,n=this._textLines[t].slice(0,e),r=this._getLineWidth(this.ctx,t),o=this._getLineLeftOffset(r),s=0,a=n.length;s<a;s++)i=n[s],o+=this._getWidthOfChar(this.ctx,i,t,s);return o},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r+1,s);return this._textLines[r].slice(o).length+a+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r-1,s),c=this._textLines[r].slice(0,o);return-this._textLines[r-1].length+a-c.length},_getIndexOnLine:function(t,e){for(var i,n=this._getLineWidth(this.ctx,t),r=this._textLines[t],o=this._getLineLeftOffset(n),s=0,a=0,c=r.length;a<c;a++){var l=r[a],u=this._getWidthOfChar(this.ctx,l,t,a);if(e<(o+=u)){i=!0;var h=o-u,f=o,d=Math.abs(h-e);s=Math.abs(f-e)<d?a:a-1;break}}return i||(s=r.length-1),s},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var s=fabric.util.toFixed,a=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,o){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,i,n,o):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r){for(var o=this._textLines[t],s=0,a=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,c=this._getSVGLineTopOffset(t),l=this._getHeightOfLine(this.ctx,t),u=0,h=o.length;u<h;u++){var f=this._getStyleDeclaration(t,u)||{};e.push(this._createTextCharSpan(o[u],f,a,c.lineTop+c.offset,s));var d=this._getWidthOfChar(this.ctx,o[u],t,u);f.textBackgroundColor&&r.push(this._createTextCharBg(f,a,c.lineTop,l,d,s)),s+=d}},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this._getHeightOfLine(this.ctx,n);return e=this._getHeightOfLine(this.ctx,n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(t,e,i,n,r,o){return['\t\t<rect fill="',t.textBackgroundColor,'" x="',s(e+o,a),'" y="',s(i-this.height/2,a),'" width="',s(r,a),'" height="',s(n/this.lineHeight,a),'"></rect>\n'].join("")},_createTextCharSpan:function(t,e,i,n,r){var o=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},e));return['\t\t\t<tspan x="',s(i+r,a),'" y="',s(n-this.height/2,a),'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',o,'">',fabric.util.string.escapeXml(t),"</tspan>\n"].join("")}})}(),function(t){var n=t.fabric||(t.fabric={}),r=n.util.object.clone;n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,initialize:function(t,e){this.ctx=n.util.createCanvasElement().getContext("2d"),this.callSuper("initialize",t,e),this.setControlsVisibility(n.Textbox.getTextboxControlVisibility()),this._dimensionAffectingProps.width=!0},_initDimensions:function(t){this.__skipDimension||(t||(t=n.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,i=0,n={},r=0;r<this._textLines.length;r++)"\n"===this.text[i]&&0<r?(e=0,i++,t++):" "===this.text[i]&&0<r&&(e++,i++),n[r]={line:t,offset:e},i+=this._textLines[r].length,e+=this._textLines[r].length;return n},_getStyleDeclaration:function(t,e,i){if(this._styleMap){var n=this._styleMap[t];if(!n)return i?{}:null;t=n.line,e=n.offset+e}return this.callSuper("_getStyleDeclaration",t,e,i)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,n=e.split(this._reNewline),r=[];for(i=0;i<n.length;i++)r=r.concat(this._wrapLine(t,n[i],i));return r},_measureText:function(t,e,i,n){var r=0;n=n||0;for(var o=0,s=e.length;o<s;o++)r+=this._getWidthOfChar(t,e[o],i,o+n);return r},_wrapLine:function(t,e,i){for(var n=0,r=[],o="",s=e.split(" "),a="",c=0,l=0,u=0,h=0,f=!0,d=this._getWidthOfCharSpacing(),p=0;p<s.length;p++)a=s[p],l=this._measureText(t,a,i,c),c+=a.length,(n+=u+l-d)>=this.width&&!f?(r.push(o),n=l,f=!(o="")):n+=d,f||(o+=" "),o+=a,u=this._measureText(t," ",i,c),c++,f=!1,h<l&&(h=l);return p&&r.push(o),h>this.dynamicMinWidth&&(this.dynamicMinWidth=h-d),r},_splitTextIntoLines:function(){var t=this.textAlign;this.ctx.save(),this._setTextStyles(this.ctx),this.textAlign="left";var e=this._wrapText(this.ctx,this.text);return this.textAlign=t,this.ctx.restore(),this._textLines=e,this._styleMap=this._generateStyleMap(),e},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0,n=0;n<e;n++){var r=this._textLines[n].length;if(t<=i+r)return{lineIndex:n,charIndex:t-i};i+=r,"\n"!==this.text[i]&&" "!==this.text[i]||i++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,n=0,r=this.get2DCursorLocation(),o=this._textLines[r.lineIndex].split(""),s=this._getLineLeftOffset(this._getLineWidth(this.ctx,r.lineIndex)),a=0;a<r.charIndex;a++)n+=this._getWidthOfChar(this.ctx,o[a],r.lineIndex,a);for(a=0;a<r.lineIndex;a++)i+=this._getHeightOfLine(this.ctx,a);return"cursor"===e&&(i+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(r.lineIndex,r.charIndex)*(1-this._fontSizeFraction)),{top:i,left:n,lineLeft:s}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),n.Textbox.fromObject=function(t,e){var i=new n.Textbox(t.text,r(t));return e&&e(i),i},n.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}("undefined"!=typeof exports?exports:this),function(){var l=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(t,e,i,n,r,o,s){var a=e.target;if(!(a instanceof fabric.Textbox))return l.call(fabric.Canvas.prototype,t,e,i,n,r,o,s);var c=a.width*(t.x/e.scaleX/(a.width+a.strokeWidth));return c>=a.getMinWidth()?(a.set("width",c),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var t=this._objects.length;t--;)if(this._objects[t]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var s=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,i])},insertNewlineStyleObject:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,i])},shiftLineStyles:function(t,e){var i=s(this.styles),n=this._styleMap[t];for(var r in t=n.line,this.styles){var o=parseInt(r,10);t<o&&(this.styles[o+e]=i[o],i[o-e]||delete this.styles[o])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var i=this.get2DCursorLocation(e),n=this._styleMap[i.lineIndex],r=n.line,o=n.offset+i.charIndex;this._removeStyleObject(t,i,r,o)}})}(),function(){var c=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(t,e,i,n,r){n=c.call(this,t,e,i,n,r);for(var o=0,s=0,a=0;a<this._textLines.length&&!(n<=(o+=this._textLines[a].length)+s);a++)"\n"!==this.text[o+s]&&" "!==this.text[o+s]||s++;return n-a+s}}(),function(){if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(e,i,n){function t(t){t?(r.src=new Buffer(t,"binary"),r._src=e,i&&i.call(n,r)):(r=null,i&&i.call(n,null,!0))}var r=new Image;e&&(e instanceof Buffer||0===e.indexOf("data"))?(r.src=r._src=e,i&&i.call(n,r)):e&&0!==e.indexOf("http")?requestFs(e,t):e?request(e,"binary",t):i&&i.call(n,e)},fabric.loadSVGFromURL=function(t,e,i){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,i,e){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,e){i&&i(t,e)},e)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),o=new Canvas(t||600,e||600,n),s=new Canvas(t||600,e||600,n);r.style={},r.width=o.width,r.height=o.height,(i=i||{}).nodeCanvas=o,i.nodeCacheCanvas=s;var a=new(fabric.Canvas||fabric.StaticCanvas)(r,i);return a.nodeCanvas=o,a.nodeCacheCanvas=s,a.contextContainer=o.getContext("2d"),a.contextCache=s.getContext("2d"),a.Font=Canvas.Font,a};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}function request(t,n,r){var e=URL.parse(t);e.port||(e.port=0===e.protocol.indexOf("https:")?443:80);var i=(0===e.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:e.hostname,port:e.port,path:e.path,method:"GET"},function(e){var i="";n&&e.setEncoding(n),e.on("end",function(){r(i)}),e.on("data",function(t){200===e.statusCode&&(i+=t)})});i.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+e.hostname+":"+e.port):fabric.log(t.message),r(null)}),i.end()}function requestFs(t,i){require("fs").readFile(t,function(t,e){if(t)throw fabric.log(t),t;i(e)})}}(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.util=e():(t.tui=t.tui||{},t.tui.util=e())}(this,function(){return r={},i.m=n=[function(t,e,i){var n={},r=i(1),o=r.extend;o(n,r),o(n,i(3)),o(n,i(2)),o(n,i(4)),o(n,i(5)),o(n,i(6)),o(n,i(7)),o(n,i(8)),o(n,i(9)),n.browser=i(10),n.popup=i(11),n.formatDate=i(12),n.defineClass=i(13),n.defineModule=i(14),n.defineNamespace=i(15),n.CustomEvents=i(16),n.Enum=i(17),n.ExMap=i(18),n.HashMap=i(20),n.Map=i(19),t.exports=n},function(t,e,i){var s=i(2),o=i(3),n=0;function a(t,e){var i,n=[],r=[];if(isNaN(t)&&isNaN(e)&&s.isNumber(t)&&s.isNumber(e))return!0;if(t===e)return!0;if(s.isFunction(t)&&s.isFunction(e)||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(-1<o.inArray(t,n)||-1<o.inArray(e,r))return!1;for(i in e){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(typeof e[i]!=typeof t[i])return!1}for(i in t){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(typeof e[i]!=typeof t[i])return!1;if("object"==typeof t[i]||"function"==typeof t[i]){if(n.push(t),r.push(e),!a(t[i],e[i]))return!1;n.pop(),r.pop()}else if(t[i]!==e[i])return!1}return!0}function r(t,e){for(var i=arguments,n=i[0],r=1,o=i.length;r<o;r+=1){if(s.isUndefined(n)||s.isNull(n))return;n=n[i[r]]}return n}t.exports={extend:function(t,e){var i,n,r,o,s=Object.prototype.hasOwnProperty;for(r=1,o=arguments.length;r<o;r+=1)for(n in i=arguments[r])s.call(i,n)&&(t[n]=i[n]);return t},stamp:function(t){return t.__fe_id||(n+=1,t.__fe_id=n),t.__fe_id},hasStamp:function(t){return s.isExisty(r(t,"__fe_id"))},resetLastId:function(){n=0},keys:Object.prototype.keys||function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(e);return i},compareJSON:function(t){var e=arguments.length,i=1;if(e<1)return!0;for(;i<e;i+=1)if(!a(t,arguments[i]))return!1;return!0},pick:r}},function(t,e){var i=Object.prototype.toString;function n(t){return!r(t)&&!o(t)}function r(t){return void 0===t}function o(t){return null===t}function s(t){return n(t)&&!1!==t}function a(t){return n(t)&&("[object Arguments]"===i.call(t)||!!t.callee)}function c(t){return t instanceof Array}function l(t){return t===Object(t)}function u(t){return t instanceof Function}function h(t){return"string"==typeof t||t instanceof String}function f(t){return!(n(t)&&!function(t){return h(t)&&""===t}(t))||(c(t)||a(t)?0===t.length:!(l(t)&&!u(t))||!function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}(t))}t.exports={isExisty:n,isUndefined:r,isNull:o,isTruthy:s,isFalsy:function(t){return!s(t)},isArguments:a,isArray:c,isArraySafe:function(t){return"[object Array]"===i.call(t)},isObject:l,isFunction:u,isFunctionSafe:function(t){return"[object Function]"===i.call(t)},isNumber:function(t){return"number"==typeof t||t instanceof Number},isNumberSafe:function(t){return"[object Number]"===i.call(t)},isDate:function(t){return t instanceof Date},isDateSafe:function(t){return"[object Date]"===i.call(t)},isString:h,isStringSafe:function(t){return"[object String]"===i.call(t)},isBoolean:function(t){return"boolean"==typeof t||t instanceof Boolean},isBooleanSafe:function(t){return"[object Boolean]"===i.call(t)},isHTMLNode:function(t){return"object"==typeof HTMLElement?t&&(t instanceof HTMLElement||!!t.nodeType):!(!t||!t.nodeType)},isHTMLTag:function(t){return"object"==typeof HTMLElement?t&&t instanceof HTMLElement:!(!t||!t.nodeType||1!==t.nodeType)},isEmpty:f,isNotEmpty:function(t){return!f(t)}}},function(t,e,i){var n,r=i(4),o=i(2),s=Array.prototype.slice;n={inArray:function(t,e,i){var n,r;if(i=i||0,!o.isArray(e))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,i);for(r=e.length,n=i;0<=i&&n<r;n+=1)if(e[n]===t)return n;return-1},range:function(t,e,i){var n,r=[];for(o.isUndefined(e)&&(e=t||0,t=0),e*=n=(i=i||1)<0?-1:1;t*n<e;t+=i)r.push(t);return r},zip:function(){var t=s.call(arguments),i=[];return r.forEach(t,function(t){r.forEach(t,function(t,e){i[e]||(i[e]=[]),i[e].push(t)})}),i}},t.exports=n},function(t,e,i){var a=i(2),c=i(1);function n(t,e,i){var n=0,r=t.length;for(i=i||null;n<r&&!1!==e.call(i,t[n],n,t);n+=1);}function r(t,e,i){var n;for(n in i=i||null,t)if(t.hasOwnProperty(n)&&!1===e.call(i,t[n],n,t))break}function o(t,e,i){a.isArray(t)?n(t,e,i):r(t,e,i)}function s(t,e,i){var n=[];return i=i||null,o(t,function(){n.push(e.apply(i,arguments))}),n}t.exports={forEachOwnProperties:r,forEachArray:n,forEach:o,toArray:function(e){var i;try{i=Array.prototype.slice.call(e)}catch(t){i=[],n(e,function(t){i.push(t)})}return i},map:s,reduce:function(t,e,i){var n,r,o,s=0;for(i=i||null,o=a.isArray(t)?(r=t.length,t[s]):(r=(n=c.keys(t)).length,t[n[s+=1]]),s+=1;s<r;s+=1)o=e.call(i,o,t[n?n[s]:s]);return o},filter:function(t,e,i){var n,r;if(i=i||null,!a.isObject(t)||!a.isFunction(e))throw new Error("wrong parameter");return r=a.isArray(t)?(n=[],function(t,e){t.push(e[0])}):(n={},function(t,e){t[e[1]]=e[0]}),o(t,function(){e.apply(i,arguments)&&r(n,arguments)},i),n},pluck:function(t,e){return s(t,function(t){return t[e]})}}},function(t,e){t.exports={bind:function(t,e){var i,n=Array.prototype.slice;return t.bind?t.bind.apply(t,n.call(arguments,1)):(i=n.call(arguments,2),function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)})}}},function(t,e){function n(t){function e(){}return e.prototype=t,new e}t.exports={createObject:n,inherit:function(t,e){var i=n(e.prototype);(i.constructor=t).prototype=i}}},function(t,e,i){var s=i(4),a=i(1);t.exports={decodeHTMLEntity:function(t){var e={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&nbsp;":" "};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&nbsp;/g,function(t){return e[t]?e[t]:t})},encodeHTMLEntity:function(t){var e={'"':"quot","&":"amp","<":"lt",">":"gt","'":"#39"};return t.replace(/[<>&"']/g,function(t){return e[t]?"&"+e[t]+";":t})},hasEncodableString:function(t){return/[<>&"']/.test(t)},getDuplicatedChar:function(t,e){for(var i,n=0,r=t.length,o={};n<r;n+=1)o[i=t.charAt(n)]=1;for(n=0,r=e.length;n<r;n+=1)o[i=e.charAt(n)]&&(o[i]+=1);return o=s.filter(o,function(t){return 1<t}),(o=a.keys(o).sort()).join("")}}},function(t,e){var l={},u=Array.prototype.slice;l.timestamp=function(){return Number(new Date)},l.debounce=function(t,e){var i,n;return e=e||0,function(){n=u.call(arguments),window.clearTimeout(i),i=window.setTimeout(function(){t.apply(null,n)},e)}},l.throttle=function(e,t){function i(t){e.apply(null,t),n=null}var n,r,o,s,a=!0;function c(){if(s=u.call(arguments),a)return i(s),void(a=!1);o=l.timestamp(),n=n||o,r(s),t<=o-n&&i(s)}return t=t||0,r=l.debounce(i,t),c.reset=function(){a=!0,n=null},c},t.exports=l},function(t,e,i){var r=i(1),o=i(4),s=i(2),a=6048e5;function c(t,i){var e=o.map(r.keys(i),function(t,e){return(0===e?"":"&")+t+"="+i[t]}).join(""),n=document.createElement("img");return n.src=t+"?"+e,n.style.display="none",document.body.appendChild(n),document.body.removeChild(n),n}t.exports={imagePing:c,sendHostname:function(t,e){var i=location.hostname,n="TOAST UI "+t+" for "+i+": Statistics",r=window.localStorage.getItem(n);!s.isUndefined(window.tui)&&!1===window.tui.usageStatistics||r&&!function(t){var e=(new Date).getTime();return a<e-t}(r)||(window.localStorage.setItem(n,(new Date).getTime()),setTimeout(function(){"interactive"!==document.readyState&&"complete"!==document.readyState||c("https://www.google-analytics.com/collect",{v:1,t:"event",tid:e,cid:i,dp:i,dh:t,el:t,ec:"use"})},1e3))}}},function(t,e){var i,n,r={chrome:!1,firefox:!1,safari:!1,msie:!1,edge:!1,others:!1,version:0},o=window.navigator,s=o.appName.replace(/\s/g,"_"),a=o.userAgent,c=/MSIE\s([0-9]+[.0-9]*)/,l=/Trident.*rv:11\./,u=/Edge\/(\d+)\./,h={firefox:/Firefox\/(\d+)\./,chrome:/Chrome\/(\d+)\./,safari:/Version\/([\d.]+).*Safari\/(\d+)/},f={Microsoft_Internet_Explorer:function(){var t=a.match(c);t?(r.msie=!0,r.version=parseFloat(t[1])):r.others=!0},Netscape:function(){var t=!1;if(l.exec(a))r.msie=!0,r.version=11,t=!0;else if(u.exec(a))r.edge=!0,r.version=a.match(u)[1],t=!0;else for(i in h)if(h.hasOwnProperty(i)&&(n=a.match(h[i]))&&1<n.length){r[i]=t=!0,r.version=parseFloat(n[1]||0);break}t||(r.others=!0)}};f[s]&&f[s](),t.exports=r},function(t,e,i){var a=i(4),o=i(2),s=i(5),c=i(10),l=i(1),u=0;function n(){this.openedPopup={},this.closeWithParentPopup={},this.postBridgeUrl=""}n.prototype.getPopupList=function(t){return o.isExisty(t)?this.openedPopup[t]:this.openedPopup},n.prototype.openPopup=function(t,e){var i,n,r;if((e=l.extend({popupName:"popup_"+u+"_"+Number(new Date),popupOptionStr:"",useReload:!0,closeWithParent:!0,method:"get",param:{}},e||{})).method=e.method.toUpperCase(),this.postBridgeUrl=e.postBridgeUrl||this.postBridgeUrl,r="POST"===e.method&&e.param&&c.msie&&11===c.version,!o.isExisty(t))throw new Error("Popup#open() need popup url.");u+=1,e.param&&("GET"===e.method?t=t+(/\?/.test(t)?"&":"?")+this._parameterize(e.param):"POST"===e.method&&(r||(n=this.createForm(t,e.param,e.method,e.popupName),t="about:blank"))),i=this.openedPopup[e.popupName],o.isExisty(i)?i.closed?this.openedPopup[e.popupName]=i=this._open(r,e.param,t,e.popupName,e.popupOptionStr):(e.useReload&&i.location.replace(t),i.focus()):this.openedPopup[e.popupName]=i=this._open(r,e.param,t,e.popupName,e.popupOptionStr),this.closeWithParentPopup[e.popupName]=e.closeWithParent,i&&!i.closed&&!o.isUndefined(i.closed)||alert("please enable popup windows for this website"),e.param&&"POST"===e.method&&!r&&(i&&n.submit(),n.parentNode&&n.parentNode.removeChild(n)),window.onunload=s.bind(this.closeAllPopup,this)},n.prototype.close=function(t,e){var i=e||window;(t=!!o.isExisty(t)&&t)&&(window.onunload=null),i.closed||(i.opener=window.location.href,i.close())},n.prototype.closeAllPopup=function(t){var i=o.isExisty(t);a.forEachOwnProperties(this.openedPopup,function(t,e){(i&&this.closeWithParentPopup[e]||!i)&&this.close(!1,t)},this)},n.prototype.focus=function(t){this.getPopupList(t).focus()},n.prototype.parseQuery=function(){var t,e,i={};return t=window.location.search.substr(1),a.forEachArray(t.split("&"),function(t){e=t.split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),i},n.prototype.createForm=function(t,e,i,n,r){var o,s=document.createElement("form");return r=r||document.body,s.method=i||"POST",s.action=t||"",s.target=n||"",s.style.display="none",a.forEachOwnProperties(e,function(t,e){(o=document.createElement("input")).name=e,o.type="hidden",o.value=t,s.appendChild(o)}),r.appendChild(s),s},n.prototype._parameterize=function(t){var i=[];return a.forEachOwnProperties(t,function(t,e){i.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),i.join("&")},n.prototype._open=function(t,e,i,n,r){var o;return t?(o=window.open(this.postBridgeUrl,n,r),setTimeout(function(){o.redirect(i,e)},100)):o=window.open(i,n,r),o},t.exports=new n},function(t,e,i){var a=i(2),c=i(1),l=/[\\]*YYYY|[\\]*YY|[\\]*MMMM|[\\]*MMM|[\\]*MM|[\\]*M|[\\]*DD|[\\]*D|[\\]*HH|[\\]*H|[\\]*A/gi,n=["Invalid month","January","February","March","April","May","June","July","August","September","October","November","December"],u=[0,31,28,31,30,31,30,31,31,30,31,30,31],h={M:function(t){return Number(t.month)},MM:function(t){var e=t.month;return Number(e)<10?"0"+e:e},MMM:function(t){return n[Number(t.month)].substr(0,3)},MMMM:function(t){return n[Number(t.month)]},D:function(t){return Number(t.date)},d:function(t){return h.D(t)},DD:function(t){var e=t.date;return Number(e)<10?"0"+e:e},dd:function(t){return h.DD(t)},YY:function(t){return Number(t.year)%100},yy:function(t){return h.YY(t)},YYYY:function(t){var e="20",i=t.year;return 69<i&&i<100&&(e="19"),Number(i)<100?e+String(i):i},yyyy:function(t){return h.YYYY(t)},A:function(t){return t.meridiem},a:function(t){return t.meridiem},hh:function(t){var e=t.hour;return Number(e)<10?"0"+e:e},HH:function(t){return h.hh(t)},h:function(t){return String(Number(t.hour))},H:function(t){return h.h(t)},m:function(t){return String(Number(t.minute))},mm:function(t){var e=t.minute;return Number(e)<10?"0"+e:e}};t.exports=function(t,e,i){var n,r,o=c.pick(i,"meridiemSet","AM")||"AM",s=c.pick(i,"meridiemSet","PM")||"PM";return!!function(t,e,i){var n;return t=Number(t),e=Number(e),i=Number(i),(-1<t&&t<100||1969<t&&t<2070)&&(0<e&&e<13)&&(n=u[e],2===e&&t%4==0&&(t%100==0&&t%400!=0||(n=29)),0<i&&i<=n)}((r=a.isDate(e)?{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}:{year:e.year,month:e.month,date:e.date,hour:e.hour,minute:e.minute}).year,r.month,r.date)&&(r.meridiem="",/([^\\]|^)[aA]\b/.test(t)&&(n=11<r.hour?s:o,12<r.hour&&(r.hour%=12),0===r.hour&&(r.hour=12),r.meridiem=n),t.replace(l,function(t){return-1<t.indexOf("\\")?t.replace(/\\/,""):h[t](r)||""}))}},function(t,e,i){var n=i(6).inherit,r=i(1).extend;t.exports=function(t,e){var i;return e||(e=t,t=null),i=e.init||function(){},t&&n(i,t),e.hasOwnProperty("static")&&(r(i,e.static),delete e.static),r(i.prototype,e),i}},function(t,e,i){var n=i(15),r=i(2),o="initialize";t.exports=function(t,e){var i=e||{};return r.isFunction(i[o])&&i[o](),n(t,i)}},function(t,e,i){var s=i(4),a=i(1);t.exports=function(t,e,i){var n,r,o;return(n=t.split(".")).unshift(window),r=s.reduce(n,function(t,e){return t[e]=t[e]||{},t[e]}),i?(o=n.pop(),r=a.pick.apply(null,n)[o]=e):a.extend(r,e),r}},function(t,e,i){var s=i(4),a=i(2),n=i(1),c=/\s+/g;function r(){this.events=null,this.contexts=null}r.mixin=function(t){n.extend(t.prototype,r.prototype)},r.prototype._getHandlerItem=function(t,e){var i={handler:t};return e&&(i.context=e),i},r.prototype._safeEvent=function(t){var e,i=this.events;return i||(i=this.events={}),t&&((e=i[t])||(e=[],i[t]=e),i=e),i},r.prototype._safeContext=function(){var t=this.contexts;return t||(t=this.contexts=[]),t},r.prototype._indexOfContext=function(t){for(var e=this._safeContext(),i=0;e[i];){if(t===e[i][0])return i;i+=1}return-1},r.prototype._memorizeContext=function(t){var e,i;a.isExisty(t)&&(e=this._safeContext(),-1<(i=this._indexOfContext(t))?e[i][1]+=1:e.push([t,1]))},r.prototype._forgetContext=function(t){var e,i;a.isExisty(t)&&(e=this._safeContext(),-1<(i=this._indexOfContext(t))&&(e[i][1]-=1,e[i][1]<=0&&e.splice(i,1)))},r.prototype._bindEvent=function(t,e,i){var n=this._safeEvent(t);this._memorizeContext(i),n.push(this._getHandlerItem(e,i))},r.prototype.on=function(t,e,i){var n=this;a.isString(t)?(t=t.split(c),s.forEach(t,function(t){n._bindEvent(t,e,i)})):a.isObject(t)&&(i=e,s.forEach(t,function(t,e){n.on(e,t,i)}))},r.prototype.once=function(e,i,n){var r=this;if(a.isObject(e))return n=i,void s.forEach(e,function(t,e){r.once(e,t,n)});this.on(e,function t(){i.apply(n,arguments),r.off(e,t,n)},n)},r.prototype._spliceMatches=function(t,e){var i,n=0;if(a.isArray(t))for(i=t.length;n<i;n+=1)!0===e(t[n])&&(t.splice(n,1),i-=1,n-=1)},r.prototype._matchHandler=function(i){var n=this;return function(t){var e=i===t.handler;return e&&n._forgetContext(t.context),e}},r.prototype._matchContext=function(i){var n=this;return function(t){var e=i===t.context;return e&&n._forgetContext(t.context),e}},r.prototype._matchHandlerAndContext=function(r,o){var s=this;return function(t){var e=r===t.handler,i=o===t.context,n=e&&i;return n&&s._forgetContext(t.context),n}},r.prototype._offByEventName=function(t,e){var i=this,n=s.forEachArray,r=a.isFunction(e),o=i._matchHandler(e);t=t.split(c),n(t,function(t){var e=i._safeEvent(t);r?i._spliceMatches(e,o):(n(e,function(t){i._forgetContext(t.context)}),i.events[t]=[])})},r.prototype._offByHandler=function(t){var e=this,i=this._matchHandler(t);s.forEach(this._safeEvent(),function(t){e._spliceMatches(t,i)})},r.prototype._offByObject=function(t,e){var i,n=this;this._indexOfContext(t)<0?s.forEach(t,function(t,e){n.off(e,t)}):a.isString(e)?(i=this._matchContext(t),n._spliceMatches(this._safeEvent(e),i)):a.isFunction(e)?(i=this._matchHandlerAndContext(e,t),s.forEach(this._safeEvent(),function(t){n._spliceMatches(t,i)})):(i=this._matchContext(t),s.forEach(this._safeEvent(),function(t){n._spliceMatches(t,i)}))},r.prototype.off=function(t,e){a.isString(t)?this._offByEventName(t,e):arguments.length?a.isFunction(t)?this._offByHandler(t):a.isObject(t)&&this._offByObject(t,e):(this.events={},this.contexts=[])},r.prototype.fire=function(t){this.invoke.apply(this,arguments)},r.prototype.invoke=function(t){var e,i,n,r;if(!this.hasListener(t))return!0;for(e=this._safeEvent(t),i=Array.prototype.slice.call(arguments,1),n=0;e[n];){if(!1===(r=e[n]).handler.apply(r.context,i))return!1;n+=1}return!0},r.prototype.hasListener=function(t){return 0<this.getListenerLength(t)},r.prototype.getListenerLength=function(t){return this._safeEvent(t).length},t.exports=r},function(t,e,i){var o=i(4),n=i(2),r=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}(),s=0;function a(t){t&&this.set.apply(this,arguments)}a.prototype.set=function(t){var e=this;n.isArray(t)||(t=o.toArray(arguments)),o.forEach(t,function(t){e._addItem(t)})},a.prototype.getName=function(i){var n,r=this;return o.forEach(this,function(t,e){if(r._isEnumItem(e)&&i===t)return n=e,!1}),n},a.prototype._addItem=function(t){var e;this.hasOwnProperty(t)||(e=this._makeEnumValue(),r?Object.defineProperty(this,t,{enumerable:!0,configurable:!1,writable:!1,value:e}):this[t]=e)},a.prototype._makeEnumValue=function(){var t;return t=s,s+=1,t},a.prototype._isEnumItem=function(t){return n.isNumber(this[t])},t.exports=a},function(t,e,i){var n=i(4),r=i(19);function o(t){this._map=new r(t),this.size=this._map.size}n.forEachArray(["get","has","forEach","keys","values","entries"],function(t){o.prototype[t]=function(){return this._map[t].apply(this._map,arguments)}}),n.forEachArray(["delete","clear"],function(e){o.prototype[e]=function(){var t=this._map[e].apply(this._map,arguments);return this.size=this._map.size,t}}),o.prototype.set=function(){return this._map.set.apply(this._map,arguments),this.size=this._map.size,this},o.prototype.setObject=function(t){n.forEachOwnProperties(t,function(t,e){this.set(e,t)},this)},o.prototype.deleteByKeys=function(t){n.forEachArray(t,function(t){this.delete(t)},this)},o.prototype.merge=function(t){t.forEach(function(t,e){this.set(e,t)},this)},o.prototype.filter=function(i){var n=new o;return this.forEach(function(t,e){i(t,e)&&n.set(e,t)}),n},t.exports=o},function(t,e,i){var n=i(4),o=i(2),r=i(3),s=i(10),a=i(5),c={},l={};function u(t,e){this._keys=t,this._valueGetter=e,this._length=this._keys.length,this._index=-1,this._done=!1}function h(t){this._valuesForString={},this._valuesForIndex={},this._keys=[],t&&this._setInitData(t),this.size=0}u.prototype.next=function(){for(var t={};this._index+=1,o.isUndefined(this._keys[this._index])&&this._index<this._length;);return this._index>=this._length?t.done=!0:(t.done=!1,t.value=this._valueGetter(this._keys[this._index],this._index)),t},h.prototype._setInitData=function(t){if(!o.isArray(t))throw new Error("Only Array is supported.");n.forEachArray(t,function(t){this.set(t[0],t[1])},this)},h.prototype._isNaN=function(t){return"number"==typeof t&&t!=t},h.prototype._getKeyIndex=function(t){var e,i=-1;return o.isString(t)?(e=this._valuesForString[t])&&(i=e.keyIndex):i=r.inArray(t,this._keys),i},h.prototype._getOriginKey=function(t){var e=t;return t===c?e=void 0:t===l&&(e=NaN),e},h.prototype._getUniqueKey=function(t){var e=t;return o.isUndefined(t)?e=c:this._isNaN(t)&&(e=l),e},h.prototype._getValueObject=function(t,e){return o.isString(t)?this._valuesForString[t]:(o.isUndefined(e)&&(e=this._getKeyIndex(t)),0<=e?this._valuesForIndex[e]:void 0)},h.prototype._getOriginValue=function(t,e){return this._getValueObject(t,e).origin},h.prototype._getKeyValuePair=function(t,e){return[this._getOriginKey(t),this._getOriginValue(t,e)]},h.prototype._createValueObject=function(t,e){return{keyIndex:e,origin:t}},h.prototype.set=function(t,e){var i,n=this._getUniqueKey(t),r=this._getKeyIndex(n);return r<0&&(r=this._keys.push(n)-1,this.size+=1),i=this._createValueObject(e,r),o.isString(t)?this._valuesForString[t]=i:this._valuesForIndex[r]=i,this},h.prototype.get=function(t){var e=this._getUniqueKey(t),i=this._getValueObject(e);return i&&i.origin},h.prototype.keys=function(){return new u(this._keys,a.bind(this._getOriginKey,this))},h.prototype.values=function(){return new u(this._keys,a.bind(this._getOriginValue,this))},h.prototype.entries=function(){return new u(this._keys,a.bind(this._getKeyValuePair,this))},h.prototype.has=function(t){return!!this._getValueObject(t)},h.prototype.delete=function(t){var e;o.isString(t)?this._valuesForString[t]&&(e=this._valuesForString[t].keyIndex,delete this._valuesForString[t]):0<=(e=this._getKeyIndex(t))&&delete this._valuesForIndex[e],0<=e&&(delete this._keys[e],this.size-=1)},h.prototype.forEach=function(e,i){i=i||this,n.forEachArray(this._keys,function(t){o.isUndefined(t)||e.call(i,this._getValueObject(t).origin,t,this)},this)},h.prototype.clear=function(){h.call(this)},window.Map&&(s.firefox&&37<=s.version||s.chrome&&42<=s.version)&&(h=window.Map),t.exports=h},function(t,e,i){var o=i(4),n=i(2);function r(t){this.length=0,t&&this.setObject(t)}r.prototype.set=function(t,e){2===arguments.length?this.setKeyValue(t,e):this.setObject(t)},r.prototype.setKeyValue=function(t,e){this.has(t)||(this.length+=1),this[this.encodeKey(t)]=e},r.prototype.setObject=function(t){var i=this;o.forEachOwnProperties(t,function(t,e){i.setKeyValue(e,t)})},r.prototype.merge=function(t){var i=this;t.each(function(t,e){i.setKeyValue(e,t)})},r.prototype.encodeKey=function(t){return"å"+t},r.prototype.decodeKey=function(t){var e=t.split("å");return e[e.length-1]},r.prototype.get=function(t){return this[this.encodeKey(t)]},r.prototype.has=function(t){return this.hasOwnProperty(this.encodeKey(t))},r.prototype.remove=function(t){return 1<arguments.length&&(t=o.toArray(arguments)),n.isArray(t)?this.removeByKeyArray(t):this.removeByKey(t)},r.prototype.removeByKey=function(t){var e=this.has(t)?this.get(t):null;return null!==e&&(delete this[this.encodeKey(t)],this.length-=1),e},r.prototype.removeByKeyArray=function(t){var e=[],i=this;return o.forEach(t,function(t){e.push(i.removeByKey(t))}),e},r.prototype.removeAll=function(){var i=this;this.each(function(t,e){i.remove(e)})},r.prototype.each=function(i){var n,r=this;o.forEachOwnProperties(this,function(t,e){if("å"===e.charAt(0)&&(n=i(t,r.decodeKey(e))),!1===n)return n})},r.prototype.keys=function(){var i=[],n=this;return this.each(function(t,e){i.push(n.decodeKey(e))}),i},r.prototype.find=function(i){var n=[];return this.each(function(t,e){i(t,e)&&n.push(t)}),n},r.prototype.toArray=function(){var e=[];return this.each(function(t){e.push(t)}),e},t.exports=r}],i.c=r,i.p="dist",i(0);function i(t){if(r[t])return r[t].exports;var e=r[t]={exports:{},id:t,loaded:!1};return n[t].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var n,r}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("tui-code-snippet")):"function"==typeof define&&define.amd?define(["tui-code-snippet"],e):"object"==typeof exports?exports.colorPicker=e(require("tui-code-snippet")):(t.tui=t.tui||{},t.tui.colorPicker=e(t.tui&&t.tui.util))}(this,function(i){return o={},n.m=r=[function(t,e,i){i(1),t.exports=i(6)},function(t,e){},,,,,function(t,e,i){var n={domutil:i(7),domevent:i(9),Collection:i(10),View:i(11),Drag:i(12),create:i(13),Palette:i(16),Slider:i(18),colorutil:i(14),svgvml:i(19)};t.exports=n},function(t,e,i){var f,n,r=i(8),o=i(9),a=i(10),d=r,s="onselectstart"in document,c="",l=/^auto$|^$|%/;n=(f={appendHTMLElement:function(t,e,i){var n;return i=i||"",(n=document.createElement(t)).className=i,e?e.appendChild(n):document.body.appendChild(n),n},remove:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},get:function(t){return document.getElementById(t)},_matcher:function(t,e){return/^\./.test(e)?f.hasClass(t,e.replace(".","")):/^#/.test(e)?t.id===e.replace("#",""):t.nodeName.toLowerCase()===e.toLowerCase()},find:function(t,e,a){var c=[],l=!1,u=d.isUndefined(a)||!1===a,h=d.isFunction(a);return d.isString(e)&&(e=f.get(e)),function t(e,i){for(var n,r=e.childNodes,o=0,s=r.length;o<s;o+=1)if("#text"!==(n=r[o]).nodeName)if(f._matcher(n,i)){if((h&&a(n)||!h)&&c.push(n),u){l=!0;break}}else if(0<n.childNodes.length&&(t(n,i),l))break}(e=e||window.document.body,t),u?c[0]||null:c},closest:function(t,e){var i=t.parentNode;if(f._matcher(t,e))return t;for(;i&&i!==window.document.body;){if(f._matcher(i,e))return i;i=i.parentNode}},text:function(t){var e="",i=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)e+=f.text(t)}else if(3===n||4===n)return t.nodeValue}else for(;t[i];i+=1)e+=f.text(t[i]);return e},setData:function(t,e,i){"dataset"in t?t.dataset[e]=i:t.setAttribute("data-"+e,i)},getData:function(t,e){return"dataset"in t?t.dataset[e]:t.getAttribute("data-"+e)},hasClass:function(t,e){var i;return d.isUndefined(t.classList)?0<(i=f.getClass(t)).length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i):t.classList.contains(e)},addClass:function(e,t){var i;d.isUndefined(e.classList)?f.hasClass(e,t)||(i=f.getClass(e),f.setClass(e,(i?i+" ":"")+t)):d.forEachArray(t.split(" "),function(t){e.classList.add(t)})},setClass:function(t,e){d.isUndefined(t.className.baseVal)?t.className=e:t.className.baseVal=e},removeClass:function(t,e){var i="";d.isUndefined(t.classList)?(i=(" "+f.getClass(t)+" ").replace(" "+e+" "," "),f.setClass(t,function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(i))):t.classList.remove(e)},getClass:function(t){return t&&t.className?d.isUndefined(t.className.baseVal)?t.className:t.className.baseVal:""},getStyle:function(t,e){var i,n=t.style[e]||t.currentStyle&&t.currentStyle[e];return n&&"auto"!==n||!document.defaultView||(n=(i=document.defaultView.getComputedStyle(t,null))?i[e]:null),"auto"===n?null:n},getComputedStyle:function(i){var t=document.defaultView;return t&&t.getComputedStyle?document.defaultView.getComputedStyle(i):{getPropertyValue:function(t){var e=/(\-([a-z]){1})/g;return"float"===t&&(t="styleFloat"),e.test(t)&&(t=t.replace(e,function(){return arguments[2].toUpperCase()})),i.currentStyle[t]?i.currentStyle[t]:null}}},setPosition:function(t,e,i){e=d.isUndefined(e)?0:e,i=d.isUndefined(i)?0:i,t._pos=[e,i],t.style.left=e+"px",t.style.top=i+"px"},getPosition:function(t,e){var i,n,r;return e&&(t._pos=null),t._pos?t._pos:(n=i=0,n=(l.test(t.style.left)||l.test(t.style.top))&&"getBoundingClientRect"in t?(i=(r=t.getBoundingClientRect()).left,r.top):(i=parseFloat(t.style.left||0),parseFloat(t.style.top||0)),[i,n])},getSize:function(t){var e,i=f.getStyle(t,"width"),n=f.getStyle(t,"height");return n=(l.test(i)||l.test(n))&&"getBoundingClientRect"in t?(i=(e=t.getBoundingClientRect()).width,e.height):(i=parseFloat(i||0),parseFloat(n||0)),[i,n]},testProp:function(t){for(var e=document.documentElement.style,i=0,n=t.length;i<n;i+=1)if(t[i]in e)return t[i];return!1},getFormData:function(t){function e(t){return!t.disabled}var i=new a(function(){return this.length}),s={};return i.add.apply(i,f.find("input",t,e).concat(f.find("select",t,e)).concat(f.find("textarea",t,e))),i=i.groupBy(function(t){return t&&t.getAttribute("name")||"_other"}),d.forEach(i,function(r,o){"_other"!==o&&r.each(function(t){var e=t.nodeName.toLowerCase(),i=t.type,n=[];"radio"===i?n=[r.find(function(t){return t.checked}).toArray().pop()]:"checkbox"===i?n=r.find(function(t){return t.checked}).toArray():"select"===e?r.find(function(t){return!!t.childNodes.length}).each(function(t){n=n.concat(f.find("option",t,function(t){return t.selected}))}):n=r.find(function(t){return""!==t.value}).toArray(),(n=d.map(n,function(t){return t.value})).length?1===n.length&&(n=n[0]):n="",s[o]=n})}),s}}).testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),f.disableTextSelection=s?function(){o.on(window,"selectstart",o.preventDefault)}:function(){var t=document.documentElement.style;c=t[n],t[n]="none"},f.enableTextSelection=s?function(){o.off(window,"selectstart",o.preventDefault)}:function(){document.documentElement.style[n]=c},f.disableImageDrag=function(){o.on(window,"dragstart",o.preventDefault)},f.enableImageDrag=function(){o.off(window,"dragstart",o.preventDefault)},f.applyTemplate=function(t,i){return t.replace(/\{\{(\w*)\}\}/g,function(t,e){return i.hasOwnProperty(e)?i[e]:""})},t.exports=f},function(t,e){t.exports=i},function(t,e,i){var a=i(8),r=a.browser,n={START:["touchstart","mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},c={on:function(i,t,n,e){a.isString(t)?a.forEach(t.split(" "),function(t){c._on(i,t,n,e)}):a.forEachOwnProperties(t,function(t,e){c._on(i,e,t,n)})},_on:function(e,t,i,n){var r,o,s;r=t+a.stamp(i)+(n?"_"+a.stamp(n):""),e._evt&&e._evt[r]||(s=o=function(t){i.call(n||e,t||window.event)},"addEventListener"in e?"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,c._checkMouse(e,t)&&s(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1)):("mousewheel"===t&&e.addEventListener("DOMMouseScroll",o,!1),e.addEventListener(t,o,!1)):"attachEvent"in e&&e.attachEvent("on"+t,o),e._evt=e._evt||{},e._evt[r]=o)},off:function(i,t,n,e){a.isString(t)?a.forEach(t.split(" "),function(t){c._off(i,t,n,e)}):a.forEachOwnProperties(t,function(t,e){c._off(i,e,t,n)})},_off:function(t,e,i,n){var r=e+a.stamp(i)+(n?"_"+a.stamp(n):""),o=t._evt&&t._evt[r];if(o){if("removeEventListener"in t)"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",o,!1):("mousewheel"===e&&t.removeEventListener("DOMMouseScroll",o,!1),t.removeEventListener(e,o,!1));else if("detachEvent"in t)try{t.detachEvent("on"+e,o)}catch(t){}delete t._evt[r],a.keys(t._evt).length||(a.browser.msie&&a.browser.version<9?t._evt=null:delete t._evt)}},once:function(i,e,n,r){var o=this;a.isObject(e)?a.forEachOwnProperties(e,function(t,e){c.once(i,e,t,n)}):c.on(i,e,function t(){n.apply(r||i,arguments),o._off(i,e,t,r)},r)},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stop:function(t){c.preventDefault(t),c.stopPropagation(t)},disableScrollPropagation:function(t){c.on(t,"mousewheel MozMousePixelScroll",c.stopPropagation)},disableClickPropagation:function(t){c.on(t,n.START.join(" ")+" click dblclick",c.stopPropagation)},getMousePosition:function(t,e){var i;return e?(i=e.getBoundingClientRect(),[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]):[t.clientX,t.clientY]},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},trigger:function(t,e,i){a.isUndefined(i)&&/(mouse|click)/.exec(e)&&(i=c.mouseEvent(e)),t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&t.fireEvent("on"+e,i)},mouseEvent:function(t,e){var i,n;return n=a.extend({bubbles:!0,cancelable:"mousemove"!==t,view:window,wheelDelta:0,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},e),r.msie&&r.version<9&&delete n.wheelDelta,"function"==typeof document.createEvent?(i=document.createEvent("MouseEvents")).initMouseEvent(t,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,document.body.parentNode):document.createEventObject&&(i=document.createEventObject(),a.forEach(n,function(t,e){i[e]=t},this),i.button={0:1,1:4,2:2}[i.button]||i.button),i},getMouseButton:function(t){var e;return document.implementation.hasFeature("MouseEvents","2.0")?t.button:(e=t.button+"",~"0,1,3,5,7".indexOf(e)?0:~"2,6".indexOf(e)?2:~"4".indexOf(e)?1:void 0)}};t.exports=c},function(t,e,i){var a=i(8),n=a.forEachOwnProperties,o=a.forEachArray,c=a.isFunction,r=a.isObject,s=Array.prototype.slice;function l(t){this.items={},this.length=0,c(t)&&(this.getItemID=t)}l.and=function(i){var n;return i=s.call(arguments),n=i.length,function(t){for(var e=0;e<n;e+=1)if(!i[e].call(null,t))return!1;return!0}},l.or=function(n){var r;return n=s.call(arguments),r=n.length,function(t){for(var e=1,i=n[0].call(null,t);e<r;e+=1)i=i||n[e].call(null,t);return i}},l.merge=function(t){var e=s.call(arguments),i={},n=new l(e[0].getItemID),r=a.extend;return o(e,function(t){r(i,t.items)}),n.items=i,n.length=a.keys(n.items).length,n},l.prototype.getItemID=function(t){return t._id+""},l.prototype.add=function(t){var e,i;1<arguments.length?o(s.call(arguments),function(t){this.add(t)},this):(e=this.getItemID(t),(i=this.items)[e]||(this.length+=1),i[e]=t)},l.prototype.remove=function(t){var e,i,n=[];return this.length?1<arguments.length?n=a.map(s.call(arguments),function(t){return this.remove(t)},this):(e=this.items,r(t)&&(t=this.getItemID(t)),e[t]?(this.length-=1,i=e[t],delete e[t],i):n):n},l.prototype.clear=function(){this.items={},this.length=0},l.prototype.has=function(e){var t,i;return!!this.length&&(t=c(e),i=!1,t?this.each(function(t){return!0!==e(t)||!(i=!0)}):(e=r(e)?this.getItemID(e):e,i=a.isExisty(this.items[e])),i)},l.prototype.doWhenHas=function(t,e,i){var n=this.items[t];a.isExisty(n)&&e.call(i||this,n)},l.prototype.find=function(e){var i=new l;return this.hasOwnProperty("getItemID")&&(i.getItemID=this.getItemID),this.each(function(t){!0===e(t)&&i.add(t)}),i},l.prototype.groupBy=function(e,t){var i,n,r={},o=c(e),s=this.getItemID;if(a.isArray(e)){if(a.forEachArray(e,function(t){r[t+""]=new l(s)}),!t)return r;e=t,o=!0}return this.each(function(t){o?n=e(t):(n=t[e],c(n)&&(n=n.apply(t))),(i=r[n])||(i=r[n]=new l(s)),i.add(t)}),r},l.prototype.single=function(){var e;return this.each(function(t){return e=t,!1},this),e},l.prototype.sort=function(t){var e=[];return this.each(function(t){e.push(t)}),c(t)&&(e=e.sort(t)),e},l.prototype.each=function(t,e){n(this.items,t,e||this)},l.prototype.toArray=function(){return this.length?a.map(this.items,function(t){return t}):[]},t.exports=l},function(t,e,i){var n=i(8),r=i(7),o=i(10);function s(t,e){var i=n.stamp(this);t=t||{},n.isUndefined(e)&&(e=r.appendHTMLElement("div")),r.addClass(e,"tui-view-"+i),this.id=i,this.container=e,this.childs=new o(function(t){return n.stamp(t)}),this.parent=null}s.prototype.addChild=function(t,e){e&&e.call(t,this),(t.parent=this).childs.add(t)},s.prototype.removeChild=function(t,e){var i=n.isNumber(t)?this.childs.items[t]:t;t=n.stamp(i),e&&e.call(i,this),this.childs.remove(t)},s.prototype.render=function(){this.childs.each(function(t){t.render()})},s.prototype.recursive=function(e,t){n.isFunction(e)&&(t||e(this),this.childs.each(function(t){t.recursive(e)}))},s.prototype.resize=function(){for(var t=Array.prototype.slice.call(arguments),e=this.parent;e;)n.isFunction(e._onResize)&&e._onResize.apply(e,t),e=e.parent},s.prototype._beforeDestroy=function(){},s.prototype._destroy=function(){this._beforeDestroy(),this.childs.clear(),this.container.innerHTML="",this.id=this.parent=this.childs=this.container=null},s.prototype.destroy=function(t){this.childs.each(function(t){t.destroy(!0),t._destroy()}),t||this._destroy()},s.prototype.getViewBound=function(){var t=this.container,e=r.getPosition(t),i=r.getSize(t);return{x:e[0],y:e[1],width:i[0],height:i[1]}},t.exports=s},function(e,t,n){(function(r){var i=n(8),o=n(7),s=n(9);function t(t,e){s.on(e,"mousedown",this._onMouseDown,this),this.options=i.extend({distance:10},t),this.container=e,this._isMoved=!1,this._distance=0,this._dragStartFired=!1,this._dragStartEventData=null}t.prototype.destroy=function(){s.off(this.container,"mousedown",this._onMouseDown,this),this.options=this.container=this._isMoved=this._distance=this._dragStartFired=this._dragStartEventData=null},t.prototype._toggleDragEvent=function(t){var e,i,n=this.container;i=t?(e="on","disable"):(e="off","enable"),o[i+"TextSelection"](n),o[i+"ImageDrag"](n),s[e](r.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp},this)},t.prototype._getEventData=function(t){return{target:t.target||t.srcElement,originEvent:t}},t.prototype._onMouseDown=function(t){0===s.getMouseButton(t)&&(this._distance=0,this._dragStartFired=!1,this._dragStartEventData=this._getEventData(t),this._toggleDragEvent(!0))},t.prototype._onMouseMove=function(t){var e=this.options.distance;s.preventDefault(t),this._isMoved=!0,this._distance<e?this._distance+=1:this._dragStartFired||(this._dragStartFired=!0,this.invoke("dragStart",this._dragStartEventData))?this.fire("drag",this._getEventData(t)):this._toggleDragEvent(!1)},t.prototype._onMouseUp=function(t){if(this._toggleDragEvent(!1),this._isMoved)return this._isMoved=!1,void this.fire("dragEnd",this._getEventData(t));this.fire("click",this._getEventData(t))},i.CustomEvents.mixin(t),e.exports=t}).call(t,function(){return this}())},function(t,e,i){var n=i(8),r=i(14),o=i(15),s=i(16),a=i(18),c=!1;function l(t){var e;if(!(this instanceof l))return new l(t);if(!(t=this.options=n.extend({container:null,color:"#f8f8f8",preset:["#181818","#282828","#383838","#585858","#b8b8b8","#d8d8d8","#e8e8e8","#f8f8f8","#ab4642","#dc9656","#f7ca88","#a1b56c","#86c1b9","#7cafc2","#ba8baf","#a16946"],cssPrefix:"tui-colorpicker-",detailTxt:"Detail",usageStatistics:!0},t)).container)throw new Error("ColorPicker(): need container option.");e=this.layout=new o(t,t.container),this.palette=new s(t,e.container),this.palette.on({_selectColor:this._onSelectColorInPalette,_toggleSlider:this._onToggleSlider},this),this.slider=new a(t,e.container),this.slider.on("_selectColor",this._onSelectColorInSlider,this),e.addChild(this.palette),e.addChild(this.slider),this.render(t.color),t.usageStatistics&&function(){var t=location.hostname;c||(c=!0,n.imagePing("https://www.google-analytics.com/collect",{v:1,t:"event",tid:"UA-115377265-9",cid:t,dp:t,dh:"color-picker"}))}()}l.prototype._onSelectColorInPalette=function(t){var e=t.color,i=this.options;r.isValidRGB(e)||""===e?(this.fire("selectColor",{color:e,origin:"palette"}),i.color!==e&&(i.color=e,this.render(e))):this.render()},l.prototype._onToggleSlider=function(){this.slider.toggle(!this.slider.isVisible())},l.prototype._onSelectColorInSlider=function(t){var e=t.color,i=this.options;this.fire("selectColor",{color:e,origin:"slider"}),i.color!==e&&(i.color=e,this.palette.render(e))},l.prototype.setColor=function(t){if(!r.isValidRGB(t))throw new Error("ColorPicker#setColor(): need valid hex string color value");this.options.color=t,this.render(t)},l.prototype.getColor=function(){return this.options.color},l.prototype.toggle=function(t){this.layout.container.style.display=t?"block":"none"},l.prototype.render=function(t){this.layout.render(t||this.options.color)},l.prototype.destroy=function(){this.layout.destroy(),this.options.container.innerHTML="",this.layout=this.slider=this.palette=this.options=null},n.CustomEvents.mixin(l),t.exports=l},function(t,e){var i=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,r={leadingZero:function(t,e){var i="",n=0;if(e<(t+"").length)return t+"";for(;n<e-1;n+=1)i+="0";return(i+t).slice(-1*e)},isValidRGB:function(t){return i.test(t)},hexToRGB:function(t){return!!r.isValidRGB(t)&&(t=t.substring(1),[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)])},rgbToHEX:function(t,e,i){var n="#"+r.leadingZero(t.toString(16),2)+r.leadingZero(e.toString(16),2)+r.leadingZero(i.toString(16),2);return!!r.isValidRGB(n)&&n},rgbToHSV:function(t,e,i){var n,r,o,s,a,c;if(t/=255,e/=255,i/=255,c=(a=n=Math.max(t,e,i))-(r=Math.min(t,e,i)),s=0===n?0:c/n,n===r)o=0;else{switch(n){case t:o=(e-i)/c+(e<i?6:0);break;case e:o=(i-t)/c+2;break;case i:o=(t-e)/c+4}o/=6}return[Math.round(360*o),Math.round(100*s),Math.round(100*a)]},hsvToRGB:function(t,e,i){var n,r,o,s,a,c,l,u;if(t=Math.max(0,Math.min(360,t)),e=Math.max(0,Math.min(100,e)),i=Math.max(0,Math.min(100,i)),i/=100,0===(e/=100))return n=r=o=i,[Math.round(255*n),Math.round(255*r),Math.round(255*o)];switch(c=i*(1-e),l=i*(1-e*(a=(t/=60)-(s=Math.floor(t)))),u=i*(1-e*(1-a)),s){case 0:n=i,r=u,o=c;break;case 1:n=l,r=i,o=c;break;case 2:n=c,r=i,o=u;break;case 3:n=c,r=l,o=i;break;case 4:n=u,r=c,o=i;break;default:n=i,r=c,o=l}return[Math.round(255*n),Math.round(255*r),Math.round(255*o)]}};t.exports=r},function(t,e,i){var n=i(8),r=i(7),o=i(11);function s(t,e){this.options=n.extend({cssPrefix:"tui-colorpicker-"},t),e=r.appendHTMLElement("div",e,this.options.cssPrefix+"container"),o.call(this,t,e),this.render()}n.inherit(s,o),s.prototype.render=function(e){this.recursive(function(t){t.render(e)},!0)},t.exports=s},function(t,e,i){var r=i(8),o=i(7),s=i(14),a=i(9),n=i(11),c=i(17);function l(t,e){this.options=r.extend({cssPrefix:"tui-colorpicker-",preset:["#181818","#282828","#383838","#585858","#B8B8B8","#D8D8D8","#E8E8E8","#F8F8F8","#AB4642","#DC9656","#F7CA88","#A1B56C","#86C1B9","#7CAFC2","#BA8BAF","#A16946"],detailTxt:"Detail"},t),e=o.appendHTMLElement("div",e,this.options.cssPrefix+"palette-container"),n.call(this,t,e)}r.inherit(l,n),l.prototype._onClick=function(t){var e=this.options,i=t.srcElement||t.target,n={};if(o.hasClass(i,e.cssPrefix+"palette-button"))return n.color=i.value,void this.fire("_selectColor",n);o.hasClass(i,e.cssPrefix+"palette-toggle-slider")&&this.fire("_toggleSlider")},l.prototype._onChange=function(t){var e=this.options,i=t.srcElement||t.target,n={};o.hasClass(i,e.cssPrefix+"palette-hex")&&(n.color=i.value,this.fire("_selectColor",n))},l.prototype._beforeDestroy=function(){this._toggleEvent(!1)},l.prototype._toggleEvent=function(t){var e,i=this.options,n=this.container,r=a[t?"on":"off"];r(n,"click",this._onClick,this),(e=o.find("."+i.cssPrefix+"palette-hex",n))&&r(e,"change",this._onChange,this)},l.prototype.render=function(i){var n=this.options,t="";this._toggleEvent(!1),t=c.layout.replace("{{colorList}}",r.map(n.preset,function(t){var e="";return s.isValidRGB(t)&&(e=o.applyTemplate(c.itemStyle,{color:t})),o.applyTemplate(c.item,{itemStyle:e,itemClass:t?"":" "+n.cssPrefix+"color-transparent",color:t,cssPrefix:n.cssPrefix,selected:t===i?" "+n.cssPrefix+"selected":""})}).join("")),t=o.applyTemplate(t,{cssPrefix:n.cssPrefix,detailTxt:n.detailTxt,color:i}),this.container.innerHTML=t,this._toggleEvent(!0)},r.CustomEvents.mixin(l),t.exports=l},function(t,e){var i=['<ul class="{{cssPrefix}}clearfix">{{colorList}}</ul>','<div class="{{cssPrefix}}clearfix" style="overflow:hidden">','<input type="button" class="{{cssPrefix}}palette-toggle-slider" value="{{detailTxt}}" />','<input type="text" class="{{cssPrefix}}palette-hex" value="{{color}}" maxlength="7" />','<span class="{{cssPrefix}}palette-preview" style="background-color:{{color}};color:{{color}}">{{color}}</span>',"</div>"].join("\n");t.exports={layout:i,item:'<li><input class="{{cssPrefix}}palette-button{{selected}}{{itemClass}}" type="button" style="{{itemStyle}}" title="{{color}}" value="{{color}}" /></li>',itemStyle:"background-color:{{color}};color:{{color}}"}},function(t,e,i){var n=i(8),s=i(7),r=i(9),a=i(19),c=i(14),o=i(11),l=i(12),u=i(20),h=[-7,112],f=[-3,115];function d(t,e){(e=s.appendHTMLElement("div",e,t.cssPrefix+"slider-container")).style.display="none",o.call(this,t,e),this.options=n.extend({color:"#f8f8f8",cssPrefix:"tui-colorpicker-"},t),this._dragDataCache={},this.sliderHandleElement=null,this.huebarHandleElement=null,this.baseColorElement=null,this.drag=new l({distance:0},e),this.drag.on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd,click:this._onClick},this)}n.inherit(d,o),d.prototype._beforeDestroy=function(){this.drag.off(),this.drag=this.options=this._dragDataCache=this.sliderHandleElement=this.huebarHandleElement=this.baseColorElement=null},d.prototype.toggle=function(t){this.container.style.display=t?"block":"none"},d.prototype.isVisible=function(){return"block"===this.container.style.display},d.prototype.render=function(t){var e,i,n=this.container,r=this.options,o=u.layout;c.isValidRGB(t)&&(o=(o=(o=o.replace(/{{slider}}/,u.slider)).replace(/{{huebar}}/,u.huebar)).replace(/{{cssPrefix}}/g,r.cssPrefix),this.container.innerHTML=o,this.sliderHandleElement=s.find("."+r.cssPrefix+"slider-handle",n),this.huebarHandleElement=s.find("."+r.cssPrefix+"huebar-handle",n),this.baseColorElement=s.find("."+r.cssPrefix+"slider-basecolor",n),e=c.hexToRGB(t),i=c.rgbToHSV.apply(null,e),this.moveHue(i[0],!0),this.moveSaturationAndValue(i[1],i[2],!0))},d.prototype._moveColorSliderHandle=function(t,e,i){var n,r=this.sliderHandleElement;e=Math.max(h[0],e),e=Math.min(h[1],e),t=Math.max(h[0],t),t=Math.min(h[1],t),a.setTranslateXY(r,t,e),n=50<e?"white":"black",a.setStrokeColor(r,n),i||this.fire("_selectColor",{color:c.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveSaturationAndValue=function(t,e,i){var n,r,o,s;t=t||0,e=e||0,n=Math.abs(h[0]),o=t*(r=h[1])/100-n,s=r-e*r/100-n,this._moveColorSliderHandle(o,s,i)},d.prototype._moveColorSliderByPosition=function(t,e){var i=h[0];this._moveColorSliderHandle(t+i,e+i)},d.prototype.getSaturationAndValue=function(){var t=Math.abs(h[0]),e=t+h[1],i=a.getTranslateXY(this.sliderHandleElement);return[(i[1]+t)/e*100,100-(i[0]+t)/e*100]},d.prototype._moveHueHandle=function(t,e){var i,n,r=this.huebarHandleElement,o=this.baseColorElement;t=Math.max(f[0],t),t=Math.min(f[1],t),a.setTranslateY(r,t),i=c.hsvToRGB(this.getHue(),100,100),n=c.rgbToHEX.apply(null,i),a.setGradientColorStop(o,n),e||this.fire("_selectColor",{color:c.rgbToHEX.apply(null,this.getRGB())})},d.prototype.moveHue=function(t,e){var i,n;i=((n=Math.abs(f[0]))+f[1])*(t=t||0)/359.99-n,this._moveHueHandle(i,e)},d.prototype._moveHueByPosition=function(t){var e=f[0];this._moveHueHandle(t+e)},d.prototype.getHue=function(){var t,e,i=this.huebarHandleElement,n=a.getTranslateXY(i);return e=(t=Math.abs(f[0]))+f[1],359.99*(n[0]+t)/e},d.prototype.getHSV=function(){var t=this.getSaturationAndValue();return[this.getHue()].concat(t)},d.prototype.getRGB=function(){return c.hsvToRGB.apply(null,this.getHSV())},d.prototype._prepareColorSliderForMouseEvent=function(t){var e=this.options,i=s.closest(t.target,"."+e.cssPrefix+"slider-part");return this._dragDataCache={isColorSlider:s.hasClass(i,e.cssPrefix+"slider-left"),parentElement:i}},d.prototype._onClick=function(t){var e=this._prepareColorSliderForMouseEvent(t),i=r.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1]),this._dragDataCache=null},d.prototype._onDragStart=function(t){this._prepareColorSliderForMouseEvent(t)},d.prototype._onDrag=function(t){var e=this._dragDataCache,i=r.getMousePosition(t.originEvent,e.parentElement);e.isColorSlider?this._moveColorSliderByPosition(i[0],i[1]):this._moveHueByPosition(i[1])},d.prototype._onDragEnd=function(){this._dragDataCache=null},n.CustomEvents.mixin(d),t.exports=d},function(t,e,i){var n=i(8),r=/[\.\-0-9]+/g,o={isOldBrowser:function(){var t=o._isOldBrowser;return n.isExisty(t)||(o._isOldBrowser=t=n.browser.msie&&n.browser.version<9),t},getTranslateXY:function(t){var e;return o.isOldBrowser()?(e=t.style,[parseFloat(e.top),parseFloat(e.left)]):(e=t.getAttribute("transform"))?(e=e.match(r),[parseFloat(e[1]),parseFloat(e[0])]):[0,0]},setTranslateXY:function(t,e,i){o.isOldBrowser()?(t.style.left=e+"px",t.style.top=i+"px"):t.setAttribute("transform","translate("+e+","+i+")")},setTranslateY:function(t,e){o.isOldBrowser()?t.style.top=e+"px":t.setAttribute("transform","translate(-6,"+e+")")},setStrokeColor:function(t,e){o.isOldBrowser()?t.strokecolor=e:t.setAttribute("stroke",e)},setGradientColorStop:function(t,e){o.isOldBrowser()?t.color=e:t.setAttribute("stop-color",e)}};t.exports=o},function(c,t,l){(function(t){var e=l(8),i=['<div class="{{cssPrefix}}slider-left {{cssPrefix}}slider-part">{{slider}}</div>','<div class="{{cssPrefix}}slider-right {{cssPrefix}}slider-part">{{huebar}}</div>'].join("\n"),n=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-slider">',"<defs>",'<linearGradient id="{{cssPrefix}}svg-fill-color" x1="0%" y1="0%" x2="100%" y2="0%">','<stop offset="0%" stop-color="rgb(255,255,255)" />','<stop class="{{cssPrefix}}slider-basecolor" offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>",'<linearGradient id="{{cssPrefix}}svn-fill-black" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />','<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:1" />',"</linearGradient>","</defs>",'<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svg-fill-color)"></rect>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svn-fill-black)"></rect>','<path transform="translate(0,0)" class="{{cssPrefix}}slider-handle" d="M0 7.5 L15 7.5 M7.5 15 L7.5 0 M2 7 a5.5 5.5 0 1 1 0 1 Z" stroke="black" stroke-width="0.75" fill="none" />',"</svg>"].join("\n"),r=['<div class="{{cssPrefix}}vml-slider">','<v:rect strokecolor="none" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill class="{{cssPrefix}}vml {{cssPrefix}}slider-basecolor" type="gradient" method="none" color="#ff0000" color2="#fff" angle="90" />',"</v:rect>",'<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill type="gradient" method="none" color="black" color2="white" o:opacity2="0%" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}slider-handle" coordsize="1 1" style="width:1px;height:1px;"path="m 0,7 l 14,7 m 7,14 l 7,0 ar 12,12 2,2 z" filled="false" stroked="true" />',"</div>"].join("\n"),o=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-huebar">',"<defs>",'<linearGradient id="g" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" stop-color="rgb(255,0,0)" />','<stop offset="16.666%" stop-color="rgb(255,255,0)" />','<stop offset="33.333%" stop-color="rgb(0,255,0)" />','<stop offset="50%" stop-color="rgb(0,255,255)" />','<stop offset="66.666%" stop-color="rgb(0,0,255)" />','<stop offset="83.333%" stop-color="rgb(255,0,255)" />','<stop offset="100%" stop-color="rgb(255,0,0)" />',"</linearGradient>","</defs>",'<rect width="18px" height="100%" fill="url(#g)"></rect>','<path transform="translate(-6,-3)" class="{{cssPrefix}}huebar-handle" d="M0 0 L4 4 L0 8 L0 0 Z" fill="black" stroke="none" />',"</svg>"].join("\n"),s=['<div class="{{cssPrefix}}vml-huebar">','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-huebar-bg">','<v:fill type="gradient" method="none" colors="0% rgb(255,0,0), 16.666% rgb(255,255,0), 33.333% rgb(0,255,0), 50% rgb(0,255,255), 66.666% rgb(0,0,255), 83.333% rgb(255,0,255), 100% rgb(255,0,0)" angle="180" class="{{cssPrefix}}vml" />',"</v:rect>",'<v:shape class="{{cssPrefix}}vml {{cssPrefix}}huebar-handle" coordsize="1 1" style="width:1px;height:1px;position:absolute;z-index:1;right:22px;top:-3px;"path="m 0,0 l 4,4 l 0,8 l 0,0 z" filled="true" fillcolor="black" stroked="false" />',"</div>"].join("\n"),a=e.browser.msie&&e.browser.version<9;a&&t.document.namespaces.add("v","urn:schemas-microsoft-com:vml"),c.exports={layout:i,slider:a?r:n,huebar:a?s:o}}).call(t,function(){return this}())}],n.c=o,n.p="dist",n(0);function n(t){if(o[t])return o[t].exports;var e=o[t]={exports:{},id:t,loaded:!1};return r[t].call(e.exports,e,e.exports,n),e.loaded=!0,e.exports}var r,o}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("tui-code-snippet"),require("tui-color-picker"),require("fabric/dist/fabric.require")):"function"==typeof define&&define.amd?define(["tui-code-snippet","tui-color-picker","fabric/dist/fabric.require"],e):"object"==typeof exports?exports.ImageEditor=e(require("tui-code-snippet"),require("tui-color-picker"),require("fabric/dist/fabric.require")):(t.tui=t.tui||{},t.tui.ImageEditor=e(t.tui&&t.tui.util,t.tui&&t.tui.colorPicker,t.fabric))}(this,function(i,n,r){return a={},o.m=s=[function(t,e,i){i(1);var n,r=i(2),o=(n=r)&&n.__esModule?n:{default:n};i(131),i(133),i(134),i(135),i(136),i(137),i(138),i(139),i(140),i(141),i(142),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),i(151),t.exports=o.default},function(t,e){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;if(!document.documentElement.contains(e))return null;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}),"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(t){if("Element"in t){var e="classList",i="prototype",n=t.Element[i],r=Object,o=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[i].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},a=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},c=function(t,e){if(""===e)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(t,e)},l=function(t){for(var e=o.call(t.getAttribute("class")||""),i=e?e.split(/\s+/):[],n=0,r=i.length;n<r;n++)this.push(i[n]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[i]=[],h=function(){return new l(this)};if(a[i]=Error[i],u.item=function(t){return this[t]||null},u.contains=function(t){return-1!==c(this,t+="")},u.add=function(){for(var t,e=arguments,i=0,n=e.length,r=!1;-1===c(this,t=e[i]+"")&&(this.push(t),r=!0),++i<n;);r&&this._updateClassName()},u.remove=function(){var t,e,i=arguments,n=0,r=i.length,o=!1;do{for(e=c(this,t=i[n]+"");-1!==e;)this.splice(e,1),o=!0,e=c(this,t)}while(++n<r);o&&this._updateClassName()},u.toggle=function(t,e){t+="";var i=this.contains(t),n=i?!0!==e&&"remove":!1!==e&&"add";return n&&this[n](t),!0===e||!1===e?e:!i},u.toString=function(){return this.join(" ")},r.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{r.defineProperty(n,e,f)}catch(t){void 0!==t.number&&-2146823252!==t.number||(f.enumerable=!1,r.defineProperty(n,e,f))}}else r[i].__defineGetter__&&n.__defineGetter__(e,h)}}(window.self),function(){var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var n=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var e,i=arguments.length;for(e=0;e<i;e++)t=arguments[e],n.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var i=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:i.call(this,t)}}t=null}()),function(){if("undefined"!=typeof window&&window.addEventListener){var t,e,i,_=Object.create(null),x=function(){clearTimeout(e),e=setTimeout(t,100)},C=function(){},w="http://www.w3.org/1999/xlink";t=function(){var t,e,i,n,r,o,s,a,c,l,u,h,f,d,p=0;function g(){0===(p-=1)&&(C(),function(){var t;window.addEventListener("resize",x,!1),window.addEventListener("orientationchange",x,!1),C=window.MutationObserver?((t=new MutationObserver(x)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),function(){try{t.disconnect(),window.removeEventListener("resize",x,!1),window.removeEventListener("orientationchange",x,!1)}catch(t){}}):(document.documentElement.addEventListener("DOMSubtreeModified",x,!1),function(){document.documentElement.removeEventListener("DOMSubtreeModified",x,!1),window.removeEventListener("resize",x,!1),window.removeEventListener("orientationchange",x,!1)})}())}function v(t){return function(){!0!==_[t.base]&&(t.useEl.setAttributeNS(w,"xlink:href","#"+t.hash),t.useEl.hasAttribute("href")&&t.useEl.setAttribute("href","#"+t.hash))}}function m(n){return function(){var t,e=document.body,i=document.createElement("x");n.onload=null,i.innerHTML=n.responseText,(t=i.getElementsByTagName("svg")[0])&&(t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.width=0,t.style.height=0,t.style.overflow="hidden",e.insertBefore(t,e.firstChild)),g()}}function b(t){return function(){t.onerror=null,t.ontimeout=null,g()}}for(C(),c=document.getElementsByTagName("use"),r=0;r<c.length;r+=1){try{e=c[r].getBoundingClientRect()}catch(t){e=!1}t=(a=(n=c[r].getAttribute("href")||c[r].getAttributeNS(w,"href")||c[r].getAttribute("xlink:href"))&&n.split?n.split("#"):["",""])[0],i=a[1],o=e&&0===e.left&&0===e.right&&0===e.top&&0===e.bottom,e&&0===e.width&&0===e.height&&!o?(c[r].hasAttribute("href")&&c[r].setAttributeNS(w,"xlink:href",n),t.length&&(!0!==(l=_[t])&&setTimeout(v({useEl:c[r],base:t,hash:i}),0),void 0===l&&(u=t,d=f=h=void 0,window.XMLHttpRequest&&(h=new XMLHttpRequest,f=y(location),d=y(u),h=void 0===h.withCredentials&&""!==d&&d!==f?XDomainRequest||void 0:XMLHttpRequest),void 0!==(s=h)&&(l=new s,(_[t]=l).onload=m(l),l.onerror=b(l),l.ontimeout=b(l),l.open("GET",t),l.send(),p+=1)))):o?t.length&&_[t]&&setTimeout(v({useEl:c[r],base:t,hash:i}),0):void 0===_[t]?_[t]=!0:_[t].onload&&(_[t].abort(),delete _[t].onload,_[t]=!0)}function y(t){var e;return void 0!==t.protocol?e=t:(e=document.createElement("a")).href=t,e.protocol.replace(/:/g,"")+e.host}c="",p+=1,g()},i=function(){window.removeEventListener("load",i,!1),e=setTimeout(t,0)},"complete"!==document.readyState?window.addEventListener("load",i,!1):i()}}()},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=p(i(3)),s=p(i(4)),a=p(i(68)),c=p(i(74)),l=p(i(103)),u=p(i(69)),h=p(i(105)),f=p(i(73)),d=i(72);function p(t){return t&&t.__esModule?t:{default:t}}var g=f.default.eventNames,v=f.default.commandNames,m=f.default.keyCodes,b=f.default.rejectMessages,y=o.default.isUndefined,_=o.default.forEach,x=o.default.CustomEvents,C=(n(w,[{key:"_setSelectionStyle",value:function(e,t){var i=t.applyCropSelectionStyle,n=t.applyGroupSelectionStyle;e&&this._graphics.setSelectionStyle(e),i&&this._graphics.setCropSelectionStyle(e),n&&this.on("selectionCreated",function(t){"group"===t.type&&t.set(e)})}},{key:"_attachInvokerEvents",value:function(){var t=g.UNDO_STACK_CHANGED,e=g.REDO_STACK_CHANGED;this._invoker.on(t,this.fire.bind(this,t)),this._invoker.on(e,this.fire.bind(this,e))}},{key:"_attachGraphicsEvents",value:function(){this._graphics.on({mousedown:this._handlers.mousedown,objectMoved:this._handlers.objectMoved,objectScaled:this._handlers.objectScaled,objectActivated:this._handlers.objectActivated,addText:this._handlers.addText,addObject:this._handlers.addObject,textEditing:this._handlers.textEditing,textChanged:this._handlers.textChanged,iconCreateResize:this._handlers.iconCreateResize,iconCreateEnd:this._handlers.iconCreateEnd,selectionCleared:this._handlers.selectionCleared,selectionCreated:this._handlers.selectionCreated,addObjectAfter:this._handlers.addObjectAfter})}},{key:"_attachDomEvents",value:function(){document.addEventListener("keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){document.removeEventListener("keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(t){var e=this._graphics.getActiveObject(),i=this._graphics.getActiveGroupObject(),n=e||i;(t.ctrlKey||t.metaKey)&&t.keyCode===m.Z&&this.undo().catch(function(){}),(t.ctrlKey||t.metaKey)&&t.keyCode===m.Y&&this.redo().catch(function(){}),t.keyCode!==m.BACKSPACE&&t.keyCode!==m.DEL||!n||(t.preventDefault(),this.removeActiveObject())}},{key:"removeActiveObject",value:function(){var t=this._graphics.getActiveObject(),e=this._graphics.getActiveGroupObject();if(e){var i=e.getObjects();this.discardSelection(),this._removeObjectStream(i)}else if(t){var n=this._graphics.getObjectId(t);this.removeObject(n)}}},{key:"_removeObjectStream",value:function(t){var e=this;if(!t.length)return!0;var i=t.pop();return this.removeObject(this._graphics.getObjectId(i)).then(function(){return e._removeObjectStream(t)})}},{key:"_onMouseDown",value:function(t,e){this.fire(g.MOUSE_DOWN,t,e)}},{key:"_pushAddObjectCommand",value:function(t){var e=u.default.create(v.ADD_OBJECT,this._graphics,t);this._invoker.pushUndoStack(e)}},{key:"_onObjectActivated",value:function(t){this.fire(g.OBJECT_ACTIVATED,t)}},{key:"_onObjectMoved",value:function(t){this.fire(g.OBJECT_MOVED,t)}},{key:"_onObjectScaled",value:function(t){this.fire(g.OBJECT_SCALED,t)}},{key:"getDrawingMode",value:function(){return this._graphics.getDrawingMode()}},{key:"clearObjects",value:function(){return this.execute(v.CLEAR_OBJECTS)}},{key:"deactivateAll",value:function(){this._graphics.deactivateAll(),this._graphics.renderAll()}},{key:"discardSelection",value:function(){this._graphics.discardSelection()}},{key:"changeSelectableAll",value:function(t){this._graphics.changeSelectableAll(t)}},{key:"execute",value:function(t){for(var e,i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var o=[this._graphics].concat(n);return(e=this._invoker).execute.apply(e,[t].concat(o))}},{key:"undo",value:function(){return this._invoker.undo()}},{key:"redo",value:function(){return this._invoker.redo()}},{key:"loadImageFromFile",value:function(e,t){if(!e)return s.default.reject(b.invalidParameters);var i=URL.createObjectURL(e);return t=t||e.name,this.loadImageFromURL(i,t).then(function(t){return URL.revokeObjectURL(e),t})}},{key:"loadImageFromURL",value:function(t,e){return e&&t?this.execute(v.LOAD_IMAGE,e,t):s.default.reject(b.invalidParameters)}},{key:"addImageObject",value:function(t){return t?this.execute(v.ADD_IMAGE_OBJECT,t):s.default.reject(b.invalidParameters)}},{key:"startDrawingMode",value:function(t,e){return this._graphics.startDrawingMode(t,e)}},{key:"stopDrawingMode",value:function(){this._graphics.stopDrawingMode()}},{key:"crop",value:function(t){var e=this._graphics.getCroppedImageData(t);return e?this.loadImageFromURL(e.url,e.imageName):s.default.reject(b.invalidParameters)}},{key:"getCropzoneRect",value:function(){return this._graphics.getCropzoneRect()}},{key:"setCropzoneRect",value:function(t){this._graphics.setCropzoneRect(t)}},{key:"_flip",value:function(t){return this.execute(v.FLIP_IMAGE,t)}},{key:"flipX",value:function(){return this._flip("flipX")}},{key:"flipY",value:function(){return this._flip("flipY")}},{key:"resetFlip",value:function(){return this._flip("reset")}},{key:"_rotate",value:function(t,e){return this.execute(v.ROTATE_IMAGE,t,e)}},{key:"rotate",value:function(t){return this._rotate("rotate",t)}},{key:"setAngle",value:function(t){return this._rotate("setAngle",t)}},{key:"setBrush",value:function(t){this._graphics.setBrush(t)}},{key:"setDrawingShape",value:function(t,e){this._graphics.setDrawingShape(t,e)}},{key:"addShape",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(v.ADD_SHAPE,t,e)}},{key:"changeShape",value:function(t,e){return this.execute(v.CHANGE_SHAPE,t,e)}},{key:"addText",value:function(t,e){return t=t||"",e=e||{},this.execute(v.ADD_TEXT,t,e)}},{key:"changeText",value:function(t,e){return e=e||"",this.execute(v.CHANGE_TEXT,t,e)}},{key:"changeTextStyle",value:function(t,e){return this.execute(v.CHANGE_TEXT_STYLE,t,e)}},{key:"_changeActivateMode",value:function(t){"ICON"!==t&&this.getDrawingMode()!==t&&this.startDrawingMode(t)}},{key:"_onTextChanged",value:function(t){this.changeText(t.id,t.text)}},{key:"_onIconCreateResize",value:function(t){this.fire(g.ICON_CREATE_RESIZE,t)}},{key:"_onIconCreateEnd",value:function(t){this.fire(g.ICON_CREATE_END,t)}},{key:"_onTextEditing",value:function(){this.fire(g.TEXT_EDITING)}},{key:"_onAddText",value:function(t){this.fire(g.ADD_TEXT,{originPosition:t.originPosition,clientPosition:t.clientPosition})}},{key:"_onAddObject",value:function(t){var e=this._graphics.getObject(t.id);this._pushAddObjectCommand(e)}},{key:"_onAddObjectAfter",value:function(t){this.fire(g.ADD_OBJECT_AFTER,t)}},{key:"_selectionCleared",value:function(){this.fire(g.SELECTION_CLEARED)}},{key:"_selectionCreated",value:function(t){this.fire(g.SELECTION_CREATED,t)}},{key:"registerIcons",value:function(t){this._graphics.registerPaths(t)}},{key:"changeCursor",value:function(t){this._graphics.changeCursor(t)}},{key:"addIcon",value:function(t,e){return e=e||{},this._setPositions(e),this.execute(v.ADD_ICON,t,e)}},{key:"changeIconColor",value:function(t,e){return this.execute(v.CHANGE_ICON_COLOR,t,e)}},{key:"removeObject",value:function(t){return this.execute(v.REMOVE_OBJECT,t)}},{key:"hasFilter",value:function(t){return this._graphics.hasFilter(t)}},{key:"removeFilter",value:function(t){return this.execute(v.REMOVE_FILTER,t)}},{key:"applyFilter",value:function(t,e){return this.execute(v.APPLY_FILTER,t,e)}},{key:"toDataURL",value:function(t){return this._graphics.toDataURL(t)}},{key:"getImageName",value:function(){return this._graphics.getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(t){return t?this.execute(v.RESIZE_CANVAS_DIMENSION,t):s.default.reject(b.invalidParameters)}},{key:"destroy",value:function(){var i=this;this.stopDrawingMode(),this._detachDomEvents(),this._graphics.destroy(),this._graphics=null,_(this,function(t,e){i[e]=null},this)}},{key:"_setPositions",value:function(t){var e=this._graphics.getCenter();y(t.left)&&(t.left=e.left),y(t.top)&&(t.top=e.top)}},{key:"setObjectProperties",value:function(t,e){return this.execute(v.SET_OBJECT_PROPERTIES,t,e)}},{key:"setObjectPropertiesQuietly",value:function(t,e){this._graphics.setObjectProperties(t,e)}},{key:"getObjectProperties",value:function(t,e){return this._graphics.getObject(t)?this._graphics.getObjectProperties(t,e):null}},{key:"getCanvasSize",value:function(){return this._graphics.getCanvasSize()}},{key:"getObjectPosition",value:function(t,e,i){return this._graphics.getObjectPosition(t,e,i)}},{key:"setObjectPosition",value:function(t,e){return this.execute(v.SET_OBJECT_POSITION,t,e)}}]),w);function w(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,w),e=o.default.extend({includeUI:!1,usageStatistics:!0},e),this.mode=null,this.activeObjectId=null,e.includeUI&&(this.ui=new c.default(t,e.includeUI,this.getActions()),e=this.ui.setUiDefaultSelectionStyle(e)),this._invoker=new a.default,this._graphics=new h.default(this.ui?this.ui.getEditorArea():t,{cssMaxWidth:e.cssMaxWidth,cssMaxHeight:e.cssMaxHeight,useItext:!!this.ui,useDragAddIcon:!!this.ui}),this._handlers={keydown:this._onKeyDown.bind(this),mousedown:this._onMouseDown.bind(this),objectActivated:this._onObjectActivated.bind(this),objectMoved:this._onObjectMoved.bind(this),objectScaled:this._onObjectScaled.bind(this),createdPath:this._onCreatedPath,addText:this._onAddText.bind(this),addObject:this._onAddObject.bind(this),addObjectAfter:this._onAddObjectAfter.bind(this),textEditing:this._onTextEditing.bind(this),textChanged:this._onTextChanged.bind(this),iconCreateResize:this._onIconCreateResize.bind(this),iconCreateEnd:this._onIconCreateEnd.bind(this),selectionCleared:this._selectionCleared.bind(this),selectionCreated:this._selectionCreated.bind(this)},this._attachInvokerEvents(),this._attachGraphicsEvents(),this._attachDomEvents(),this._setSelectionStyle(e.selectionStyle,{applyCropSelectionStyle:e.applyCropSelectionStyle,applyGroupSelectionStyle:e.applyGroupSelectionStyle}),e.usageStatistics&&(0,d.sendHostName)(),this.ui&&(this.ui.initCanvas(),this.setReAction())}l.default.mixin(C),x.mixin(C),t.exports=C},function(t,e){t.exports=i},function(t,e,i){i(5),i(6),i(50),i(54),t.exports=i(14).Promise},function(t,e){},function(t,e,i){var n=i(7)(!0);i(10)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){var c=i(8),l=i(9);t.exports=function(a){return function(t,e){var i,n,r=String(l(t)),o=c(e),s=r.length;return o<0||s<=o?a?"":void 0:(i=r.charCodeAt(o))<55296||56319<i||o+1===s||(n=r.charCodeAt(o+1))<56320||57343<n?a?r.charAt(o):i:a?r.slice(o,o+2):n-56320+(i-55296<<10)+65536}}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?n:i)(t)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){function y(){return this}var _=i(11),x=i(12),C=i(27),w=i(17),S=i(28),k=i(29),O=i(30),E=i(46),T=i(48),j=i(47)("iterator"),M=!([].keys&&"next"in[].keys()),P="values";t.exports=function(t,e,i,n,r,o,s){O(i,e,n);function a(t){if(!M&&t in p)return p[t];switch(t){case"keys":case P:return function(){return new i(this,t)}}return function(){return new i(this,t)}}var c,l,u,h=e+" Iterator",f=r==P,d=!1,p=t.prototype,g=p[j]||p["@@iterator"]||r&&p[r],v=g||a(r),m=r?f?a("entries"):v:void 0,b="Array"==e&&p.entries||g;if(b&&(u=T(b.call(new t)))!==Object.prototype&&(E(u,h,!0),_||S(u,j)||w(u,j,y)),f&&g&&g.name!==P&&(d=!0,v=function(){return g.call(this)}),_&&!s||!M&&!d&&p[j]||w(p,j,v),k[e]=v,k[h]=y,r)if(c={values:f?v:a(P),keys:o?v:a("keys"),entries:m},s)for(l in c)l in p||C(p,l,c[l]);else x(x.P+x.F*(M||d),e,c);return c}},function(t,e){t.exports=!0},function(t,e,i){var g=i(13),v=i(14),m=i(15),b=i(17),y="prototype",_=function(t,e,i){var n,r,o,s=t&_.F,a=t&_.G,c=t&_.S,l=t&_.P,u=t&_.B,h=t&_.W,f=a?v:v[e]||(v[e]={}),d=f[y],p=a?g:c?g[e]:(g[e]||{})[y];for(n in a&&(i=e),i)(r=!s&&p&&void 0!==p[n])&&n in f||(o=r?p[n]:i[n],f[n]=a&&"function"!=typeof p[n]?i[n]:u&&r?m(o,g):h&&p[n]==o?function(n){function t(t,e,i){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(t);case 2:return new n(t,e)}return new n(t,e,i)}return n.apply(this,arguments)}return t[y]=n[y],t}(o):l&&"function"==typeof o?m(Function.call,o):o,l&&((f.virtual||(f.virtual={}))[n]=o,t&_.R&&d&&!d[n]&&b(d,n,o)))};_.F=1,_.G=2,_.S=4,_.P=8,_.B=16,_.W=32,_.U=64,_.R=128,t.exports=_},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){var i=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=i)},function(t,e,i){var o=i(16);t.exports=function(n,r,t){if(o(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,i){return n.call(r,t,e,i)}}return function(){return n.apply(r,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var n=i(18),r=i(26);t.exports=i(22)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(19),r=i(21),o=i(25),s=Object.defineProperty;e.f=i(22)?Object.defineProperty:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var n=i(20);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){t.exports=!i(22)&&!i(23)(function(){return 7!=Object.defineProperty(i(24)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){t.exports=!i(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){var n=i(20),r=i(13).document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,i){var r=i(20);t.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){t.exports=i(17)},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e){t.exports={}},function(t,e,i){var n=i(31),r=i(26),o=i(46),s={};i(17)(s,i(47)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(s,{next:r(1,i)}),o(t,e+" Iterator")}},function(t,e,n){function r(){}var o=n(19),s=n(32),a=n(44),c=n(41)("IE_PROTO"),l="prototype",u=function(){var t,e=n(24)("iframe"),i=a.length;for(e.style.display="none",n(45).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;i--;)delete u[l][a[i]];return u()};t.exports=Object.create||function(t,e){var i;return null!==t?(r[l]=o(t),i=new r,r[l]=null,i[c]=t):i=u(),void 0===e?i:s(i,e)}},function(t,e,i){var s=i(18),a=i(19),c=i(33);t.exports=i(22)?Object.defineProperties:function(t,e){a(t);for(var i,n=c(e),r=n.length,o=0;o<r;)s.f(t,i=n[o++],e[i]);return t}},function(t,e,i){var n=i(34),r=i(44);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var s=i(28),a=i(35),c=i(38)(!1),l=i(41)("IE_PROTO");t.exports=function(t,e){var i,n=a(t),r=0,o=[];for(i in n)i!=l&&s(n,i)&&o.push(i);for(;e.length>r;)s(n,i=e[r++])&&(~c(o,i)||o.push(i));return o}},function(t,e,i){var n=i(36),r=i(9);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(37);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var c=i(35),l=i(39),u=i(40);t.exports=function(a){return function(t,e,i){var n,r=c(t),o=l(r.length),s=u(i,o);if(a&&e!=e){for(;s<o;)if((n=r[s++])!=n)return!0}else for(;s<o;s++)if((a||s in r)&&r[s]===e)return a||s||0;return!a&&-1}}},function(t,e,i){var n=i(8),r=Math.min;t.exports=function(t){return 0<t?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(8),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=n(t))<0?r(t+e,0):o(t,e)}},function(t,e,i){var n=i(42)("keys"),r=i(43);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e,i){var n=i(13),r="__core-js_shared__",o=n[r]||(n[r]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){t.exports=i(13).document&&document.documentElement},function(t,e,i){var n=i(18).f,r=i(28),o=i(47)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e})}},function(t,e,i){var n=i(42)("wks"),r=i(43),o=i(13).Symbol,s="function"==typeof o;(t.exports=function(t){return n[t]||(n[t]=s&&o[t]||(s?o:r)("Symbol."+t))}).store=n},function(t,e,i){var n=i(28),r=i(49),o=i(41)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,i){var n=i(9);t.exports=function(t){return Object(n(t))}},function(t,e,i){i(51);for(var n=i(13),r=i(17),o=i(29),s=i(47)("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var l=a[c],u=n[l],h=u&&u.prototype;h&&!h[s]&&r(h,s,l),o[l]=o.Array}},function(t,e,i){var n=i(52),r=i(53),o=i(29),s=i(35);t.exports=i(10)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){function n(){}function r(t,e){return t===e||t===T&&e===f}function u(t){var e;return!(!b(t)||"function"!=typeof(e=t.then))&&e}function o(t){return r(T,t)?new P(t):new h(t)}function l(t){try{t()}catch(t){return{error:t}}}function s(l,i){if(!l._n){l._n=!0;var n=l._c;S(function(){for(var a=l._v,c=1==l._s,t=0,e=function(t){var e,i,n=c?t.ok:t.fail,r=t.resolve,o=t.reject,s=t.domain;try{n?(c||(2==l._h&&D(l),l._h=1),!0===n?e=a:(s&&s.enter(),e=n(a),s&&s.exit()),e===t.promise?o(O("Promise-chain cycle")):(i=u(e))?i.call(e,r,o):r(e)):o(a)}catch(t){o(t)}};n.length>t;)e(n[t++]);l._c=[],l._n=!1,i&&!l._h&&A(l)})}}function a(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),s(e,!0))}var c,h,f,d=i(11),p=i(13),g=i(15),v=i(55),m=i(12),b=i(20),y=i(16),_=i(56),x=i(57),C=i(61),w=i(62).set,S=i(64)(),k="Promise",O=p.TypeError,E=p.process,T=p[k],j="process"==v(E=p.process),M=!!function(){try{var t=T.resolve(1),e=(t.constructor={})[i(47)("species")]=function(t){t(n,n)};return(j||"function"==typeof PromiseRejectionEvent)&&t.then(n)instanceof e}catch(t){}}(),P=h=function(t){var i,n;this.promise=new t(function(t,e){if(void 0!==i||void 0!==n)throw O("Bad Promise constructor");i=t,n=e}),this.resolve=y(i),this.reject=y(n)},A=function(r){w.call(p,function(){var t,e,i,n=r._v;if(I(r)&&(t=l(function(){j?E.emit("unhandledRejection",n,r):(e=p.onunhandledrejection)?e({promise:r,reason:n}):(i=p.console)&&i.error&&i.error("Unhandled promise rejection",n)}),r._h=j||I(r)?2:1),r._a=void 0,t)throw t.error})},I=function(t){if(1==t._h)return!1;for(var e,i=t._a||t._c,n=0;i.length>n;)if((e=i[n++]).fail||!I(e.promise))return!1;return!0},D=function(e){w.call(p,function(){var t;j?E.emit("rejectionHandled",e):(t=p.onrejectionhandled)&&t({promise:e,reason:e._v})})},L=function(t){var i,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw O("Promise can't be resolved itself");(i=u(t))?S(function(){var e={_w:n,_d:!1};try{i.call(t,g(L,e,1),g(a,e,1))}catch(t){a.call(e,t)}}):(n._v=t,n._s=1,s(n,!1))}catch(t){a.call({_w:n,_d:!1},t)}}};M||(T=function(t){_(this,T,k,"_h"),y(t),c.call(this);try{t(g(L,this,1),g(a,this,1))}catch(t){a.call(this,t)}},(c=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(65)(T.prototype,{then:function(t,e){var i=o(C(this,T));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=j?E.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&s(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),P=function(){var t=new c;this.promise=t,this.resolve=g(L,t,1),this.reject=g(a,t,1)}),m(m.G+m.W+m.F*!M,{Promise:T}),i(46)(T,k),i(66)(k),f=i(14)[k],m(m.S+m.F*!M,k,{reject:function(t){var e=o(this);return(0,e.reject)(t),e.promise}}),m(m.S+m.F*(d||!M),k,{resolve:function(t){if(t instanceof T&&r(t.constructor,this))return t;var e=o(this);return(0,e.resolve)(t),e.promise}}),m(m.S+m.F*!(M&&i(67)(function(t){T.all(t).catch(n)})),k,{all:function(t){var s=this,e=o(s),a=e.resolve,c=e.reject,i=l(function(){var n=[],r=0,o=1;x(t,!1,function(t){var e=r++,i=!1;n.push(void 0),o++,s.resolve(t).then(function(t){i||(i=!0,n[e]=t,--o||a(n))},c)}),--o||a(n)});return i&&c(i.error),e.promise},race:function(t){var e=this,i=o(e),n=i.reject,r=l(function(){x(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r&&n(r.error),i.promise}})},function(t,e,i){var r=i(37),o=i(47)("toStringTag"),s="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?i:s?r(e):"Object"==(n=r(e))&&"function"==typeof e.callee?"Arguments":n}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var f=i(15),d=i(58),p=i(59),g=i(19),v=i(39),m=i(60),b={},y={};(e=t.exports=function(t,e,i,n,r){var o,s,a,c,l=r?function(){return t}:m(t),u=f(i,n,e?2:1),h=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(p(l)){for(o=v(t.length);h<o;h++)if((c=e?u(g(s=t[h])[0],s[1]):u(t[h]))===b||c===y)return c}else for(a=l.call(t);!(s=a.next()).done;)if((c=d(a,u,s.value,e))===b||c===y)return c}).BREAK=b,e.RETURN=y},function(t,e,i){var o=i(19);t.exports=function(e,t,i,n){try{return n?t(o(i)[0],i[1]):t(i)}catch(t){var r=e.return;throw void 0!==r&&o(r.call(e)),t}}},function(t,e,i){var n=i(29),r=i(47)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||o[r]===t)}},function(t,e,i){var n=i(55),r=i(47)("iterator"),o=i(29);t.exports=i(14).getIteratorMethod=function(t){if(null!=t)return t[r]||t["@@iterator"]||o[n(t)]}},function(t,e,i){var r=i(19),o=i(16),s=i(47)("species");t.exports=function(t,e){var i,n=r(t).constructor;return void 0===n||null==(i=r(n)[s])?e:o(i)}},function(t,e,i){function n(){var t=+this;if(b.hasOwnProperty(t)){var e=b[t];delete b[t],e()}}function r(t){n.call(t.data)}var o,s,a,c=i(15),l=i(63),u=i(45),h=i(24),f=i(13),d=f.process,p=f.setImmediate,g=f.clearImmediate,v=f.MessageChannel,m=0,b={},y="onreadystatechange";p&&g||(p=function(t){for(var e=[],i=1;i<arguments.length;)e.push(arguments[i++]);return b[++m]=function(){l("function"==typeof t?t:Function(t),e)},o(m),m},g=function(t){delete b[t]},"process"==i(37)(d)?o=function(t){d.nextTick(c(n,t,1))}:v?(a=(s=new v).port2,s.port1.onmessage=r,o=c(a.postMessage,a,1)):f.addEventListener&&"function"==typeof postMessage&&!f.importScripts?(o=function(t){f.postMessage(t+"","*")},f.addEventListener("message",r,!1)):o=y in h("script")?function(t){u.appendChild(h("script"))[y]=function(){u.removeChild(this),n.call(t)}}:function(t){setTimeout(c(n,t,1),0)}),t.exports={set:p,clear:g}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var a=i(13),c=i(62).set,l=a.MutationObserver||a.WebKitMutationObserver,u=a.process,h=a.Promise,f="process"==i(37)(u);t.exports=function(){function t(){var t,e;for(f&&(t=u.domain)&&t.exit();i;){e=i.fn,i=i.next;try{e()}catch(t){throw i?r():n=void 0,t}}n=void 0,t&&t.enter()}var i,n,r;if(f)r=function(){u.nextTick(t)};else if(l){var e=!0,o=document.createTextNode("");new l(t).observe(o,{characterData:!0}),r=function(){o.data=e=!e}}else if(h&&h.resolve){var s=h.resolve();r=function(){s.then(t)}}else r=function(){c.call(a,t)};return function(t){var e={fn:t,next:void 0};n&&(n.next=e),i||(i=e,r()),n=e}}},function(t,e,i){var r=i(17);t.exports=function(t,e,i){for(var n in e)i&&t[n]?t[n]=e[n]:r(t,n,e[n]);return t}},function(t,e,i){var n=i(13),r=i(14),o=i(18),s=i(22),a=i(47)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:n[t];s&&e&&!e[a]&&o.f(e,a,{configurable:!0,get:function(){return this}})}},function(t,e,i){var o=i(47)("iterator"),s=!1;try{var n=[7][o]();n.return=function(){s=!0},Array.from(n,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!s)return!1;var i=!1;try{var n=[7],r=n[o]();r.next=function(){return{done:i=!0}},n[o]=function(){return r},t(n)}catch(t){}return i}},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=l(i(3)),s=l(i(4)),a=l(i(69)),c=l(i(73));function l(t){return t&&t.__esModule?t:{default:t}}var u=c.default.eventNames,h=c.default.rejectMessages,f=o.default.isFunction,d=o.default.isString,p=o.default.CustomEvents,g=(n(v,[{key:"_invokeExecution",value:function(e){var i=this;this.lock();var t=e.args;return t||(t=[]),e.execute.apply(e,t).then(function(t){return i.pushUndoStack(e),i.unlock(),f(e.executeCallback)&&e.executeCallback(t),t}).catch(function(t){return i.unlock(),s.default.reject(t)})}},{key:"_invokeUndo",value:function(e){var i=this;this.lock();var t=e.args;return t||(t=[]),e.undo.apply(e,t).then(function(t){return i.pushRedoStack(e),i.unlock(),f(e.undoCallback)&&e.undoCallback(t),t}).catch(function(t){return i.unlock(),s.default.reject(t)})}},{key:"_fireRedoStackChanged",value:function(){this.fire(u.REDO_STACK_CHANGED,this._redoStack.length)}},{key:"_fireUndoStackChanged",value:function(){this.fire(u.UNDO_STACK_CHANGED,this._undoStack.length)}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"execute",value:function(){var e=this;if(this._isLocked)return s.default.reject(h.isLock);for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=i[0];return d(r)&&(r=a.default.create.apply(a.default,i)),this._invokeExecution(r).then(function(t){return e.clearRedoStack(),t})}},{key:"undo",value:function(){var t=this._undoStack.pop(),e="";return t&&this._isLocked&&(this.pushUndoStack(t,!0),t=null),t?(this.isEmptyUndoStack()&&this._fireUndoStackChanged(),this._invokeUndo(t)):(e=h.undo,this._isLocked&&(e=e+" Because "+h.isLock),s.default.reject(e))}},{key:"redo",value:function(){var t=this._redoStack.pop(),e="";return t&&this._isLocked&&(this.pushRedoStack(t,!0),t=null),t?(this.isEmptyRedoStack()&&this._fireRedoStackChanged(),this._invokeExecution(t)):(e=h.redo,this._isLocked&&(e=e+" Because "+h.isLock),s.default.reject(e))}},{key:"pushUndoStack",value:function(t,e){this._undoStack.push(t),e||this._fireUndoStackChanged()}},{key:"pushRedoStack",value:function(t,e){this._redoStack.push(t),e||this._fireRedoStackChanged()}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fireUndoStackChanged())}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fireRedoStackChanged())}}]),v);function v(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v),this._undoStack=[],this._redoStack=[],this._isLocked=!1}p.mixin(g),t.exports=g},function(t,e,i){var n,r=i(70),o=(n=r)&&n.__esModule?n:{default:n};var s={};t.exports={create:function(t){var e=s[t];if(e){for(var i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return new o.default(e,n)}return null},register:function(t){s[t.name]=t}}},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o,s=i(71),a=(o=s)&&o.__esModule?o:{default:o};var c=a.default.create,l=a.default.types,u=(n(h,[{key:"execute",value:function(){throw new Error(c(l.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(c(l.UN_IMPLEMENTATION,"undo"))}},{key:"setExecuteCallback",value:function(t){return this.executeCallback=t,this}},{key:"setUndoCallback",value:function(t){return this.undoCallback=t,this}}]),h);function h(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),this.name=t.name,this.args=e,this.execute=t.execute,this.undo=t.undo,this.executeCallback=t.executeCallback||null,this.undoCallback=t.undoCallback||null,this.undoData={}}t.exports=u},function(t,e,i){var n,r=i(3),o=(n=r)&&n.__esModule?n:{default:n};var s=(0,i(72).keyMirror)("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),a="Should implement a method: ",c="Should set a component name",l={UN_IMPLEMENTATION:function(t){return a+t},NO_COMPONENT_NAME:function(){return c}};t.exports={types:o.default.extend({},s),create:function(t){t=t.toLowerCase();for(var e=l[t],i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}}},function(t,e,i){var r=i(3),o=Math.min,s=Math.max,n=!1;t.exports={clamp:function(t,e,i){var n=void 0;return i<e&&(n=e,e=i,i=n),s(e,o(t,i))},keyMirror:function(){for(var e={},t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return(0,r.forEach)(i,function(t){e[t]=t}),e},makeStyleText:function(t){var i="";return(0,r.forEach)(t,function(t,e){i+=e+": "+t+";"}),i},getProperties:function(t,e){var i={},n=e.length,r=0,o=void 0;for(r=0;r<n;r+=1)i[o=e[r]]=t[o];return i},toInteger:function(t){return parseInt(t,10)},toCamelCase:function(t){return t.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()})},isSupportFileApi:function(){return!!(window.File&&window.FileList&&window.FileReader)},getRgb:function(t,e){return 4===t.length&&(t=""+t+t.slice(1,4)),"rgba("+parseInt(t.slice(1,3),16)+", "+parseInt(t.slice(3,5),16)+", "+parseInt(t.slice(5,7),16)+", "+(e||1)+")"},sendHostName:function(){n||(n=!0,(0,r.sendHostname)("image-editor","UA-129999381-1"))},styleLoad:function(t,e){var i=document.getElementsByTagName("head")[0],n=document.createElement("link"),r=encodeURIComponent(t);e&&(n.id=e),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","data:text/css;charset=UTF-8,"+r),i.appendChild(n)},getSelector:function(e){return function(t){return e.querySelector(t)}},base64ToBlob:function(t){var i="",e=void 0,n=void 0,r=void 0;e=t.replace(/data:(image\/.+);base64,/,function(t,e){return i=e,""});var o=(e=atob(e)).length;for(n=new Uint8Array(o),r=0;r<o;r+=1)n[r]=e.charCodeAt(r);return new Blob([n],{type:i})}}},function(t,e,i){var n,r=i(72),o=(n=r)&&n.__esModule?n:{default:n};t.exports={componentNames:o.default.keyMirror("IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE"),commandNames:{CLEAR_OBJECTS:"clearObjects",LOAD_IMAGE:"loadImage",FLIP_IMAGE:"flip",ROTATE_IMAGE:"rotate",ADD_OBJECT:"addObject",REMOVE_OBJECT:"removeObject",APPLY_FILTER:"applyFilter",REMOVE_FILTER:"removeFilter",ADD_ICON:"addIcon",CHANGE_ICON_COLOR:"changeIconColor",ADD_SHAPE:"addShape",CHANGE_SHAPE:"changeShape",ADD_TEXT:"addText",CHANGE_TEXT:"changeText",CHANGE_TEXT_STYLE:"changeTextStyle",ADD_IMAGE_OBJECT:"addImageObject",RESIZE_CANVAS_DIMENSION:"resizeCanvasDimension",SET_OBJECT_PROPERTIES:"setObjectProperties",SET_OBJECT_POSITION:"setObjectPosition"},eventNames:{OBJECT_ACTIVATED:"objectActivated",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated"},drawingModes:o.default.keyMirror("NORMAL","CROPPER","FREE_DRAWING","LINE_DRAWING","TEXT","SHAPE"),keyCodes:{Z:90,Y:89,SHIFT:16,BACKSPACE:8,DEL:46},fObjectOptions:{SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},rejectMessages:{addedObject:"The object is already added.",flip:"The flipX and flipY setting values are not changed.",invalidDrawingMode:"This operation is not supported in the drawing mode.",invalidParameters:"Invalid parameters.",isLock:"The executing command state is locked.",loadImage:"The background image is empty.",loadingImageFailed:"Invalid image loaded.",noActiveObject:"There is no active object.",noObject:"The object is not in canvas.",redo:"The promise of redo command is reject.",rotation:"The current angle is same the old angle.",undo:"The promise of undo command is reject.",unsupportedOperation:"Unsupported operation.",unsupportedType:"Unsupported object type."},defaultIconPath:{"icon-arrow":"M40 12V0l24 24-24 24V36H0V12h40z","icon-arrow-2":"M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ","icon-arrow-3":"M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ","icon-star":"M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ","icon-star-2":"M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ","icon-polygon":"M3,31 L19,3 h32 l16,28 l-16,28 H19  z ","icon-location":"M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z","icon-heart":"M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ","icon-bubble":"M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z"},defaultRotateRangeValus:{realTimeEvent:!0,min:-360,max:360,value:0},defaultDrawRangeValus:{min:5,max:30,value:12},defaultShapeStrokeValus:{realTimeEvent:!1,min:2,max:300,value:3},defaultTextRangeValus:{realTimeEvent:!0,min:10,max:100,value:50},defaultFilterRangeValus:{tintOpacityRange:{min:0,max:1,value:.7},removewhiteThresholdRange:{min:0,max:255,value:60},removewhiteDistanceRange:{min:0,max:255,value:10},gradientTransparencyRange:{min:0,max:255,value:100},brightnessRange:{min:-255,max:255,value:100},noiseRange:{min:0,max:1e3,value:100},pixelateRange:{min:2,max:20,value:4},colorfilterThresholeRange:{min:0,max:255,value:45}}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=_(i(3)),s=_(i(72)),a=_(i(75)),c=_(i(76)),l=_(i(77)),u=_(i(80)),h=_(i(86)),f=_(i(88)),d=_(i(90)),p=_(i(92)),g=_(i(94)),v=_(i(96)),m=_(i(98)),b=_(i(100)),y=_(i(102));function _(t){return t&&t.__esModule?t:{default:t}}var x={Shape:u.default,Crop:h.default,Flip:f.default,Rotate:d.default,Text:p.default,Mask:g.default,Icon:v.default,Draw:m.default,Filter:b.default},C=(n(w,[{key:"setUiDefaultSelectionStyle",value:function(t){return o.default.extend({applyCropSelectionStyle:!0,applyGroupSelectionStyle:!0,selectionStyle:{cornerStyle:"circle",cornerSize:16,cornerColor:"#fff",cornerStrokeColor:"#fff",transparentCorners:!1,lineWidth:2,borderColor:"#fff"}},t)}},{key:"resizeEditor",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},i=e.uiSize,n=e.imageSize,r=void 0===n?this.imageSize:n;r!==this.imageSize&&(this.imageSize=r),i&&this._setUiSize(i);var o=this._getEditorDimension(),s=o.width,a=o.height,c=this._editorElement.style,l=this.options.menuBarPosition;c.height=a+"px",c.width=s+"px",this._setEditorPosition(l),this._editorElementWrap.style.bottom="0px",this._editorElementWrap.style.top="0px",this._editorElementWrap.style.left="0px",this._editorElementWrap.style.width="100%";var u=this._selectedElement.classList;"top"===l&&this._selectedElement.offsetWidth<"1300"?u.add("tui-image-editor-top-optimization"):u.remove("tui-image-editor-top-optimization")}},{key:"changeUndoButtonStatus",value:function(t){t?this._els.undo.classList.add("enabled"):this._els.undo.classList.remove("enabled")}},{key:"changeRedoButtonStatus",value:function(t){t?this._els.redo.classList.add("enabled"):this._els.redo.classList.remove("enabled")}},{key:"changeResetButtonStatus",value:function(t){t?this._els.reset.classList.add("enabled"):this._els.reset.classList.remove("enabled")}},{key:"changeDeleteAllButtonEnabled",value:function(t){t?this._els.deleteAll.classList.add("enabled"):this._els.deleteAll.classList.remove("enabled")}},{key:"changeDeleteButtonEnabled",value:function(t){t?this._els.delete.classList.add("enabled"):this._els.delete.classList.remove("enabled")}},{key:"_initializeOption",value:function(t){return o.default.extend({loadImage:{path:"",name:""},locale:{},menuIconPath:"",menu:["crop","flip","rotate","draw","shape","icon","text","mask","filter"],initMenu:"",uiSize:{width:"100%",height:"100%"},menuBarPosition:"bottom"},t)}},{key:"_setUiSize",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.options.uiSize,i=this._selectedElement.style;i.width=e.width,i.height=e.height}},{key:"_makeSubMenu",value:function(){var i=this;o.default.forEach(this.options.menu,function(t){var e=x[t.replace(/^[a-z]/,function(t){return t.toUpperCase()})];i._makeMenuElement(t),i._els[t]=i._menuElement.querySelector("#tie-btn-"+t),i[t]=new e(i._subMenuElement,{locale:i._locale,iconStyle:i.theme.getStyle("submenu.icon"),menuBarPosition:i.options.menuBarPosition})})}},{key:"_makeUiElement",value:function(t){var e=void 0;window.snippet=o.default,e=t.nodeType?t:document.querySelector(t);var i=s.default.getSelector(e);e.classList.add("tui-image-editor-container"),e.innerHTML=(0,c.default)({locale:this._locale,biImage:this.theme.getStyle("common.bi"),iconStyle:this.theme.getStyle("menu.icon"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton")})+(0,a.default)({locale:this._locale,biImage:this.theme.getStyle("common.bi"),commonStyle:this.theme.getStyle("common"),headerStyle:this.theme.getStyle("header"),loadButtonStyle:this.theme.getStyle("loadButton"),downloadButtonStyle:this.theme.getStyle("downloadButton"),submenuStyle:this.theme.getStyle("submenu")}),this._selectedElement=e,this._selectedElement.classList.add(this.options.menuBarPosition),this._mainElement=i(".tui-image-editor-main"),this._editorElementWrap=i(".tui-image-editor-wrap"),this._editorElement=i(".tui-image-editor"),this._menuElement=i(".tui-image-editor-menu"),this._subMenuElement=i(".tui-image-editor-submenu")}},{key:"_makeMenuElement",value:function(t){var e=document.createElement("li"),i=this.theme.getStyle("menu.icon"),n=i.normal,r=i.active,o=i.hover,s='\n            <svg class="svg_ic-menu">\n                <use xlink:href="'+n.path+"#"+n.name+"-ic-"+t+'" class="normal"/>\n                <use xlink:href="'+r.path+"#"+r.name+"-ic-"+t+'" class="active"/>\n                <use xlink:href="'+o.path+"#"+o.name+"-ic-"+t+'" class="hover"/>\n            </svg>\n        ';e.id="tie-btn-"+t,e.className="tui-image-editor-item normal",e.title=this._locale.localize(t.replace(/^[a-z]/g,function(t){return t.toUpperCase()})),e.innerHTML=s,this._menuElement.appendChild(e)}},{key:"_addHelpActionEvent",value:function(t){var e=this;this._els[t].addEventListener("click",function(){e._actions.main[t]()})}},{key:"_addDownloadEvent",value:function(){var e=this;o.default.forEach(this._els.download,function(t){t.addEventListener("click",function(){e._actions.main.download()})})}},{key:"_addLoadEvent",value:function(){var e=this;o.default.forEach(this._els.load,function(t){t.addEventListener("change",function(t){e._actions.main.load(t.target.files[0])})})}},{key:"_addMenuEvent",value:function(t){var e=this;this._els[t].addEventListener("click",function(){e.changeMenu(t)})}},{key:"_addSubMenuEvent",value:function(t){this[t].addEvent(this._actions[t])}},{key:"getEditorArea",value:function(){return this._editorElement}},{key:"activeMenuEvent",value:function(){var e=this;this._initMenuEvent||(this._addHelpActionEvent("undo"),this._addHelpActionEvent("redo"),this._addHelpActionEvent("reset"),this._addHelpActionEvent("delete"),this._addHelpActionEvent("deleteAll"),this._addDownloadEvent(),o.default.forEach(this.options.menu,function(t){e._addMenuEvent(t),e._addSubMenuEvent(t)}),this._initMenu(),this._initMenuEvent=!0)}},{key:"initCanvas",value:function(){var t=this,e=this._getLoadImage();e.path&&this._actions.main.initLoadImage(e.path,e.name).then(function(){t.activeMenuEvent()}),this._addLoadEvent();var i=document.createElement("div");i.className="tui-image-editor-grid-visual",i.innerHTML='<table>\n           <tr><td class="dot left-top"></td><td></td><td class="dot right-top"></td></tr>\n           <tr><td></td><td></td><td></td></tr>\n           <tr><td class="dot left-bottom"></td><td></td><td class="dot right-bottom"></td></tr>\n         </table>',this._editorContainerElement=this._editorElement.querySelector(".tui-image-editor-canvas-container"),this._editorContainerElement.appendChild(i)}},{key:"_getLoadImage",value:function(){return this.options.loadImage}},{key:"changeMenu",value:function(t,e,i){var n=!(1<arguments.length&&void 0!==e)||e,r=!(2<arguments.length&&void 0!==i)||i;this._submenuChangeTransection||(this._submenuChangeTransection=!0,this._changeMenu(t,n,r),this._submenuChangeTransection=!1)}},{key:"_changeMenu",value:function(t,e,i){this.submenu&&(this._els[this.submenu].classList.remove("active"),this._mainElement.classList.remove("tui-image-editor-menu-"+this.submenu),i&&this._actions.main.discardSelection(),this._actions.main.changeSelectableAll(!0),this[this.submenu].changeStandbyMode()),this.submenu===t&&e?this.submenu=null:(this._els[t].classList.add("active"),this._mainElement.classList.add("tui-image-editor-menu-"+t),this.submenu=t,this[this.submenu].changeStartMode()),this.resizeEditor()}},{key:"_initMenu",value:function(){if(this.options.initMenu){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),this._els[this.options.initMenu].dispatchEvent(t)}this.icon&&this.icon.registDefaultIcon()}},{key:"_getEditorDimension",value:function(){var t=parseFloat(this._editorContainerElement.style.maxHeight),e=this.imageSize.newHeight>t?t:this.imageSize.newHeight,i=parseFloat(this._editorContainerElement.style.maxWidth);return{width:this.imageSize.newWidth>i?i:this.imageSize.newWidth,height:e}}},{key:"_setEditorPosition",value:function(t){var e=this._getEditorDimension(),i=e.width,n=e.height,r=this._editorElement.style,o=0,s=0;this.submenu&&("bottom"===t?o=n>this._editorElementWrap.scrollHeight-150?(n-this._editorElementWrap.scrollHeight)/2:-75:"top"===t?o=n>this._editorElementWrap.offsetHeight-150?75-(n-(this._editorElementWrap.offsetHeight-150))/2:75:"left"===t?s=i>this._editorElementWrap.offsetWidth-248?124-(i-(this._editorElementWrap.offsetWidth-248))/2:124:"right"===t&&(s=i>this._editorElementWrap.scrollWidth-248?(i-this._editorElementWrap.scrollWidth)/2:-124)),r.top=o+"px",r.left=s+"px"}}]),w);function w(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,w),this.options=this._initializeOption(e),this._actions=i,this.submenu=!1,this.imageSize={},this.uiSize={},this._locale=new y.default(this.options.locale),this.theme=new l.default(this.options.theme),this._submenuChangeTransection=!1,this._selectedElement=null,this._mainElement=null,this._editorElementWrap=null,this._editorElement=null,this._menuElement=null,this._subMenuElement=null,this._makeUiElement(t),this._setUiSize(),this._initMenuEvent=!1,this._els={undo:this._menuElement.querySelector("#tie-btn-undo"),redo:this._menuElement.querySelector("#tie-btn-redo"),reset:this._menuElement.querySelector("#tie-btn-reset"),delete:this._menuElement.querySelector("#tie-btn-delete"),deleteAll:this._menuElement.querySelector("#tie-btn-delete-all"),download:this._selectedElement.querySelectorAll(".tui-image-editor-download-btn"),load:this._selectedElement.querySelectorAll(".tui-image-editor-load-btn")},this._makeSubMenu()}e.default=C},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.biImage,n=t.commonStyle,r=t.headerStyle,o=t.loadButtonStyle,s=t.downloadButtonStyle,a=t.submenuStyle;return'\n    <div class="tui-image-editor-main-container" style="'+n+'">\n        <div class="tui-image-editor-header" style="'+r+'">\n            <div class="tui-image-editor-header-logo">\n                <img src="'+i+'" />\n            </div>\n            <div class="tui-image-editor-header-buttons">\n                <div style="'+o+'">\n                    '+e.localize("Load")+'\n                    <input type="file" class="tui-image-editor-load-btn" />\n                </div>\n                <button class="tui-image-editor-download-btn" style="'+s+'">\n                    '+e.localize("Download")+'\n                </button>\n            </div>\n        </div>\n        <div class="tui-image-editor-main">\n            <div class="tui-image-editor-submenu">\n                <div class="tui-image-editor-submenu-style" style="'+a+'"></div>\n            </div>\n            <div class="tui-image-editor-wrap">\n                <div class="tui-image-editor-size-wrap">\n                    <div class="tui-image-editor-align-wrap">\n                        <div class="tui-image-editor"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n'}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.biImage,n=t.iconStyle,r=n.normal,o=n.hover,s=n.disabled,a=t.loadButtonStyle,c=t.downloadButtonStyle;return'\n    <div class="tui-image-editor-controls">\n        <div class="tui-image-editor-controls-logo">\n            <img src="'+i+'" />\n        </div>\n        <ul class="tui-image-editor-menu">\n            <li id="tie-btn-undo" class="tui-image-editor-item" title="'+e.localize("Undo")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-undo" class="enabled"/>\n                    <use xlink:href="'+s.path+"#"+s.name+'-ic-undo" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-undo" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-redo" class="tui-image-editor-item" title="'+e.localize("Redo")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-redo" class="enabled"/>\n                    <use xlink:href="'+s.path+"#"+s.name+'-ic-redo" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-redo" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-reset" class="tui-image-editor-item" title="'+e.localize("Reset")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-reset" class="enabled"/>\n                    <use xlink:href="'+s.path+"#"+s.name+'-ic-reset" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-reset" class="hover"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n            <li id="tie-btn-delete" class="tui-image-editor-item" title="'+e.localize("Delete")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-delete" class="enabled"/>\n                    <use xlink:href="'+s.path+"#"+s.name+'-ic-delete" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-delete" class="hover"/>\n                </svg>\n            </li>\n            <li id="tie-btn-delete-all" class="tui-image-editor-item" title="'+e.localize("Delete-all")+'">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-delete-all" class="enabled"/>\n                    <use xlink:href="'+s.path+"#"+s.name+'-ic-delete-all" class="normal"/>\n                    <use xlink:href="'+o.path+"#"+o.name+'-ic-delete-all" class="hover"/>\n                </svg>\n            </li>\n            <li class="tui-image-editor-item">\n                <div class="tui-image-editor-icpartition"></div>\n            </li>\n        </ul>\n\n        <div class="tui-image-editor-controls-buttons">\n            <div style="'+a+'">\n                '+e.localize("Load")+'\n                <input type="file" class="tui-image-editor-load-btn" />\n            </div>\n            <button class="tui-image-editor-download-btn" style="'+c+'">\n                '+e.localize("Download")+"\n            </button>\n        </div>\n    </div>\n"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=i(3),o=i(72),a=l(i(78)),c=l(i(79));function l(t){return t&&t.__esModule?t:{default:t}}var u=(n(h,[{key:"getStyle",value:function(t){var e=null,i=t.replace(/\..+$/,""),n=this.styles[t];switch(t){case"common.bi":e=this.styles[t].image;break;case"menu.icon":case"submenu.icon":e={active:this.styles[i+".activeIcon"],normal:this.styles[i+".normalIcon"],hover:this.styles[i+".hoverIcon"],disabled:this.styles[i+".disabledIcon"]};break;case"submenu.label":e={active:this._makeCssText(this.styles[i+".activeLabel"]),normal:this._makeCssText(this.styles[i+".normalLabel"])};break;case"submenu.partition":e={vertical:this._makeCssText((0,s.extend)({},n,{borderLeft:"1px solid "+n.color})),horizontal:this._makeCssText((0,s.extend)({},n,{borderBottom:"1px solid "+n.color}))};break;case"range.disabledPointer":case"range.disabledBar":case"range.disabledSubbar":case"range.pointer":case"range.bar":case"range.subbar":n.backgroundColor=n.color,e=this._makeCssText(n);break;default:e=this._makeCssText(n)}return e}},{key:"_styleMaker",value:function(){var t=this.getStyle("submenu.label"),e=this.getStyle("submenu.partition");return(0,a.default)({subMenuLabelActive:t.active,subMenuLabelNormal:t.normal,submenuPartitionVertical:e.vertical,submenuPartitionHorizontal:e.horizontal,biSize:this.getStyle("common.bisize"),subMenuRangeTitle:this.getStyle("range.title"),submenuRangePointer:this.getStyle("range.pointer"),submenuRangeBar:this.getStyle("range.bar"),submenuRangeSubbar:this.getStyle("range.subbar"),submenuDisabledRangePointer:this.getStyle("range.disabledPointer"),submenuDisabledRangeBar:this.getStyle("range.disabledBar"),submenuDisabledRangeSubbar:this.getStyle("range.disabledSubbar"),submenuRangeValue:this.getStyle("range.value"),submenuColorpickerTitle:this.getStyle("colorpicker.title"),submenuColorpickerButton:this.getStyle("colorpicker.button"),submenuCheckbox:this.getStyle("checkbox"),menuIconSize:this.getStyle("menu.iconSize"),submenuIconSize:this.getStyle("submenu.iconSize")})}},{key:"_changeToObject",value:function(t){var o={};return(0,s.forEach)(t,function(t,e){var i=e.match(/^(.+)\.([a-z]+)$/i),n=i[1],r=i[2];o[n]||(o[n]={}),o[n][r]=t}),o}},{key:"_makeCssText",value:function(t){var i=this,n=[];return(0,s.forEach)(t,function(t,e){-1<["backgroundImage"].indexOf(e)&&"none"!==t&&(t="url("+t+")"),n.push(i._toUnderScore(e)+": "+t)}),n.join(";")}},{key:"_toUnderScore",value:function(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})}}]),h);function h(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),this.styles=this._changeToObject((0,s.extend)(c.default,t)),(0,o.styleLoad)(this._styleMaker())}e.default=u},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.subMenuLabelActive,i=t.subMenuLabelNormal,n=t.subMenuRangeTitle,r=t.submenuPartitionVertical,o=t.submenuPartitionHorizontal,s=t.submenuCheckbox,a=t.submenuRangePointer,c=t.submenuRangeValue,l=t.submenuColorpickerTitle,u=t.submenuColorpickerButton,h=t.submenuRangeBar,f=t.submenuRangeSubbar,d=t.submenuDisabledRangePointer,p=t.submenuDisabledRangeBar,g=t.submenuDisabledRangeSubbar,v=t.submenuIconSize;return'\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-icon-add-button.icon-heart .tui-image-editor-button[data-icontype="icon-heart"] label,\n    #tie-icon-add-button.icon-location .tui-image-editor-button[data-icontype="icon-location"] label,\n    #tie-icon-add-button.icon-polygon .tui-image-editor-button[data-icontype="icon-polygon"] label,\n    #tie-icon-add-button.icon-star .tui-image-editor-button[data-icontype="icon-star"] label,\n    #tie-icon-add-button.icon-star-2 .tui-image-editor-button[data-icontype="icon-star-2"] label,\n    #tie-icon-add-button.icon-arrow-3 .tui-image-editor-button[data-icontype="icon-arrow-3"] label,\n    #tie-icon-add-button.icon-arrow-2 .tui-image-editor-button[data-icontype="icon-arrow-2"] label,\n    #tie-icon-add-button.icon-arrow .tui-image-editor-button[data-icontype="icon-arrow"] label,\n    #tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype="icon-bubble"] label,\n    #tie-draw-line-select-button.line .tui-image-editor-button.line label,\n    #tie-draw-line-select-button.free .tui-image-editor-button.free label,\n    #tie-flip-button.flipX .tui-image-editor-button.flipX label,\n    #tie-flip-button.flipY .tui-image-editor-button.flipY label,\n    #tie-flip-button.resetFlip .tui-image-editor-button.resetFlip label,\n    #tie-crop-button .tui-image-editor-button.apply.active label,\n    #tie-crop-preset-button .tui-image-editor-button.preset.active label,\n    #tie-shape-button.rect .tui-image-editor-button.rect label,\n    #tie-shape-button.circle .tui-image-editor-button.circle label,\n    #tie-shape-button.triangle .tui-image-editor-button.triangle label,\n    #tie-text-effect-button .tui-image-editor-button.active label,\n    #tie-text-align-button.left .tui-image-editor-button.left label,\n    #tie-text-align-button.center .tui-image-editor-button.center label,\n    #tie-text-align-button.right .tui-image-editor-button.right label,\n    #tie-mask-apply.apply.active .tui-image-editor-button.apply label,\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button:hover > label,\n    .tui-image-editor-container .tui-image-editor-checkbox input + label {\n        '+e+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button > label,\n    .tui-image-editor-container .tui-image-editor-range-wrap.tui-image-editor-newline.short label {\n        "+i+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-wrap label {\n        "+n+"\n    }\n    .tui-image-editor-container .tui-image-editor-partition > div {\n        "+r+"\n    }\n    .tui-image-editor-container.left .tui-image-editor-submenu .tui-image-editor-partition > div,\n    .tui-image-editor-container.right .tui-image-editor-submenu .tui-image-editor-partition > div {\n        "+o+"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox input + label:before {\n        "+s+"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox input:checked + label:before {\n        border: 0;\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-pointer {\n        "+a+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-bar {\n        "+h+"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-subbar {\n        "+f+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-pointer {\n        "+d+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-subbar {\n        "+g+"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-bar {\n        "+p+"\n    }\n    .tui-image-editor-container .tui-image-editor-range-value {\n        "+c+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value + label {\n        "+l+"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value {\n        "+u+"\n    }\n    .tui-image-editor-container .svg_ic-menu {\n        "+t.menuIconSize+"\n    }\n    .tui-image-editor-container .svg_ic-submenu {\n        "+v+"\n    }\n    .tui-image-editor-container .tui-image-editor-controls-logo > img,\n    .tui-image-editor-container .tui-image-editor-header-logo > img {\n        "+t.biSize+"\n    }\n\n"}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={"common.bi.image":"https://uicdn.toast.com/toastui/img/tui-image-editor-bi.png","common.bisize.width":"251px","common.bisize.height":"21px","common.backgroundImage":"none","common.backgroundColor":"#1e1e1e","common.border":"0px","header.backgroundImage":"none","header.backgroundColor":"transparent","header.border":"0px","loadButton.backgroundColor":"#fff","loadButton.border":"1px solid #ddd","loadButton.color":"#222","loadButton.fontFamily":"'Noto Sans', sans-serif","loadButton.fontSize":"12px","downloadButton.backgroundColor":"#fdba3b","downloadButton.border":"1px solid #fdba3b","downloadButton.color":"#fff","downloadButton.fontFamily":"'Noto Sans', sans-serif","downloadButton.fontSize":"12px","menu.normalIcon.path":"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":"icon-c.svg","menu.hoverIcon.name":"icon-c","menu.iconSize.width":"24px","menu.iconSize.height":"24px","submenu.backgroundColor":"#1e1e1e","submenu.partition.color":"#3c3c3c","submenu.normalIcon.path":"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":"icon-c.svg","submenu.activeIcon.name":"icon-c","submenu.iconSize.width":"32px","submenu.iconSize.height":"32px","submenu.normalLabel.color":"#8a8a8a","submenu.normalLabel.fontWeight":"lighter","submenu.activeLabel.color":"#fff","submenu.activeLabel.fontWeight":"lighter","checkbox.border":"0px","checkbox.backgroundColor":"#fff","range.pointer.color":"#fff","range.bar.color":"#666","range.subbar.color":"#d1d1d1","range.disabledPointer.color":"#414141","range.disabledBar.color":"#282828","range.disabledSubbar.color":"#414141","range.value.color":"#fff","range.value.fontWeight":"lighter","range.value.fontSize":"11px","range.value.border":"1px solid #353535","range.value.backgroundColor":"#151515","range.title.color":"#fff","range.title.fontWeight":"lighter","colorpicker.button.border":"1px solid #1e1e1e","colorpicker.title.color":"#fff"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=h(i(81)),a=h(i(83)),o=h(i(84)),c=h(i(85)),l=i(72),u=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var f={stroke:"#ffbb3b",fill:"",strokeWidth:3},d=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(p,o.default),n(p,[{key:"addEvent",value:function(t){this.actions=t,this._els.shapeSelectButton.addEventListener("click",this._changeShapeHandler.bind(this)),this._els.strokeRange.on("change",this._changeStrokeRangeHandler.bind(this)),this._els.fillColorpicker.on("change",this._changeFillColorHandler.bind(this)),this._els.strokeColorpicker.on("change",this._changeStrokeColorHandler.bind(this)),this._els.fillColorpicker.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.strokeColorpicker.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.strokeRangeValue.value=this._els.strokeRange.value,this._els.strokeRangeValue.setAttribute("readonly",!0)}},{key:"setShapeStatus",value:function(t){var e=t.strokeWidth,i=t.strokeColor,n=t.fillColor;this._els.strokeRange.value=e,this._els.strokeRange.trigger("change"),this._els.strokeColorpicker.color=i,this._els.fillColorpicker.color=n,this.options.stroke=i,this.options.fill=n,this.options.strokeWidth=e}},{key:"changeStartMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.changeSelectableAll(!0),this._els.shapeSelectButton.classList.remove("circle"),this._els.shapeSelectButton.classList.remove("triangle"),this._els.shapeSelectButton.classList.remove("rect")}},{key:"setMaxStrokeValue",value:function(t){var e=t;e<=0&&(e=u.defaultShapeStrokeValus.max),this._els.strokeRange.max=e}},{key:"setStrokeValue",value:function(t){this._els.strokeRange.value=t,this._els.strokeRange.trigger("change")}},{key:"getStrokeValue",value:function(){return this._els.strokeRange.value}},{key:"_changeShapeHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){this.actions.stopDrawingMode(),this.actions.discardSelection();var i=this.getButtonType(e,["circle","triangle","rect"]);if(this.type===i)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=i,t.currentTarget.classList.add(i),this.actions.changeSelectableAll(!1),this.actions.modeChange("shape")}}},{key:"_changeStrokeRangeHandler",value:function(t){this.options.strokeWidth=(0,l.toInteger)(t),this._els.strokeRangeValue.value=(0,l.toInteger)(t),this.actions.changeShape({strokeWidth:t}),this.actions.setDrawingShape(this.type,this.options)}},{key:"_changeFillColorHandler",value:function(t){t=t||"transparent",this.options.fill=t,this.actions.changeShape({fill:t})}},{key:"_changeStrokeColorHandler",value:function(t){t=t||"transparent",this.options.stroke=t,this.actions.changeShape({stroke:t})}}]),p);function p(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,t,{locale:i,name:"shape",iconStyle:n,menuBarPosition:r,templateHtml:c.default}));return o.type=null,o.options=f,o._els={shapeSelectButton:o.selector("#tie-shape-button"),shapeColorButton:o.selector("#tie-shape-color-button"),strokeRange:new a.default(o.selector("#tie-stroke-range"),u.defaultShapeStrokeValus),strokeRangeValue:o.selector("#tie-stroke-range-value"),fillColorpicker:new s.default(o.selector("#tie-color-fill"),"",o.toggleDirection),strokeColorpicker:new s.default(o.selector("#tie-color-stroke"),"#ffbb3b",o.toggleDirection)},o.colorPickerControls.push(o._els.fillColorpicker),o.colorPickerControls.push(o._els.strokeColorpicker),o}e.default=d},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(3)),s=a(i(82));function a(t){return t&&t.__esModule?t:{default:t}}var c=["#000000","#2a2a2a","#545454","#7e7e7e","#a8a8a8","#d2d2d2","#ffffff","","#ff4040","#ff6518","#ffbb3b","#03bd9e","#00a9ff","#515ce6","#9e5fff","#ff5583"],l=(n(u,[{key:"_changeColorElement",value:function(t){t?(this.colorElement.classList.remove("transparent"),this.colorElement.style.backgroundColor=t):(this.colorElement.style.backgroundColor="#fff",this.colorElement.classList.add("transparent"))}},{key:"_makePickerButtonElement",value:function(t,e){t.classList.add("tui-image-editor-button"),this.colorElement=document.createElement("div"),this.colorElement.className="color-picker-value",e?this.colorElement.style.backgroundColor=e:this.colorElement.classList.add("transparent")}},{key:"_makePickerLayerElement",value:function(t,e){var i=document.createElement("label"),n=document.createElement("div");this.pickerControl=document.createElement("div"),this.pickerControl.className="color-picker-control",this.pickerElement=document.createElement("div"),this.pickerElement.className="color-picker",i.innerHTML=e,n.className="triangle",this.pickerControl.appendChild(this.pickerElement),this.pickerControl.appendChild(n),t.appendChild(this.pickerControl),t.appendChild(this.colorElement),t.appendChild(i)}},{key:"_addEvent",value:function(t){var n=this;this.picker.on("selectColor",function(t){n._changeColorElement(t.color),n._color=t.color,n.fire("change",t.color)}),t.addEventListener("click",function(t){var e=t.target,i=e&&n._isElementInColorPickerControl(e);(!i||i&&n._isPaletteButton(e))&&(n._show=!n._show,n.pickerControl.style.display=n._show?"block":"none",n._setPickerControlPosition(),n.fire("changeShow",n)),t.stopPropagation()}),document.body.addEventListener("click",function(){n.hide()})}},{key:"_isPaletteButton",value:function(t){return"tui-colorpicker-palette-button"===t.className}},{key:"_isElementInColorPickerControl",value:function(t){for(var e=t;e!==document.body&&e;){if(e===this.pickerControl)return!0;e=e.parentNode}return!1}},{key:"hide",value:function(){this._show=!1,this.pickerControl.style.display="none"}},{key:"_setPickerControlPosition",value:function(){var t=this.pickerControl.style,e=this._colorpickerElement.clientWidth/2+2,i=this.pickerControl.offsetWidth/2-e,n=-1*(this.pickerControl.offsetHeight+10);"down"===this._toggleDirection&&(n=30),t.top=n+"px",t.left="-"+i+"px"}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._changeColorElement(t)}}]),u);function u(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#7e7e7e",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"up";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var n=t.getAttribute("title");this._show=!1,this._colorpickerElement=t,this._toggleDirection=i,this._makePickerButtonElement(t,e),this._makePickerLayerElement(t,n),this._color=e,this.picker=s.default.create({container:this.pickerElement,preset:c,color:e}),this._addEvent(t)}o.default.CustomEvents.mixin(l),e.default=l},function(t,e){t.exports=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o,s=i(3),a=(o=s)&&o.__esModule?o:{default:o},c=i(72);var l=(n(u,[{key:"trigger",value:function(t){this.fire(t,this._value)}},{key:"_drawRangeElement",value:function(){this.rangeElement.classList.add("tui-image-editor-range"),this.bar=document.createElement("div"),this.bar.className="tui-image-editor-virtual-range-bar",this.subbar=document.createElement("div"),this.subbar.className="tui-image-editor-virtual-range-subbar",this.pointer=document.createElement("div"),this.pointer.className="tui-image-editor-virtual-range-pointer",this.bar.appendChild(this.subbar),this.bar.appendChild(this.pointer),this.rangeElement.appendChild(this.bar)}},{key:"_addClickEvent",value:function(){var n=this;this.rangeElement.addEventListener("click",function(t){if(t.stopPropagation(),"tui-image-editor-range"===t.target.className){var e=t.offsetX/n.rangeWidth,i=n._absMax*e+n._min;n.pointer.style.left=e*n.rangeWidth+"px",n.subbar.style.right=(1-e)*n.rangeWidth+"px",n._value=i,n.fire("change",i)}})}},{key:"_addDragEvent",value:function(){var e=this;this.pointer.addEventListener("mousedown",function(t){e.firstPosition=t.screenX,e.firstLeft=(0,c.toInteger)(e.pointer.style.left)||0,e.dragEventHandler={changeAngle:e._changeAngle.bind(e),stopChangingAngle:e._stopChangingAngle.bind(e)},document.addEventListener("mousemove",e.dragEventHandler.changeAngle),document.addEventListener("mouseup",e.dragEventHandler.stopChangingAngle)})}},{key:"_changeAngle",value:function(t){var e=t.screenX-this.firstPosition,i=this.firstLeft+e;i=(i=i>this.rangeWidth?this.rangeWidth:i)<0?0:i,this.pointer.style.left=i+"px",this.subbar.style.right=this.rangeWidth-i+"px";var n=i/this.rangeWidth,r=this._absMax*n+this._min;this._value=r,this.realTimeEvent&&this.fire("change",r)}},{key:"_stopChangingAngle",value:function(){this.fire("change",this._value),document.removeEventListener("mousemove",this.dragEventHandler.changeAngle),document.removeEventListener("mouseup",this.dragEventHandler.stopChangingAngle)}},{key:"max",set:function(t){this._max=t,this._absMax=-1*this._min+this._max,this.value=this._value},get:function(){return this._max}},{key:"value",get:function(){return this._value},set:function(t){var e=(t-this._min)*this.rangeWidth/this._absMax;this.rangeWidth<e&&(e=this.rangeWidth),this.pointer.style.left=e+"px",this.subbar.style.right=this.rangeWidth-e+"px",this._value=t}}]),u);function u(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this._value=e.value||0,this.rangeElement=t,this._drawRangeElement(),this.rangeWidth=(0,c.toInteger)(window.getComputedStyle(t,null).width)-12,this._min=e.min||0,this._max=e.max||100,this._absMax=-1*this._min+this._max,this.realTimeEvent=e.realTimeEvent||!1,this._addClickEvent(),this._addDragEvent(),this.value=e.value,this.trigger("change")}a.default.CustomEvents.mixin(l),e.default=l},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0});var i=(function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}(a,[{key:"colorPickerChangeShow",value:function(e){this.colorPickerControls.forEach(function(t){e!==t&&t.hide()})}},{key:"getButtonType",value:function(t,e){return t.className.match(RegExp("("+e.join("|")+")"))[0]}},{key:"changeClass",value:function(t,e,i){t.classList.remove(e),t.classList.add(i)}},{key:"changeStandbyMode",value:function(){}},{key:"changeStartMode",value:function(){}},{key:"_makeSubMenuElement",value:function(t,e){var i=e.locale,n=e.name,r=e.iconStyle,o=e.templateHtml,s=document.createElement("div");s.className="tui-image-editor-menu-"+n,s.innerHTML=o({locale:i,iconStyle:r}),t.appendChild(s)}}]),a);function a(e,t){var i=t.locale,n=t.name,r=t.iconStyle,o=t.menuBarPosition,s=t.templateHtml;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),this.selector=function(t){return e.querySelector(t)},this.menuBarPosition=o,this.toggleDirection="top"===o?"down":"up",this.colorPickerControls=[],this._makeSubMenuElement(e,{locale:i,name:n,iconStyle:r,templateHtml:s})}e.default=i},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-shape-button">\n            <div class="tui-image-editor-button rect">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-rectangle"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-rectangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Rectangle")+' </label>\n            </div>\n            <div class="tui-image-editor-button circle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-circle"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-circle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Circle")+' </label>\n            </div>\n            <div class="tui-image-editor-button triangle">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-triangle"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-triangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Triangle")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-shape-color-button">\n            <div id="tie-color-fill" title="'+e.localize("Fill")+'"></div>\n            <div id="tie-color-stroke" title="'+e.localize("Stroke")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Stroke")+'</label>\n            <div id="tie-stroke-range"></div>\n            <input id="tie-stroke-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(3)),s=c(i(84)),a=c(i(87));function c(t){return t&&t.__esModule?t:{default:t}}var l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,s.default),n(u,[{key:"addEvent",value:function(t){var n=this;this.actions=t,this._els.apply.addEventListener("click",function(){n.actions.crop(),n._els.apply.classList.remove("active")}),this._els.cancel.addEventListener("click",function(){n.actions.cancel(),n._els.apply.classList.remove("active")}),this._els.preset.addEventListener("click",function(t){var e=t.target.closest(".tui-image-editor-button.preset");if(e){var i=e.className.match(/preset-[^\s]+/)[0];n._setPresetButtonActive(e),n.actions.preset(i)}})}},{key:"changeStartMode",value:function(){this.actions.modeChange("crop")}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode(),this._setPresetButtonActive()}},{key:"changeApplyButtonStatus",value:function(t){t?this._els.apply.classList.add("active"):this._els.apply.classList.remove("active")}},{key:"_setPresetButtonActive",value:function(t){var e=0<arguments.length&&void 0!==t?t:this.defaultPresetButton;o.default.forEach([].slice.call(this._els.preset.querySelectorAll(".preset")),function(t){t.classList.remove("active")}),e&&e.classList.add("active")}}]),u);function u(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,{locale:i,name:"crop",iconStyle:n,menuBarPosition:r,templateHtml:a.default}));return o.status="active",o._els={apply:o.selector("#tie-crop-button .apply"),cancel:o.selector("#tie-crop-button .cancel"),preset:o.selector("#tie-crop-preset-button")},o.defaultPresetButton=o._els.preset.querySelector(".preset-none"),o}e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-crop-preset-button">\n            <div class="tui-image-editor-button preset preset-none active">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-shape-rectangle"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-shape-rectangle"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Custom")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-square">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Square")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-3-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("3:2")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-4-3">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("4:3")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-5-4">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("5:4")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-7-5">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("7:5")+' </label>\n            </div>\n            <div class="tui-image-editor-button preset preset-16-9">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-crop"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-crop"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("16:9")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition tui-image-editor-newline">\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li id="tie-crop-button" class="action">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Apply")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button cancel">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-cancel" class="normal"/>\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-cancel" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Cancel")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(3)),s=c(i(84)),a=c(i(89));function c(t){return t&&t.__esModule?t:{default:t}}var l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,s.default),n(u,[{key:"addEvent",value:function(t){this._actions=t,this._els.flipButton.addEventListener("click",this._changeFlip.bind(this))}},{key:"_changeFlip",value:function(t){var n=this,e=t.target.closest(".tui-image-editor-button");if(e){var i=this.getButtonType(e,["flipX","flipY","resetFlip"]);if(!this.flipStatus&&"resetFlip"===i)return;this._actions.flip(i).then(function(e){var i=n._els.flipButton.classList;n.flipStatus=!1,i.remove("resetFlip"),o.default.forEach(["flipX","flipY"],function(t){i.remove(t),e[t]&&(i.add(t),i.add("resetFlip"),n.flipStatus=!0)})})}}}]),u);function u(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,{locale:i,name:"flip",iconStyle:n,menuBarPosition:r,templateHtml:a.default}));return o.flipStatus=!1,o._els={flipButton:o.selector("#tie-flip-button")},o}e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul id="tie-flip-button" class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button flipX">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-x" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-x" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Flip X")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button flipY">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-y" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-y" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Flip Y")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="tui-image-editor-button resetFlip">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-flip-reset"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-flip-reset"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Reset")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=u(i(83)),o=u(i(84)),a=u(i(91)),c=i(72),l=i(73);function u(t){return t&&t.__esModule?t:{default:t}}var h=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(f,o.default),n(f,[{key:"addEvent",value:function(t){this.actions=t,this._els.rotateButton.addEventListener("click",this._changeRotateForButton.bind(this)),this._els.rotateRange.on("change",this._changeRotateForRange.bind(this)),this._els.rotateRangeValue.setAttribute("readonly",!0)}},{key:"_changeRotateForRange",value:function(t){var e=(0,c.toInteger)(t);this._els.rotateRangeValue.value=e,this.actions.setAngle(e)}},{key:"_changeRotateForButton",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i={clockwise:30,counterclockwise:-30}[this.getButtonType(e,["counterclockwise","clockwise"])];this.actions.rotate(i)}}}]),f);function f(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,t,{locale:i,name:"rotate",iconStyle:n,menuBarPosition:r,templateHtml:a.default}));return o._els={rotateButton:o.selector("#tie-retate-button"),rotateRange:new s.default(o.selector("#tie-rotate-range"),l.defaultRotateRangeValus),rotateRangeValue:o.selector("#tie-ratate-range-value")},o}e.default=h},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-retate-button">\n            <div class="tui-image-editor-button clockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-rotate-clockwise"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-rotate-clockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> 30 </label>\n            </div>\n            <div class="tui-image-editor-button counterclockwise">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-rotate-counterclockwise"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-rotate-counterclockwise"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> -30 </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Range")+'</label>\n            <div id="tie-rotate-range"></div>\n            <input id="tie-ratate-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=h(i(83)),a=h(i(81)),o=h(i(84)),c=h(i(93)),l=i(72),u=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,o.default),n(d,[{key:"addEvent",value:function(t){this.actions=t,this._els.textEffectButton.addEventListener("click",this._setTextEffectHandler.bind(this)),this._els.textAlignButton.addEventListener("click",this._setTextAlignHandler.bind(this)),this._els.textRange.on("change",this._changeTextRnageHandler.bind(this)),this._els.textRangeValue.value=this._els.textRange.value,this._els.textRangeValue.setAttribute("readonly",!0),this._els.textColorpicker.on("change",this._changeColorHandler.bind(this))}},{key:"changeStandbyMode",value:function(){this.actions.stopDrawingMode()}},{key:"changeStartMode",value:function(){this.actions.modeChange("text")}},{key:"_setTextEffectHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button"),i=e.className.match(/(bold|italic|underline)/)[0],n={bold:{fontWeight:"bold"},italic:{fontStyle:"italic"},underline:{textDecoration:"underline"}}[i];this.effect[i]=!this.effect[i],e.classList.toggle("active"),this.actions.changeTextStyle(n)}},{key:"_setTextAlignHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=this.getButtonType(e,["left","center","right"]);t.currentTarget.classList.remove(this.align),this.align!==i&&t.currentTarget.classList.add(i),this.actions.changeTextStyle({textAlign:i}),this.align=i}}},{key:"_changeTextRnageHandler",value:function(t){t=(0,l.toInteger)(t),(0,l.toInteger)(this._els.textRangeValue.value)!==t&&(this.actions.changeTextStyle({fontSize:t}),this._els.textRangeValue.value=t)}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeTextStyle({fill:t})}},{key:"textColor",get:function(){return this._els.textColorpicker.color}},{key:"fontSize",get:function(){return this._els.textRange.value},set:function(t){this._els.textRange.value=t,this._els.textRangeValue.value=t}}]),d);function d(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,{locale:i,name:"text",iconStyle:n,menuBarPosition:r,templateHtml:c.default}));return o.effect={bold:!1,italic:!1,underline:!1},o.align="left",o._els={textEffectButton:o.selector("#tie-text-effect-button"),textAlignButton:o.selector("#tie-text-align-button"),textColorpicker:new a.default(o.selector("#tie-text-color"),"#ffbb3b",o.toggleDirection),textRange:new s.default(o.selector("#tie-text-range"),u.defaultTextRangeValus),textRangeValue:o.selector("#tie-text-range-value")},o}e.default=f},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-text-effect-button">\n            <div class="tui-image-editor-button bold">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-text-bold" class="normal"/>\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-text-bold" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Bold")+' </label>\n            </div>\n            <div class="tui-image-editor-button italic">\n                <div>\n                    <svg class="svg_ic-submenu">\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-text-italic" class="normal"/>\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-text-italic" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Italic")+' </label>\n            </div>\n            <div class="tui-image-editor-button underline">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-text-underline"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-text-underline"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Underline")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-text-align-button">\n            <div class="tui-image-editor-button left">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-left"\n                        class="normal"/>\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-left"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Left")+' </label>\n            </div>\n            <div class="tui-image-editor-button center">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-center"\n                        class="normal"/>\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-center"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Center")+' </label>\n            </div>\n            <div class="tui-image-editor-button right">\n                <div>\n                    <svg class="svg_ic-submenu">\n                     <use xlink:href="'+n.path+"#"+n.name+'-ic-text-align-right"\n                        class="normal"/>\n                     <use xlink:href="'+r.path+"#"+r.name+'-ic-text-align-right"\n                        class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Right")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-text-color" title="'+e.localize("Color")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Text size")+'</label>\n            <div id="tie-text-range"></div>\n            <input id="tie-text-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(84)),s=c(i(72)),a=c(i(95));function c(t){return t&&t.__esModule?t:{default:t}}var l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,o.default),n(u,[{key:"addEvent",value:function(t){this.actions=t,this._els.maskImageButton.addEventListener("change",this._loadMaskFile.bind(this)),this._els.applyButton.addEventListener("click",this._applyMask.bind(this))}},{key:"_applyMask",value:function(){this.actions.applyFilter(),this._els.applyButton.classList.remove("active")}},{key:"_loadMaskFile",value:function(t){var e=void 0;s.default.isSupportFileApi()||alert("This browser does not support file-api");var i=t.target.files[0];i&&(e=URL.createObjectURL(i),this.actions.loadImageFromURL(e,i),this._els.applyButton.classList.add("active"))}}]),u);function u(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,{locale:i,name:"mask",iconStyle:n,menuBarPosition:r,templateHtml:a.default}));return o._els={applyButton:o.selector("#tie-mask-apply"),maskImageButton:o.selector("#tie-mask-image-file")},o}e.default=l},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li>\n            <div class="tui-image-editor-button">\n                <div>\n                    <input type="file" accept="image/*" id="tie-mask-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-mask-load" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-mask-load" class="active"/>\n                    </svg>\n                </div>\n                <label> '+e.localize("Load Mask Image")+' </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li id="tie-mask-apply" class="tui-image-editor-newline apply" style="margin-top: 22px;margin-bottom: 5px">\n            <div class="tui-image-editor-button apply">\n                <svg class="svg_ic-menu">\n                    <use xlink:href="'+n.path+"#"+n.name+'-ic-apply" class="normal"/>\n                    <use xlink:href="'+r.path+"#"+r.name+'-ic-apply" class="active"/>\n                </svg>\n                <label>\n                    '+e.localize("Apply")+"\n                </label>\n            </div>\n        </li>\n    </ul>\n"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=h(i(3)),s=h(i(81)),a=h(i(84)),c=h(i(97)),l=i(72),u=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,a.default),n(d,[{key:"addEvent",value:function(t){this.actions=t,this._els.iconColorpicker.on("change",this._changeColorHandler.bind(this)),this._els.registIconButton.addEventListener("change",this._registeIconHandler.bind(this)),this._els.addIconButton.addEventListener("click",this._addIconHandler.bind(this))}},{key:"clearIconType",value:function(){this._els.addIconButton.classList.remove(this.iconType),this.iconType=null}},{key:"registDefaultIcon",value:function(){var i=this;o.default.forEach(u.defaultIconPath,function(t,e){i.actions.registDefalutIcons(e,t)})}},{key:"setIconPickerColor",value:function(t){this._els.iconColorpicker.color=t}},{key:"changeStandbyMode",value:function(){this.clearIconType(),this.actions.cancelAddIcon()}},{key:"_changeColorHandler",value:function(t){t=t||"transparent",this.actions.changeColor(t)}},{key:"_addIconHandler",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=e.getAttribute("data-icontype"),n=this._els.iconColorpicker.color;this.actions.discardSelection(),this.actions.changeSelectableAll(!1),this._els.addIconButton.classList.remove(this.iconType),this._els.addIconButton.classList.add(i),this.iconType===i?this.changeStandbyMode():(this.actions.addIcon(i,n),this.iconType=i)}}},{key:"_registeIconHandler",value:function(t){var e=void 0;l.isSupportFileApi||alert("This browser does not support file-api");var i=t.target.files[0];i&&(e=URL.createObjectURL(i),this.actions.registCustomIcon(e,i))}}]),d);function d(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,{locale:i,name:"icon",iconStyle:n,menuBarPosition:r,templateHtml:c.default}));return o.iconType=null,o._iconMap={},o._els={registIconButton:o.selector("#tie-icon-image-file"),addIconButton:o.selector("#tie-icon-add-button"),iconColorpicker:new s.default(o.selector("#tie-icon-color"),"#ffbb3b",o.toggleDirection)},o}e.default=f},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button" data-icontype="icon-arrow">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow-2"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow-2")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-arrow-3">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-arrow-3"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-arrow-3"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Arrow-3")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-star" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-star" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Star-1")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button" data-icontype="icon-star-2">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-star-2"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-star-2"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Star-2")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-polygon">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-polygon"\n                            class="normal"/>\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-polygon"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Polygon")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-location">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-location"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-location"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Location")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-heart">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-heart"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-heart"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Heart")+'\n                </label>\n            </div>\n\n            <div class="tui-image-editor-button" data-icontype="icon-bubble">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-bubble"\n                            class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-bubble"\n                            class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Bubble")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li id="tie-icon-add-button">\n            <div class="tui-image-editor-button" style="margin:0">\n                <div>\n                    <input type="file" accept="image/*" id="tie-icon-image-file">\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-icon-load" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-icon-load" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Custom icon")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-icon-color" title="'+e.localize("Color")+'"></div>\n        </li>\n    </ul>\n'}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=h(i(72)),s=h(i(81)),a=h(i(83)),c=h(i(84)),l=h(i(99)),u=i(73);function h(t){return t&&t.__esModule?t:{default:t}}var f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,c.default),n(d,[{key:"addEvent",value:function(t){this.actions=t,this._els.lineSelectButton.addEventListener("click",this._changeDrawType.bind(this)),this._els.drawColorpicker.on("change",this._changeDrawColor.bind(this)),this._els.drawRange.on("change",this._changeDrawRange.bind(this)),this._els.drawRangeValue.value=this._els.drawRange.value,this._els.drawRangeValue.setAttribute("readonly",!0)}},{key:"setDrawMode",value:function(){this.actions.setDrawMode(this.type,{width:this.width,color:o.default.getRgb(this.color,.7)})}},{key:"changeStandbyMode",value:function(){this.type=null,this.actions.stopDrawingMode(),this.actions.changeSelectableAll(!0),this._els.lineSelectButton.classList.remove("free"),this._els.lineSelectButton.classList.remove("line")}},{key:"changeStartMode",value:function(){this.type="free",this._els.lineSelectButton.classList.add("free"),this.setDrawMode()}},{key:"_changeDrawType",value:function(t){var e=t.target.closest(".tui-image-editor-button");if(e){var i=this.getButtonType(e,["free","line"]);if(this.actions.discardSelection(),this.type===i)return void this.changeStandbyMode();this.changeStandbyMode(),this.type=i,this._els.lineSelectButton.classList.add(i),this.setDrawMode()}}},{key:"_changeDrawColor",value:function(t){this.color=t||"transparent",this.type?this.setDrawMode():this.changeStartMode()}},{key:"_changeDrawRange",value:function(t){t=o.default.toInteger(t),this._els.drawRangeValue.value=t,this.width=t,this.type?this.setDrawMode():this.changeStartMode()}}]),d);function d(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,t,{locale:i,name:"draw",iconStyle:n,menuBarPosition:r,templateHtml:l.default}));return o._els={lineSelectButton:o.selector("#tie-draw-line-select-button"),drawColorpicker:new s.default(o.selector("#tie-draw-color"),"#00a9ff",o.toggleDirection),drawRange:new a.default(o.selector("#tie-draw-range"),u.defaultDrawRangeValus),drawRangeValue:o.selector("#tie-draw-range-value")},o.type=null,o.color=o._els.drawColorpicker.color,o.width=o._els.drawRange.value,o}e.default=f},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale,i=t.iconStyle,n=i.normal,r=i.active;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li id="tie-draw-line-select-button">\n            <div class="tui-image-editor-button free">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-draw-free" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-draw-free" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Free")+'\n                </label>\n            </div>\n            <div class="tui-image-editor-button line">\n                <div>\n                    <svg class="svg_ic-submenu">\n                        <use xlink:href="'+n.path+"#"+n.name+'-ic-draw-line" class="normal"/>\n                        <use xlink:href="'+r.path+"#"+r.name+'-ic-draw-line" class="active"/>\n                    </svg>\n                </div>\n                <label>\n                    '+e.localize("Straight")+'\n                </label>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div id="tie-draw-color" title="'+e.localize("Color")+'"></div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-newline tui-image-editor-range-wrap">\n            <label class="range">'+e.localize("Range")+'</label>\n            <div id="tie-draw-range"></div>\n            <input id="tie-draw-range-value" class="tui-image-editor-range-value" value="0" />\n        </li>\n    </ul>\n'}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=f(i(3)),s=f(i(81)),a=f(i(83)),c=f(i(84)),l=f(i(101)),u=i(72),h=i(73);function f(t){return t&&t.__esModule?t:{default:t}}var d=["add","diff","subtract","multiply","screen","lighten","darken"],p=["grayscale","invert","sepia","sepia2","blur","sharpen","emboss","remove-white","gradient-transparency","brightness","noise","pixelate","color-filter","tint","multiply","blend"],g=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(v,c.default),n(v,[{key:"addEvent",value:function(t){var n=this,e=t.applyFilter,r=this._changeRangeValue.bind(this,e);o.default.forEach(p,function(t){var e=n.selector("#tie-"+t),i=(0,u.toCamelCase)(t);(n.checkedMap[i]=e).addEventListener("change",function(){return r(i)})}),this._els.removewhiteThresholdRange.on("change",function(){return r("removeWhite")}),this._els.removewhiteDistanceRange.on("change",function(){return r("removeWhite")}),this._els.gradientTransparencyRange.on("change",function(){return r("gradientTransparency")}),this._els.colorfilterThresholeRange.on("change",function(){return r("colorFilter")}),this._els.pixelateRange.on("change",function(){return r("pixelate")}),this._els.noiseRange.on("change",function(){return r("noise")}),this._els.brightnessRange.on("change",function(){return r("brightness")}),this._els.blendType.addEventListener("change",function(){return r("blend")}),this._els.filterBlendColor.on("change",function(){return r("blend")}),this._els.filterMultiplyColor.on("change",function(){return r("multiply")}),this._els.tintOpacity.on("change",function(){return r("tint")}),this._els.filterTintColor.on("change",function(){return r("tint")}),this._els.blendType.addEventListener("click",function(t){return t.stopPropagation()}),this._els.filterMultiplyColor.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.filterTintColor.on("changeShow",this.colorPickerChangeShow.bind(this)),this._els.filterBlendColor.on("changeShow",this.colorPickerChangeShow.bind(this))}},{key:"_changeRangeValue",value:function(t,e){var i=this.checkedMap[e].checked,n=e,r=this.checkedMap[e].closest(".tui-image-editor-checkbox-group");r&&(i?r.classList.remove("tui-image-editor-disabled"):r.classList.add("tui-image-editor-disabled")),t(i,n,this._getFilterOption(n))}},{key:"_getFilterOption",value:function(t){var e={};switch(t){case"removeWhite":e.threshold=(0,u.toInteger)(this._els.removewhiteThresholdRange.value),e.distance=(0,u.toInteger)(this._els.removewhiteDistanceRange.value);break;case"gradientTransparency":e.threshold=(0,u.toInteger)(this._els.gradientTransparencyRange.value);break;case"colorFilter":e.color="#FFFFFF",e.threshold=this._els.colorfilterThresholeRange.value;break;case"pixelate":e.blocksize=(0,u.toInteger)(this._els.pixelateRange.value);break;case"noise":e.noise=(0,u.toInteger)(this._els.noiseRange.value);break;case"brightness":e.brightness=(0,u.toInteger)(this._els.brightnessRange.value);break;case"blend":e.color=this._els.filterBlendColor.color,e.mode=this._els.blendType.value;break;case"multiply":e.color=this._els.filterMultiplyColor.color;break;case"tint":e.color=this._els.filterTintColor.color,e.opacity=this._els.tintOpacity.value}return e}},{key:"_makeControlElement",value:function(){var t=this.selector;this._els={removewhiteThresholdRange:new a.default(t("#tie-removewhite-threshold-range"),h.defaultFilterRangeValus.removewhiteThresholdRange),removewhiteDistanceRange:new a.default(t("#tie-removewhite-distance-range"),h.defaultFilterRangeValus.removewhiteDistanceRange),gradientTransparencyRange:new a.default(t("#tie-gradient-transparency-range"),h.defaultFilterRangeValus.gradientTransparencyRange),brightnessRange:new a.default(t("#tie-brightness-range"),h.defaultFilterRangeValus.brightnessRange),noiseRange:new a.default(t("#tie-noise-range"),h.defaultFilterRangeValus.noiseRange),pixelateRange:new a.default(t("#tie-pixelate-range"),h.defaultFilterRangeValus.pixelateRange),colorfilterThresholeRange:new a.default(t("#tie-colorfilter-threshole-range"),h.defaultFilterRangeValus.colorfilterThresholeRange),filterTintColor:new s.default(t("#tie-filter-tint-color"),"#03bd9e",this.toggleDirection),filterMultiplyColor:new s.default(t("#tie-filter-multiply-color"),"#515ce6",this.toggleDirection),filterBlendColor:new s.default(t("#tie-filter-blend-color"),"#ffbb3b",this.toggleDirection)},this._els.tintOpacity=this._pickerWithRange(this._els.filterTintColor.pickerControl),this._els.blendType=this._pickerWithSelectbox(this._els.filterBlendColor.pickerControl),this.colorPickerControls.push(this._els.filterTintColor),this.colorPickerControls.push(this._els.filterMultiplyColor),this.colorPickerControls.push(this._els.filterBlendColor)}},{key:"_pickerWithRange",value:function(t){var e=document.createElement("div"),i=document.createElement("label"),n=document.createElement("div");return n.id="tie-filter-tint-opacity",i.innerHTML="Opacity",e.appendChild(i),e.appendChild(n),t.appendChild(e),t.style.height="130px",new a.default(n,h.defaultFilterRangeValus.tintOpacityRange)}},{key:"_pickerWithSelectbox",value:function(t){var e=document.createElement("div"),i=document.createElement("select"),n=document.createElement("ul");return e.className="tui-image-editor-selectlist-wrap",n.className="tui-image-editor-selectlist",e.appendChild(i),e.appendChild(n),this._makeSelectOptionList(i),t.appendChild(e),t.style.height="130px",this._drawSelectOptionList(i,n),this._pickerWithSelectboxForAddEvent(i,n),i}},{key:"_drawSelectOptionList",value:function(t,i){var e=t.querySelectorAll("option");o.default.forEach(e,function(t){var e=document.createElement("li");e.innerHTML=t.innerHTML,e.setAttribute("data-item",t.value),i.appendChild(e)})}},{key:"_pickerWithSelectboxForAddEvent",value:function(n,r){var o=this;r.addEventListener("click",function(t){var e=t.target.getAttribute("data-item"),i=document.createEvent("HTMLEvents");n.querySelector('[value="'+e+'"]').selected=!0,i.initEvent("change",!0,!0),n.dispatchEvent(i),o.selectBoxShow=!1,r.style.display="none"}),n.addEventListener("mousedown",function(t){t.preventDefault(),o.selectBoxShow=!o.selectBoxShow,r.style.display=o.selectBoxShow?"block":"none",r.setAttribute("data-selectitem",n.value),r.querySelector("[data-item='"+n.value+"']").classList.add("active")})}},{key:"_makeSelectOptionList",value:function(i){o.default.forEach(d,function(t){var e=document.createElement("option");e.setAttribute("value",t),e.innerHTML=t.replace(/^[a-z]/,function(t){return t.toUpperCase()}),i.appendChild(e)})}}]),v);function v(t,e){var i=e.locale,n=e.iconStyle,r=e.menuBarPosition;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,t,{locale:i,name:"filter",iconStyle:n,menuBarPosition:r,templateHtml:l.default}));return o.selectBoxShow=!1,o.checkedMap={},o._makeControlElement(),o}e.default=g},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=t.locale;return'\n    <ul class="tui-image-editor-submenu-item">\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-wrap fixed-width">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-grayscale">\n                    <label for="tie-grayscale">'+e.localize("Grayscale")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-invert">\n                    <label for="tie-invert">'+e.localize("Invert")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia">\n                    <label for="tie-sepia">'+e.localize("Sepia")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sepia2">\n                    <label for="tie-sepia2">'+e.localize("Sepia2")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blur">\n                    <label for="tie-blur">'+e.localize("Blur")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-sharpen">\n                    <label for="tie-sharpen">'+e.localize("Sharpen")+'</label>\n                </div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-emboss">\n                    <label for="tie-emboss">'+e.localize("Emboss")+'</label>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled" style="margin-bottom: 7px;">\n                <div class="tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-remove-white">\n                        <label for="tie-remove-white">'+e.localize("Remove White")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Threshold")+'</label>\n                    <div id="tie-removewhite-threshold-range"></div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Distance")+'</label>\n                    <div id="tie-removewhite-distance-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-gradient-transparency">\n                        <label for="tie-gradient-transparency">'+e.localize("Gradient transparency")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Value")+'</label>\n                    <div id="tie-gradient-transparency-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition only-left-right">\n            <div></div>\n        </li>\n        <li class="tui-image-editor-submenu-align">\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-brightness">\n                    <label for="tie-brightness">'+e.localize("Brightness")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-brightness-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-noise">\n                    <label for="tie-noise">'+e.localize("Noise")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-noise-range"></div>\n                </div>\n            </div>\n\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-pixelate">\n                    <label for="tie-pixelate">'+e.localize("Pixelate")+'</label>\n                </div>\n                <div class="tui-image-editor-range-wrap short">\n                    <div id="tie-pixelate-range"></div>\n                </div>\n            </div>\n            <div class="tui-image-editor-checkbox-group tui-image-editor-disabled">\n                <div class="tui-image-editor-newline tui-image-editor-checkbox-wrap">\n                    <div class="tui-image-editor-checkbox">\n                        <input type="checkbox" id="tie-color-filter">\n                        <label for="tie-color-filter">'+e.localize("Color Filter")+'</label>\n                    </div>\n                </div>\n                <div class="tui-image-editor-newline tui-image-editor-range-wrap short">\n                    <label>'+e.localize("Threshold")+'</label>\n                    <div id="tie-colorfilter-threshole-range"></div>\n                </div>\n            </div>\n        </li>\n        <li class="tui-image-editor-partition">\n            <div></div>\n        </li>\n        <li>\n            <div class="filter-color-item">\n                <div id="tie-filter-tint-color" title="'+e.localize("Tint")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-tint">\n                    <label for="tie-tint"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-multiply-color" title="'+e.localize("Multiply")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-multiply">\n                    <label for="tie-multiply"></label>\n                </div>\n            </div>\n            <div class="filter-color-item">\n                <div id="tie-filter-blend-color" title="'+e.localize("Blend")+'"></div>\n                <div class="tui-image-editor-checkbox">\n                    <input type="checkbox" id="tie-blend">\n                    <label for="tie-blend"></label>\n                </div>\n            </div>\n        </li>\n    </ul>\n'}},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0});var i=(function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}(r,[{key:"localize",value:function(t){return this._locale[t]||t}}]),r);function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this._locale=t}e.default=i},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var u=i(3),o=n(i(72)),h=n(i(104));function n(t){return t&&t.__esModule?t:{default:t}}e.default={getActions:function(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction()}},_mainAction:function(){function i(){"crop"===r.ui.submenu&&(r.stopDrawingMode(),r.ui.changeMenu("crop"))}var r=this;return(0,u.extend)({initLoadImage:function(e,t){return r.loadImageFromURL(e,t).then(function(t){i(),r.ui.initializeImgUrl=e,r.ui.resizeEditor({imageSize:t}),r.clearUndoStack()})},undo:function(){r.isEmptyUndoStack()||(i(),r.undo())},redo:function(){r.isEmptyRedoStack()||(i(),r.redo())},reset:function(){i(),r.loadImageFromURL(r.ui.initializeImgUrl,"resetImage").then(function(t){i(),r.ui.resizeEditor({imageSize:t}),r.clearUndoStack()})},delete:function(){r.ui.changeDeleteButtonEnabled(!1),i(),r.removeActiveObject(),r.activeObjectId=null},deleteAll:function(){i(),r.clearObjects(),r.ui.changeDeleteButtonEnabled(!1),r.ui.changeDeleteAllButtonEnabled(!1)},load:function(t){o.default.isSupportFileApi()||alert("This browser does not support file-api"),r.ui.initializeImgUrl=URL.createObjectURL(t),r.loadImageFromFile(t).then(function(t){i(),r.clearUndoStack(),r.ui.activeMenuEvent(),r.ui.resizeEditor({imageSize:t})}).catch(function(t){return Promise.reject(t)})},download:function(){var t=r.toDataURL(),e=r.getImageName(),i=void 0,n=void 0;o.default.isSupportFileApi()&&window.saveAs?(n=(i=o.default.base64ToBlob(t)).type.split("/")[1],e.split(".").pop()!==n&&(e+="."+n),saveAs(i,e)):window.open().document.body.innerHTML="<img src='"+t+"'>"}},this._commonAction())},_iconAction:function(){var r=this,i=void 0,n=void 0,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0;this.on({iconCreateResize:function(t){var e=t.moveOriginPointer,i=(e.x-o)/a,n=(e.y-s)/c;r.setObjectPropertiesQuietly(l,{scaleX:Math.abs(2*i),scaleY:Math.abs(2*n)})},iconCreateEnd:function(){r.ui.icon.clearIconType(),r.changeSelectableAll(!0)}});return(0,u.extend)({changeColor:function(t){r.activeObjectId&&r.changeIconColor(r.activeObjectId,t)},addIcon:function(t,e){i=t,n=e,r.changeCursor("crosshair"),r.off("mousedown"),r.once("mousedown",function(t,e){o=e.x,s=e.y,r.addIcon(i,{left:e.x,top:e.y,fill:n}).then(function(t){l=t.id,a=t.width,c=t.height})}.bind(r))},cancelAddIcon:function(){r.off("mousedown"),r.ui.icon.clearIconType(),r.changeSelectableAll(!0),r.changeCursor("default")},registDefalutIcons:function(t,e){var i={};i[t]=e,r.registerIcons(i)},registCustomIcon:function(t,n){(new h.default).imageToSVG(t,function(t){var e=t.match(/path[^>]*d="([^"]*)"/)[1],i={};i[n.name]=e,r.registerIcons(i),r.addIcon(n.name,{left:100,top:100})},h.default.tracerDefaultOption())}},this._commonAction())},_drawAction:function(){var i=this;return(0,u.extend)({setDrawMode:function(t,e){i.stopDrawingMode(),"free"===t?i.startDrawingMode("FREE_DRAWING",e):i.startDrawingMode("LINE_DRAWING",e)},setColor:function(t){i.setBrush({color:t})}},this._commonAction())},_maskAction:function(){var i=this;return(0,u.extend)({loadImageFromURL:function(t,e){return i.loadImageFromURL(i.toDataURL(),"FilterImage").then(function(){i.addImageObject(t).then(function(){URL.revokeObjectURL(e)})})},applyFilter:function(){i.applyFilter("mask",{maskObjId:i.activeObjectId})}},this._commonAction())},_textAction:function(){var e=this;return(0,u.extend)({changeTextStyle:function(t){e.activeObjectId&&e.changeTextStyle(e.activeObjectId,t)}},this._commonAction())},_rotateAction:function(){var e=this;return(0,u.extend)({rotate:function(t){e.rotate(t),e.ui.resizeEditor()},setAngle:function(t){e.setAngle(t),e.ui.resizeEditor()}},this._commonAction())},_shapeAction:function(){var e=this;return(0,u.extend)({changeShape:function(t){e.activeObjectId&&e.changeShape(e.activeObjectId,t)},setDrawingShape:function(t){e.setDrawingShape(t)}},this._commonAction())},_cropAction:function(){var e=this;return(0,u.extend)({crop:function(){var t=e.getCropzoneRect();t&&e.crop(t).then(function(){e.stopDrawingMode(),e.ui.resizeEditor(),e.ui.changeMenu("crop")}).catch(function(t){return Promise.reject(t)})},cancel:function(){e.stopDrawingMode(),e.ui.changeMenu("crop")},preset:function(t){switch(t){case"preset-square":e.setCropzoneRect(1);break;case"preset-3-2":e.setCropzoneRect(1.5);break;case"preset-4-3":e.setCropzoneRect(4/3);break;case"preset-5-4":e.setCropzoneRect(5/4);break;case"preset-7-5":e.setCropzoneRect(1.4);break;case"preset-16-9":e.setCropzoneRect(16/9);break;default:e.setCropzoneRect(),e.ui.crop.changeApplyButtonStatus(!1)}}},this._commonAction())},_flipAction:function(){var e=this;return(0,u.extend)({flip:function(t){return e[t]()}},this._commonAction())},_filterAction:function(){var n=this;return(0,u.extend)({applyFilter:function(t,e,i){t?n.applyFilter(e,i):n.hasFilter(e)&&n.removeFilter(e)}},this._commonAction())},setReAction:function(){var r=this;this.on({undoStackChanged:function(t){t?(r.ui.changeUndoButtonStatus(!0),r.ui.changeResetButtonStatus(!0)):(r.ui.changeUndoButtonStatus(!1),r.ui.changeResetButtonStatus(!1)),r.ui.resizeEditor()},redoStackChanged:function(t){t?r.ui.changeRedoButtonStatus(!0):r.ui.changeRedoButtonStatus(!1),r.ui.resizeEditor()},objectActivated:function(t){r.activeObjectId=t.id,r.ui.changeDeleteButtonEnabled(!0),r.ui.changeDeleteAllButtonEnabled(!0),"cropzone"===t.type?r.ui.crop.changeApplyButtonStatus(!0):-1<["rect","circle","triangle"].indexOf(t.type)?(r.stopDrawingMode(),"shape"!==r.ui.submenu&&r.ui.changeMenu("shape",!1,!1),r.ui.shape.setShapeStatus({strokeColor:t.stroke,strokeWidth:t.strokeWidth,fillColor:t.fill}),r.ui.shape.setMaxStrokeValue(Math.min(t.width,t.height))):"path"===t.type||"line"===t.type?"draw"!==r.ui.submenu&&(r.ui.changeMenu("draw",!1,!1),r.ui.draw.changeStandbyMode()):-1<["i-text","text"].indexOf(t.type)?"text"!==r.ui.submenu&&r.ui.changeMenu("text",!1,!1):"icon"===t.type&&(r.stopDrawingMode(),"icon"!==r.ui.submenu&&r.ui.changeMenu("icon",!1,!1),r.ui.icon.setIconPickerColor(t.fill))},addText:function(t){r.addText("Double Click",{position:t.originPosition,styles:{fill:r.ui.text.textColor,fontSize:o.default.toInteger(r.ui.text.fontSize),fontFamily:"Noto Sans"}}).then(function(){r.changeCursor("default")})},addObjectAfter:function(t){-1<["rect","circle","triangle"].indexOf(t.type)&&(r.ui.shape.setMaxStrokeValue(Math.min(t.width,t.height)),r.ui.shape.changeStandbyMode())},objectScaled:function(t){if(-1<["i-text","text"].indexOf(t.type))r.ui.text.fontSize=o.default.toInteger(t.fontSize);else if(0<=["rect","circle","triangle"].indexOf(t.type)){var e=t.width,i=t.height,n=r.ui.shape.getStrokeValue();e<n&&r.ui.shape.setStrokeValue(e),i<n&&r.ui.shape.setStrokeValue(i)}},selectionCleared:function(){r.activeObjectId=null,"text"===r.ui.submenu?r.changeCursor("text"):"draw"!==r.ui.submenu&&"crop"!==r.ui.submenu&&r.stopDrawingMode()}})},_commonAction:function(){var e=this;return{modeChange:function(t){switch(t){case"text":e._changeActivateMode("TEXT");break;case"crop":e.startDrawingMode("CROPPER");break;case"shape":e._changeActivateMode("SHAPE"),e.setDrawingShape(e.ui.shape.type,e.ui.shape.options)}},deactivateAll:this.deactivateAll.bind(this),changeSelectableAll:this.changeSelectableAll.bind(this),discardSelection:this.discardSelection.bind(this),stopDrawingMode:this.stopDrawingMode.bind(this)}},mixin:function(t){(0,u.extend)(t.prototype,this)}}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=(i(o,null,[{key:"tracerDefaultOption",value:function(){return{pathomit:100,ltres:.1,qtres:1,scale:1,strokewidth:5,viewbox:!1,linefilter:!0,desc:!1,rightangleenhance:!1,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]}}}]),i(o,[{key:"imageToSVG",value:function(t,e,i){var n=this;i=this.checkoptions(i),this.loadImage(t,function(t){e(n.imagedataToSVG(n.getImgdata(t),i))},i)}},{key:"imagedataToSVG",value:function(t,e){e=this.checkoptions(e);var i=this.imagedataToTracedata(t,e);return this.getsvgstring(i,e)}},{key:"imageToTracedata",value:function(t,e,i){var n=this;i=this.checkoptions(i),this.loadImage(t,function(t){e(n.imagedataToTracedata(n.getImgdata(t),i))},i)}},{key:"imagedataToTracedata",value:function(t,e){e=this.checkoptions(e);var i=this.colorquantization(t,e),n=void 0;if(0===e.layering){n={layers:[],palette:i.palette,width:i.array[0].length-2,height:i.array.length-2};for(var r=0;r<i.palette.length;r+=1){var o=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(i,r),e.pathomit),e),e.ltres,e.qtres);n.layers.push(o)}}else{var s=this.layering(i);e.layercontainerid&&this.drawLayers(s,this.specpalette,e.scale,e.layercontainerid);var a=this.batchpathscan(s,e.pathomit),c=this.batchinternodes(a,e);n={layers:this.batchtracelayers(c,e.ltres,e.qtres),palette:i.palette,width:t.width,height:t.height}}return n}},{key:"checkoptions",value:function(t){"string"==typeof(t=t||{})&&(t=t.toLowerCase(),t=this.optionpresets[t]?this.optionpresets[t]:{});for(var e=Object.keys(this.optionpresets.default),i=0;i<e.length;i+=1)t.hasOwnProperty(e[i])||(t[e[i]]=this.optionpresets.default[e[i]]);return t}},{key:"colorquantization",value:function(t,e){var i=[],n=0,r=void 0,o=void 0,s=void 0,a=[],c=t.width*t.height,l=void 0,u=void 0,h=void 0,f=void 0,d=void 0;for(u=0;u<t.height+2;u+=1)for(i[u]=[],l=0;l<t.width+2;l+=1)i[u][l]=-1;for(d=e.pal?e.pal:0===e.colorsampling?this.generatepalette(e.numberofcolors):1===e.colorsampling?this.samplepalette(e.numberofcolors,t):this.samplepalette2(e.numberofcolors,t),0<e.blurradius&&(t=this.blur(t,e.blurradius,e.blurdelta)),f=0;f<e.colorquantcycles;f+=1){if(0<f)for(h=0;h<d.length;h+=1)0<a[h].n&&(d[h]={r:Math.floor(a[h].r/a[h].n),g:Math.floor(a[h].g/a[h].n),b:Math.floor(a[h].b/a[h].n),a:Math.floor(a[h].a/a[h].n)}),a[h].n/c<e.mincolorratio&&f<e.colorquantcycles-1&&(d[h]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(l=0;l<d.length;l+=1)a[l]={r:0,g:0,b:0,a:0,n:0};for(u=0;u<t.height;u+=1)for(l=0;l<t.width;l+=1){for(n=4*(u*t.width+l),o=1024,h=s=0;h<d.length;h+=1)(r=Math.abs(d[h].r-t.data[n])+Math.abs(d[h].g-t.data[n+1])+Math.abs(d[h].b-t.data[n+2])+Math.abs(d[h].a-t.data[n+3]))<o&&(o=r,s=h);a[s].r+=t.data[n],a[s].g+=t.data[n+1],a[s].b+=t.data[n+2],a[s].a+=t.data[n+3],a[s].n+=1,i[u+1][l+1]=s}}return{array:i,palette:d}}},{key:"samplepalette",value:function(t,e){for(var i=void 0,n=[],r=0;r<t;r+=1)i=4*Math.floor(Math.random()*e.data.length/4),n.push({r:e.data[i],g:e.data[i+1],b:e.data[i+2],a:e.data[i+3]});return n}},{key:"samplepalette2",value:function(t,e){for(var i=void 0,n=[],r=Math.ceil(Math.sqrt(t)),o=Math.ceil(t/r),s=e.width/(r+1),a=e.height/(o+1),c=0;c<o;c+=1)for(var l=0;l<r&&n.length!==t;l+=1)i=4*Math.floor((c+1)*a*e.width+(l+1)*s),n.push({r:e.data[i],g:e.data[i+1],b:e.data[i+2],a:e.data[i+3]});return n}},{key:"generatepalette",value:function(t){var e=[],i=void 0,n=void 0,r=void 0;if(t<8)for(var o=Math.floor(255/(t-1)),s=0;s<t;s+=1)e.push({r:s*o,g:s*o,b:s*o,a:255});else{var a=Math.floor(Math.pow(t,1/3)),c=Math.floor(255/(a-1)),l=t-a*a*a;for(i=0;i<a;i+=1)for(n=0;n<a;n+=1)for(r=0;r<a;r+=1)e.push({r:i*c,g:n*c,b:r*c,a:255});for(i=0;i<l;i+=1)e.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return e}},{key:"layering",value:function(t){var e=[],i=0,n=t.array.length,r=t.array[0].length,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0,u=void 0,h=void 0,f=void 0,d=void 0,p=void 0,g=void 0;for(g=0;g<t.palette.length;g+=1)for(e[g]=[],p=0;p<n;p+=1)for(e[g][p]=[],d=0;d<r;d+=1)e[g][p][d]=0;for(p=1;p<n-1;p+=1)for(d=1;d<r-1;d+=1)i=t.array[p][d],o=t.array[p-1][d-1]===i?1:0,s=t.array[p-1][d]===i?1:0,a=t.array[p-1][d+1]===i?1:0,c=t.array[p][d-1]===i?1:0,l=t.array[p][d+1]===i?1:0,u=t.array[p+1][d-1]===i?1:0,h=t.array[p+1][d]===i?1:0,f=t.array[p+1][d+1]===i?1:0,e[i][p+1][d+1]=1+2*l+4*f+8*h,c||(e[i][p+1][d]=2+4*h+8*u),s||(e[i][p][d+1]=0+2*a+4*l+8),o||(e[i][p][d]=0+2*s+4+8*c);return e}},{key:"layeringstep",value:function(t,e){var i=[],n=t.array.length,r=t.array[0].length,o=void 0,s=void 0;for(s=0;s<n;s+=1)for(i[s]=[],o=0;o<r;o+=1)i[s][o]=0;for(s=1;s<n;s+=1)for(o=1;o<r;o+=1)i[s][o]=(t.array[s-1][o-1]===e?1:0)+(t.array[s-1][o]===e?2:0)+(t.array[s][o-1]===e?8:0)+(t.array[s][o]===e?4:0);return i}},{key:"pathscan",value:function(t,e){for(var i=[],n=0,r=0,o=0,s=0,a=t[0].length,c=t.length,l=0,u=!0,h=!1,f=void 0,d=0;d<c;d+=1)for(var p=0;p<a;p+=1)if(4===t[d][p]||11===t[d][p])for(o=p,s=d,i[n]={},i[n].points=[],i[n].boundingbox=[o,s,o,s],i[n].holechildren=[],u=!1,r=0,h=11===t[d][p],l=1;!u;){if(i[n].points[r]={},i[n].points[r].x=o-1,i[n].points[r].y=s-1,i[n].points[r].t=t[s][o],o-1<i[n].boundingbox[0]&&(i[n].boundingbox[0]=o-1),o-1>i[n].boundingbox[2]&&(i[n].boundingbox[2]=o-1),s-1<i[n].boundingbox[1]&&(i[n].boundingbox[1]=s-1),s-1>i[n].boundingbox[3]&&(i[n].boundingbox[3]=s-1),f=this.pathscan_combined_lookup[t[s][o]][l],t[s][o]=f[0],l=f[1],o+=f[2],s+=f[3],o-1===i[n].points[0].x&&s-1===i[n].points[0].y)if(u=!0,i[n].points.length<e)i.pop();else{if(i[n].isholepath=!!h,h){for(var g=0,v=[-1,-1,a+1,c+1],m=0;m<n;m++)!i[m].isholepath&&this.boundingboxincludes(i[m].boundingbox,i[n].boundingbox)&&this.boundingboxincludes(v,i[m].boundingbox)&&(v=i[g=m].boundingbox);i[g].holechildren.push(n)}n+=1}r+=1}return i}},{key:"boundingboxincludes",value:function(t,e){return t[0]<e[0]&&t[1]<e[1]&&t[2]>e[2]&&t[3]>e[3]}},{key:"batchpathscan",value:function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&(i[n]=this.pathscan(t[n],e));return i}},{key:"internodes",value:function(t,e){var i=[],n=0,r=0,o=0,s=0,a=0,c=void 0,l=void 0;for(c=0;c<t.length;c+=1)for(i[c]={},i[c].points=[],i[c].boundingbox=t[c].boundingbox,i[c].holechildren=t[c].holechildren,i[c].isholepath=t[c].isholepath,n=t[c].points.length,l=0;l<n;l+=1)r=(l+1)%n,o=(l+2)%n,s=(l-1+n)%n,a=(l-2+n)%n,e.rightangleenhance&&this.testrightangle(t[c],a,s,l,r,o)&&(0<i[c].points.length&&(i[c].points[i[c].points.length-1].linesegment=this.getdirection(i[c].points[i[c].points.length-1].x,i[c].points[i[c].points.length-1].y,t[c].points[l].x,t[c].points[l].y)),i[c].points.push({x:t[c].points[l].x,y:t[c].points[l].y,linesegment:this.getdirection(t[c].points[l].x,t[c].points[l].y,(t[c].points[l].x+t[c].points[r].x)/2,(t[c].points[l].y+t[c].points[r].y)/2)})),i[c].points.push({x:(t[c].points[l].x+t[c].points[r].x)/2,y:(t[c].points[l].y+t[c].points[r].y)/2,linesegment:this.getdirection((t[c].points[l].x+t[c].points[r].x)/2,(t[c].points[l].y+t[c].points[r].y)/2,(t[c].points[r].x+t[c].points[o].x)/2,(t[c].points[r].y+t[c].points[o].y)/2)});return i}},{key:"testrightangle",value:function(t,e,i,n,r,o){return t.points[n].x===t.points[e].x&&t.points[n].x===t.points[i].x&&t.points[n].y===t.points[r].y&&t.points[n].y===t.points[o].y||t.points[n].y===t.points[e].y&&t.points[n].y===t.points[i].y&&t.points[n].x===t.points[r].x&&t.points[n].x===t.points[o].x}},{key:"getdirection",value:function(t,e,i,n){return t<i?e<n?1:n<e?7:0:i<t?e<n?3:n<e?5:4:e<n?2:n<e?6:8}},{key:"batchinternodes",value:function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&(i[n]=this.internodes(t[n],e));return i}},{key:"tracepath",value:function(t,e,i){var n=0,r=void 0,o=void 0,s=void 0,a={segments:[]};for(a.boundingbox=t.boundingbox,a.holechildren=t.holechildren,a.isholepath=t.isholepath;n<t.points.length;){for(r=t.points[n].linesegment,o=-1,s=n+1;(t.points[s].linesegment===r||t.points[s].linesegment===o||-1===o)&&s<t.points.length-1;)t.points[s].linesegment!==r&&-1===o&&(o=t.points[s].linesegment),s+=1;s===t.points.length-1&&(s=0),a.segments=a.segments.concat(this.fitseq(t,e,i,n,s)),n=0<s?s:t.points.length}return a}},{key:"fitseq",value:function(t,e,i,n,r){if(r>t.points.length||r<0)return[];var o=n,s=0,a=!0,c=void 0,l=void 0,u=void 0,h=r-n;h<0&&(h+=t.points.length);for(var f=(t.points[r].x-t.points[n].x)/h,d=(t.points[r].y-t.points[n].y)/h,p=(n+1)%t.points.length,g=void 0;p!=r;)(g=p-n)<0&&(g+=t.points.length),c=t.points[n].x+f*g,l=t.points[n].y+d*g,e<(u=(t.points[p].x-c)*(t.points[p].x-c)+(t.points[p].y-l)*(t.points[p].y-l))&&(a=!1),s<u&&(o=p,s=u),p=(p+1)%t.points.length;if(a)return[{type:"L",x1:t.points[n].x,y1:t.points[n].y,x2:t.points[r].x,y2:t.points[r].y}];var v=o;a=!0,s=0;var m=(v-n)/h,b=(1-m)*(1-m),y=2*(1-m)*m,_=m*m,x=(b*t.points[n].x+_*t.points[r].x-t.points[v].x)/-y,C=(b*t.points[n].y+_*t.points[r].y-t.points[v].y)/-y;for(p=n+1;p!=r;)y=2*(1-(m=(p-n)/h))*m,_=m*m,c=(b=(1-m)*(1-m))*t.points[n].x+y*x+_*t.points[r].x,l=b*t.points[n].y+y*C+_*t.points[r].y,i<(u=(t.points[p].x-c)*(t.points[p].x-c)+(t.points[p].y-l)*(t.points[p].y-l))&&(a=!1),s<u&&(o=p,s=u),p=(p+1)%t.points.length;if(a)return[{type:"Q",x1:t.points[n].x,y1:t.points[n].y,x2:x,y2:C,x3:t.points[r].x,y3:t.points[r].y}];var w=v;return this.fitseq(t,e,i,n,w).concat(this.fitseq(t,e,i,w,r))}},{key:"batchtracepaths",value:function(t,e,i){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(this.tracepath(t[r],e,i));return n}},{key:"batchtracelayers",value:function(t,e,i){var n=[];for(var r in t)t.hasOwnProperty(r)&&(n[r]=this.batchtracepaths(t[r],e,i));return n}},{key:"roundtodec",value:function(t,e){return Number(t.toFixed(e))}},{key:"svgpathstring",value:function(t,e,i,n){var r=t.layers[e],o=r[i],s="",a=void 0;if(n.linefilter&&o.segments.length<3)return s;if(s="<path "+(n.desc?'desc="l '+e+" p "+i+'" ':"")+this.tosvgcolorstr(t.palette[e],n)+'d="',-1===n.roundcoords){for(s+="M "+o.segments[0].x1*n.scale+" "+o.segments[0].y1*n.scale+" ",a=0;a<o.segments.length;a++)s+=o.segments[a].type+" "+o.segments[a].x2*n.scale+" "+o.segments[a].y2*n.scale+" ",o.segments[a].hasOwnProperty("x3")&&(s+=o.segments[a].x3*n.scale+" "+o.segments[a].y3*n.scale+" ");s+="Z "}else{for(s+="M "+this.roundtodec(o.segments[0].x1*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[0].y1*n.scale,n.roundcoords)+" ",a=0;a<o.segments.length;a++)s+=o.segments[a].type+" "+this.roundtodec(o.segments[a].x2*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[a].y2*n.scale,n.roundcoords)+" ",o.segments[a].hasOwnProperty("x3")&&(s+=this.roundtodec(o.segments[a].x3*n.scale,n.roundcoords)+" "+this.roundtodec(o.segments[a].y3*n.scale,n.roundcoords)+" ");s+="Z "}for(var c=0;c<o.holechildren.length;c++){var l=r[o.holechildren[c]];if(-1===n.roundcoords)for(l.segments[l.segments.length-1].hasOwnProperty("x3")?s+="M "+l.segments[l.segments.length-1].x3*n.scale+" "+l.segments[l.segments.length-1].y3*n.scale+" ":s+="M "+l.segments[l.segments.length-1].x2*n.scale+" "+l.segments[l.segments.length-1].y2*n.scale+" ",a=l.segments.length-1;0<=a;a--)s+=l.segments[a].type+" ",l.segments[a].hasOwnProperty("x3")&&(s+=l.segments[a].x2*n.scale+" "+l.segments[a].y2*n.scale+" "),s+=l.segments[a].x1*n.scale+" "+l.segments[a].y1*n.scale+" ";else for(l.segments[l.segments.length-1].hasOwnProperty("x3")?s+="M "+this.roundtodec(l.segments[l.segments.length-1].x3*n.scale)+" "+this.roundtodec(l.segments[l.segments.length-1].y3*n.scale)+" ":s+="M "+this.roundtodec(l.segments[l.segments.length-1].x2*n.scale)+" "+this.roundtodec(l.segments[l.segments.length-1].y2*n.scale)+" ",a=l.segments.length-1;0<=a;a--)s+=l.segments[a].type+" ",l.segments[a].hasOwnProperty("x3")&&(s+=this.roundtodec(l.segments[a].x2*n.scale)+" "+this.roundtodec(l.segments[a].y2*n.scale)+" "),s+=this.roundtodec(l.segments[a].x1*n.scale)+" "+this.roundtodec(l.segments[a].y1*n.scale)+" ";s+="Z "}if(s+='" />',n.lcpr||n.qcpr){for(a=0;a<o.segments.length;a++)o.segments[a].hasOwnProperty("x3")&&n.qcpr&&(s+='<circle cx="'+o.segments[a].x2*n.scale+'" cy="'+o.segments[a].y2*n.scale+'" r="'+n.qcpr+'" fill="cyan" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<circle cx="'+o.segments[a].x3*n.scale+'" cy="'+o.segments[a].y3*n.scale+'" r="'+n.qcpr+'" fill="white" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<line x1="'+o.segments[a].x1*n.scale+'" y1="'+o.segments[a].y1*n.scale+'" x2="'+o.segments[a].x2*n.scale+'" y2="'+o.segments[a].y2*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />',s+='<line x1="'+o.segments[a].x2*n.scale+'" y1="'+o.segments[a].y2*n.scale+'" x2="'+o.segments[a].x3*n.scale+'" y2="'+o.segments[a].y3*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />'),!o.segments[a].hasOwnProperty("x3")&&n.lcpr&&(s+='<circle cx="'+o.segments[a].x2*n.scale+'" cy="'+o.segments[a].y2*n.scale+'" r="'+n.lcpr+'" fill="white" stroke-width="'+.2*n.lcpr+'" stroke="black" />');for(c=0;c<o.holechildren.length;c++)for(l=r[o.holechildren[c]],a=0;a<l.segments.length;a++)l.segments[a].hasOwnProperty("x3")&&n.qcpr&&(s+='<circle cx="'+l.segments[a].x2*n.scale+'" cy="'+l.segments[a].y2*n.scale+'" r="'+n.qcpr+'" fill="cyan" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<circle cx="'+l.segments[a].x3*n.scale+'" cy="'+l.segments[a].y3*n.scale+'" r="'+n.qcpr+'" fill="white" stroke-width="'+.2*n.qcpr+'" stroke="black" />',s+='<line x1="'+l.segments[a].x1*n.scale+'" y1="'+l.segments[a].y1*n.scale+'" x2="'+l.segments[a].x2*n.scale+'" y2="'+l.segments[a].y2*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />',s+='<line x1="'+l.segments[a].x2*n.scale+'" y1="'+l.segments[a].y2*n.scale+'" x2="'+l.segments[a].x3*n.scale+'" y2="'+l.segments[a].y3*n.scale+'" stroke-width="'+.2*n.qcpr+'" stroke="cyan" />'),!l.segments[a].hasOwnProperty("x3")&&n.lcpr&&(s+='<circle cx="'+l.segments[a].x2*n.scale+'" cy="'+l.segments[a].y2*n.scale+'" r="'+n.lcpr+'" fill="white" stroke-width="'+.2*n.lcpr+'" stroke="black" />')}return s}},{key:"getsvgstring",value:function(t,e){e=this.checkoptions(e);for(var i=t.width*e.scale,n=t.height*e.scale,r="<svg "+(e.viewbox?'viewBox="0 0 '+i+" "+n+'" ':'width="'+i+'" height="'+n+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+this.versionnumber+'" >',o=0;o<t.layers.length;o+=1)for(var s=0;s<t.layers[o].length;s+=1)t.layers[o][s].isholepath||(r+=this.svgpathstring(t,o,s,e));return r+="</svg>"}},{key:"compareNumbers",value:function(t,e){return t-e}},{key:"torgbastr",value:function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"}},{key:"tosvgcolorstr",value:function(t,e){return'fill="rgb('+t.r+","+t.g+","+t.b+')" stroke="rgb('+t.r+","+t.g+","+t.b+')" stroke-width="'+e.strokewidth+'" opacity="'+t.a/255+'" '}},{key:"appendSVGString",value:function(t,e){var i=void 0;e?(i=document.getElementById(e))||((i=document.createElement("div")).id=e,document.body.appendChild(i)):(i=document.createElement("div"),document.body.appendChild(i)),i.innerHTML+=t}},{key:"blur",value:function(t,e,i){var n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0,u=void 0,h=void 0,f={width:t.width,height:t.height,data:[]};if((e=Math.floor(e))<1)return t;5<e&&(e=5),1024<(i=Math.abs(i))&&(i=1024);var d=this.gks[e-1];for(r=0;r<t.height;r++)for(n=0;n<t.width;n++){for(h=u=l=c=a=0,o=-e;o<e+1;o++)0<n+o&&n+o<t.width&&(s=4*(r*t.width+n+o),a+=t.data[s]*d[o+e],c+=t.data[s+1]*d[o+e],l+=t.data[s+2]*d[o+e],u+=t.data[s+3]*d[o+e],h+=d[o+e]);s=4*(r*t.width+n),f.data[s]=Math.floor(a/h),f.data[s+1]=Math.floor(c/h),f.data[s+2]=Math.floor(l/h),f.data[s+3]=Math.floor(u/h)}var p=new Uint8ClampedArray(f.data);for(r=0;r<t.height;r++)for(n=0;n<t.width;n++){for(h=u=l=c=a=0,o=-e;o<e+1;o++)0<r+o&&r+o<t.height&&(a+=p[s=4*((r+o)*t.width+n)]*d[o+e],c+=p[s+1]*d[o+e],l+=p[s+2]*d[o+e],u+=p[s+3]*d[o+e],h+=d[o+e]);s=4*(r*t.width+n),f.data[s]=Math.floor(a/h),f.data[s+1]=Math.floor(c/h),f.data[s+2]=Math.floor(l/h),f.data[s+3]=Math.floor(u/h)}for(r=0;r<t.height;r++)for(n=0;n<t.width;n++)s=4*(r*t.width+n),i<Math.abs(f.data[s]-t.data[s])+Math.abs(f.data[s+1]-t.data[s+1])+Math.abs(f.data[s+2]-t.data[s+2])+Math.abs(f.data[s+3]-t.data[s+3])&&(f.data[s]=t.data[s],f.data[s+1]=t.data[s+1],f.data[s+2]=t.data[s+2],f.data[s+3]=t.data[s+3]);return f}},{key:"loadImage",value:function(t,e,i){var n=new Image;i&&i.corsenabled&&(n.crossOrigin="Anonymous"),n.src=t,n.onload=function(){var t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),e(t)}}},{key:"getImgdata",value:function(t){return t.getContext("2d").getImageData(0,0,t.width,t.height)}},{key:"drawLayers",value:function(t,e,i,n){i=i||1;var r=void 0,o=void 0,s=void 0,a=void 0,c=void 0,l=void 0;for(c in n?(l=document.getElementById(n))||((l=document.createElement("div")).id=n,document.body.appendChild(l)):(l=document.createElement("div"),document.body.appendChild(l)),t)if(t.hasOwnProperty(c)){r=t[c][0].length,o=t[c].length;var u=document.createElement("canvas");u.width=r*i,u.height=o*i;var h=u.getContext("2d");for(a=0;a<o;a+=1)for(s=0;s<r;s+=1)h.fillStyle=this.torgbastr(e[t[c][a][s]%e.length]),h.fillRect(s*i,a*i,i,i);l.appendChild(u)}}}]),o);function o(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.versionnumber="1.2.4",this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}]}e.default=r},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=k(i(3)),s=k(i(4)),a=k(i(106)),c=k(i(107)),l=k(i(109)),u=k(i(111)),h=k(i(112)),f=k(i(113)),d=k(i(114)),p=k(i(115)),g=k(i(116)),v=k(i(117)),m=k(i(123)),b=k(i(125)),y=k(i(127)),_=k(i(128)),x=k(i(129)),C=k(i(130)),w=k(i(73)),S=k(i(72));function k(t){return t&&t.__esModule?t:{default:t}}var O=w.default.componentNames,E=w.default.eventNames,T=w.default.drawingModes,j=w.default.fObjectOptions,M=o.default.extend,P=o.default.stamp,A=o.default.isArray,I=o.default.isString,D=o.default.forEachArray,L=o.default.forEachOwnProperties,R=o.default.CustomEvents,B={cssOnly:!0},F={backstoreOnly:!0},N=(n(z,[{key:"destroy",value:function(){var t=this._canvas.wrapperEl;this._canvas.clear(),t.parentNode.removeChild(t)}},{key:"deactivateAll",value:function(){return this._canvas.deactivateAll(),this}},{key:"renderAll",value:function(){return this._canvas.renderAll(),this}},{key:"add",value:function(t){var e,i=[];A(t)?i=t:i.push(t),(e=this._canvas).add.apply(e,i)}},{key:"contains",value:function(t){return this._canvas.contains(t)}},{key:"getObjects",value:function(){return this._canvas.getObjects().slice()}},{key:"getObject",value:function(t){return this._objects[t]}},{key:"remove",value:function(t){this._canvas.remove(t)}},{key:"removeAll",value:function(t){var e=this._canvas,i=e.getObjects().slice();return e.remove.apply(e,this._canvas.getObjects()),t&&e.clear(),i}},{key:"removeObjectById",value:function(t){var e=[],i=this._canvas,n=this.getObject(t);return n&&n.isType("group")&&!n.isEmpty()?(i.discardActiveGroup(),n.forEachObject(function(t){e.push(t),t.remove()})):i.contains(n)&&(e.push(n),n.remove()),e}},{key:"getObjectId",value:function(t){var e=null;for(e in this._objects)if(this._objects.hasOwnProperty(e)&&t===this._objects[e])return e;return null}},{key:"getActiveObject",value:function(){return this._canvas.getActiveObject()}},{key:"getActiveGroupObject",value:function(){return this._canvas.getActiveGroup()}},{key:"setActiveObject",value:function(t){this._canvas.setActiveObject(t)}},{key:"setCropSelectionStyle",value:function(t){this.cropSelectionStyle=t}},{key:"getComponent",value:function(t){return this._componentMap[t]}},{key:"getDrawingMode",value:function(){return this._drawingMode}},{key:"startDrawingMode",value:function(t,e){if(this._isSameDrawingMode(t))return!0;this.stopDrawingMode();var i=this._getDrawingModeInstance(t);return i&&i.start&&(i.start(this,e),this._drawingMode=t),!!i}},{key:"stopDrawingMode",value:function(){if(!this._isSameDrawingMode(T.NORMAL)){var t=this._getDrawingModeInstance(this.getDrawingMode());t&&t.end&&t.end(this),this._drawingMode=T.NORMAL}}},{key:"toDataURL",value:function(t){return this._canvas&&this._canvas.toDataURL(t)}},{key:"setCanvasImage",value:function(t,e){e&&P(e),this.imageName=t,this.canvasImage=e}},{key:"setCssMaxDimension",value:function(t){this.cssMaxWidth=t.width||this.cssMaxWidth,this.cssMaxHeight=t.height||this.cssMaxHeight}},{key:"adjustCanvasDimension",value:function(){var t=this.canvasImage.scale(1),e=t.getBoundingRect(),i=e.width,n=e.height,r=this._calcMaxDimension(i,n);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":r.width+"px","max-height":r.height+"px"}),this.setCanvasBackstoreDimension({width:i,height:n}),this._canvas.centerObject(t)}},{key:"setCanvasCssDimension",value:function(t){this._canvas.setDimensions(t,B)}},{key:"setCanvasBackstoreDimension",value:function(t){this._canvas.setDimensions(t,F)}},{key:"setImageProperties",value:function(t,e){var i=this.canvasImage;i&&(i.set(t).setCoords(),e&&this._canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this._canvas.getElement()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}},{key:"addImageObject",value:function(t){var i=this,n=this._callbackAfterLoadingImageObject.bind(this);return new s.default(function(e){a.default.Image.fromURL(t,function(t){n(t),e(i.createObjectProperties(t))},{crossOrigin:"Anonymous"})})}},{key:"getCenter",value:function(){return this._canvas.getCenter()}},{key:"getCropzoneRect",value:function(){return this.getComponent(O.CROPPER).getCropzoneRect()}},{key:"setCropzoneRect",value:function(t){this.getComponent(O.CROPPER).setCropzoneRect(t)}},{key:"getCroppedImageData",value:function(t){return this.getComponent(O.CROPPER).getCroppedImageData(t)}},{key:"setBrush",value:function(t){var e=this._drawingMode,i=O.FREE_DRAWING;e===T.LINE&&(i=T.LINE),this.getComponent(i).setBrush(t)}},{key:"setDrawingShape",value:function(t,e){this.getComponent(O.SHAPE).setStates(t,e)}},{key:"registerPaths",value:function(t){this.getComponent(O.ICON).registerPaths(t)}},{key:"changeCursor",value:function(t){var e=this.getCanvas();e.defaultCursor=t,e.renderAll()}},{key:"hasFilter",value:function(t){return this.getComponent(O.FILTER).hasFilter(t)}},{key:"setSelectionStyle",value:function(t){M(j.SELECTION_STYLE,t)}},{key:"setObjectProperties",value:function(t,e){var i=this.getObject(t),n=M({},e);return i.set(n),i.setCoords(),this.getCanvas().renderAll(),n}},{key:"getObjectProperties",value:function(t,e){var i=this.getObject(t),n={};return I(e)?n[e]=i[e]:A(e)?D(e,function(t){n[t]=i[t]}):L(e,function(t,e){n[e]=i[e]}),n}},{key:"getObjectPosition",value:function(t,e,i){var n=this.getObject(t);return n?n.getPointByOrigin(e,i):null}},{key:"setObjectPosition",value:function(t,e){var i=this.getObject(t),n=e.x,r=e.y,o=e.originX,s=e.originY;if(!i)return!1;var a=i.getPointByOrigin(o,s),c=i.getPointByOrigin("center","center"),l=c.x-a.x,u=c.y-a.y;return i.set({left:n+l,top:r+u}),i.setCoords(),!0}},{key:"getCanvasSize",value:function(){var t=this.getCanvasImage();return{width:t?t.width:0,height:t?t.height:0}}},{key:"_getDrawingModeInstance",value:function(t){return this._drawingModeMap[t]}},{key:"_setCanvasElement",value:function(t){var e=void 0,i=void 0;"CANVAS"!==(e=t.nodeType?t:document.querySelector(t)).nodeName.toUpperCase()&&(i=document.createElement("canvas"),e.appendChild(i)),this._canvas=new a.default.Canvas(i,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1})}},{key:"_createDrawingModeInstances",value:function(){this._register(this._drawingModeMap,new b.default),this._register(this._drawingModeMap,new y.default),this._register(this._drawingModeMap,new _.default),this._register(this._drawingModeMap,new x.default),this._register(this._drawingModeMap,new C.default)}},{key:"_createComponents",value:function(){this._register(this._componentMap,new c.default(this)),this._register(this._componentMap,new l.default(this)),this._register(this._componentMap,new u.default(this)),this._register(this._componentMap,new h.default(this)),this._register(this._componentMap,new f.default(this)),this._register(this._componentMap,new d.default(this)),this._register(this._componentMap,new p.default(this)),this._register(this._componentMap,new g.default(this)),this._register(this._componentMap,new v.default(this)),this._register(this._componentMap,new m.default(this))}},{key:"_register",value:function(t,e){t[e.getName()]=e}},{key:"_isSameDrawingMode",value:function(t){return this.getDrawingMode()===t}},{key:"_calcMaxDimension",value:function(t,e){var i=this.cssMaxWidth/t,n=this.cssMaxHeight/e,r=Math.min(t,this.cssMaxWidth),o=Math.min(e,this.cssMaxHeight);return i<1&&i<n?(r=t*i,o=e*i):n<1&&n<i&&(r=t*n,o=e*n),{width:Math.floor(r),height:Math.floor(o)}}},{key:"_callbackAfterLoadingImageObject",value:function(t){var e=this.getCanvasImage().getCenterPoint();t.set(w.default.fObjectOptions.SELECTION_STYLE),t.set({left:e.x,top:e.y,crossOrigin:"Anonymous"}),this.getCanvas().add(t).setActiveObject(t)}},{key:"_attachCanvasEvents",value:function(){var t=this._canvas,e=this._handler;t.on({"mouse:down":e.onMouseDown,"object:added":e.onObjectAdded,"object:removed":e.onObjectRemoved,"object:moving":e.onObjectMoved,"object:scaling":e.onObjectScaled,"object:selected":e.onObjectSelected,"path:created":e.onPathCreated,"selection:cleared":e.onSelectionCleared,"selection:created":e.onSelectionCreated})}},{key:"_onMouseDown",value:function(t){var e=this._canvas.getPointer(t.e);this.fire(E.MOUSE_DOWN,t.e,e)}},{key:"_onObjectAdded",value:function(t){var e=t.target;e.isType("cropzone")||this._addFabricObject(e)}},{key:"_onObjectRemoved",value:function(t){var e=t.target;this._removeFabricObject(P(e))}},{key:"_onObjectMoved",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(E.OBJECT_MOVED,i)}},{key:"_onObjectScaled",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(E.OBJECT_SCALED,i)}},{key:"_onObjectSelected",value:function(t){var e=t.target,i=this.createObjectProperties(e);this.fire(E.OBJECT_ACTIVATED,i)}},{key:"_onPathCreated",value:function(t){t.path.set(w.default.fObjectOptions.SELECTION_STYLE);var e=this.createObjectProperties(t.path);this.fire(E.ADD_OBJECT,e)}},{key:"_onSelectionCleared",value:function(){this.fire(E.SELECTION_CLEARED)}},{key:"_onSelectionCreated",value:function(t){this.fire(E.SELECTION_CREATED,t.target)}},{key:"discardSelection",value:function(){this._canvas.discardActiveGroup(),this._canvas.discardActiveObject(),this._canvas.renderAll()}},{key:"changeSelectableAll",value:function(e){this._canvas.forEachObject(function(t){t.selectable=e,t.hoverCursor=e?"move":"crosshair"})}},{key:"createObjectProperties",value:function(t){var e={id:P(t),type:t.type};return M(e,S.default.getProperties(t,["left","top","width","height","fill","stroke","strokeWidth","opacity"])),-1<["i-text","text"].indexOf(t.type)&&M(e,this._createTextProperties(t,e)),e}},{key:"_createTextProperties",value:function(t){var e={};return M(e,S.default.getProperties(t,["text","fontFamily","fontSize","fontStyle","textAlign","textDecoration"])),e}},{key:"_addFabricObject",value:function(t){var e=P(t);return this._objects[e]=t,e}},{key:"_removeFabricObject",value:function(t){delete this._objects[t]}}]),z);function z(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=e.cssMaxWidth,n=e.cssMaxHeight,r=e.useItext,o=void 0!==r&&r,s=e.useDragAddIcon,a=void 0!==s&&s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,z),this.canvasImage=null,this.cssMaxWidth=i||1e3,this.cssMaxHeight=n||800,this.useItext=o,this.useDragAddIcon=a,this.cropSelectionStyle={},this.imageName="",this._objects={},this._canvas=null,this._drawingMode=T.NORMAL,this._drawingModeMap={},this._componentMap={},this._handler={onMouseDown:this._onMouseDown.bind(this),onObjectAdded:this._onObjectAdded.bind(this),onObjectRemoved:this._onObjectRemoved.bind(this),onObjectMoved:this._onObjectMoved.bind(this),onObjectScaled:this._onObjectScaled.bind(this),onObjectSelected:this._onObjectSelected.bind(this),onPathCreated:this._onPathCreated.bind(this),onSelectionCleared:this._onSelectionCleared.bind(this),onSelectionCreated:this._onSelectionCreated.bind(this)},this._setCanvasElement(t),this._createDrawingModeInstances(),this._createComponents(),this._attachCanvasEvents()}R.mixin(N),t.exports=N},function(t,e){t.exports=r},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(4)),s=c(i(108)),a=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=a.default.componentNames,u=a.default.rejectMessages,h={padding:0,crossOrigin:"Anonymous"},f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,s.default),n(d,[{key:"load",value:function(e,t){var i=this,n=void 0;if(e||t)n=this._setBackgroundImage(t).then(function(t){return i.setCanvasImage(e,t),i.adjustCanvasDimension(),t});else{var r=this.getCanvas();r.backgroundImage=null,r.renderAll(),n=new o.default(function(t){i.setCanvasImage("",null),t()})}return n}},{key:"_setBackgroundImage",value:function(t){var r=this;return t?new o.default(function(e,i){var n=r.getCanvas();n.setBackgroundImage(t,function(){var t=n.backgroundImage;t&&t.getElement()?e(t):i(u.loadingImageFailed)},h)}):o.default.reject(u.loadImage)}}]),d);function d(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,l.IMAGE_LOADER,t))}t.exports=f},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=(function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}(r,[{key:"fire",value:function(){for(var t=this.graphics,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.graphics.fire.apply(t,i)}},{key:"setCanvasImage",value:function(t,e){this.graphics.setCanvasImage(t,e)}},{key:"getCanvasElement",value:function(){return this.graphics.getCanvasElement()}},{key:"getCanvas",value:function(){return this.graphics.getCanvas()}},{key:"getCanvasImage",value:function(){return this.graphics.getCanvasImage()}},{key:"getImageName",value:function(){return this.graphics.getImageName()}},{key:"getEditor",value:function(){return this.graphics.getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(t,e){this.graphics.setImageProperties(t,e)}},{key:"setCanvasCssDimension",value:function(t){this.graphics.setCanvasCssDimension(t)}},{key:"setCanvasBackstoreDimension",value:function(t){this.graphics.setCanvasBackstoreDimension(t)}},{key:"adjustCanvasDimension",value:function(){this.graphics.adjustCanvasDimension()}}]),r);function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.name=t,this.graphics=e}t.exports=i},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var f=l(i(3)),o=l(i(106)),s=l(i(108)),a=l(i(110)),c=i(73),h=i(72);function l(t){return t&&t.__esModule?t:{default:t}}var u={top:-10,left:-10,height:1,width:1},d=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(p,s.default),n(p,[{key:"start",value:function(){if(!this._cropzone){var t=this.getCanvas();t.forEachObject(function(t){t.evented=!1}),this._cropzone=new a.default({left:-10,top:-10,width:1,height:1,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent",hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0},this.graphics.cropSelectionStyle),t.deactivateAll(),t.add(this._cropzone),t.on("mouse:down",this._listeners.mousedown),t.selection=!1,t.defaultCursor="crosshair",o.default.util.addListener(document,"keydown",this._listeners.keydown),o.default.util.addListener(document,"keyup",this._listeners.keyup)}}},{key:"end",value:function(){var t=this.getCanvas(),e=this._cropzone;e&&(e.remove(),t.selection=!0,t.defaultCursor="default",t.off("mouse:down",this._listeners.mousedown),t.forEachObject(function(t){t.evented=!0}),this._cropzone=null,o.default.util.removeListener(document,"keydown",this._listeners.keydown),o.default.util.removeListener(document,"keyup",this._listeners.keyup))}},{key:"_onFabricMouseDown",value:function(t){var e=this.getCanvas();if(!t.target){e.selection=!1;var i=e.getPointer(t.e);this._startX=i.x,this._startY=i.y,e.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e),n=i.x,r=i.y,o=this._cropzone;10<Math.abs(n-this._startX)+Math.abs(r-this._startY)&&(o.remove(),o.set(this._calcRectDimensionFromPoint(n,r)),e.add(o))}},{key:"_calcRectDimensionFromPoint",value:function(t,e){var i=this.getCanvas(),n=i.getWidth(),r=i.getHeight(),o=this._startX,s=this._startY,a=(0,h.clamp)(t,0,o),c=(0,h.clamp)(e,0,s),l=(0,h.clamp)(t,o,n)-a,u=(0,h.clamp)(e,s,r)-c;return this._withShiftKey&&(u<l?u=l:l<u&&(l=u),t<=o&&(a=o-l),e<=s&&(c=s-u)),{left:a,top:c,width:l,height:u}}},{key:"_onFabricMouseUp",value:function(){var t=this._cropzone,e=this._listeners,i=this.getCanvas();i.setActiveObject(t),i.off({"mouse:move":e.mousemove,"mouse:up":e.mouseup})}},{key:"getCroppedImageData",value:function(t){var e=this.getCanvas(),i=e.contains(this._cropzone);if(!t)return null;i&&this._cropzone.remove();var n={imageName:this.getImageName(),url:e.toDataURL(t)};return i&&e.add(this._cropzone),n}},{key:"getCropzoneRect",value:function(){var t=this._cropzone;return t.isValid()?{left:t.getLeft(),top:t.getTop(),width:t.getWidth(),height:t.getHeight()}:null}},{key:"setCropzoneRect",value:function(t){var e=this.getCanvas(),i=this._cropzone;e.deactivateAll(),e.selection=!1,i.remove(),i.set(t?this._getPresetCropSizePosition(t):u),e.add(i),e.selection=!0,t&&e.setActiveObject(i)}},{key:"_getPresetCropSizePosition",value:function(t){function e(t,e){return e<t?e/t:1}var i=this.getCanvas(),n=i.getWidth(),r=i.getHeight(),o=r<=n?n:r,s=o*t,a=o,c=e(s,n),l=f.default.map([s,a],function(t){return t*c});s=l[0];var u=e(a=l[1],r),h=f.default.map([s,a],function(t){return t*u});return s=h[0],{top:(r-(a=h[1]))/2,left:(n-s)/2,width:s,height:a}}},{key:"_onKeyDown",value:function(t){t.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(t){t.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!1)}}]),p);function p(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,c.componentNames.CROPPER,t));return e._cropzone=null,e._startX=null,e._startY=null,e._withShiftKey=!1,e._listeners={keydown:e._onKeyDown.bind(e),keyup:e._onKeyUp.bind(e),mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e)},e}t.exports=d},function(t,e,i){var c=r(i(3)),n=r(i(106)),a=i(72);function r(t){return t&&t.__esModule?t:{default:t}}var o=n.default.util.createClass(n.default.Rect,{initialize:function(t,e){(t=c.default.extend(t,e)).type="cropzone",this.callSuper("initialize",t),this.options=t,this.on({moving:this._onMoving,scaling:this._onScaling})},_render:function(t){this.callSuper("_render",t);var e=this.flipX?-1:1,i=this.flipY?-1:1,n=e/this.scaleX,r=i/this.scaleY;t.scale(n,r),this._fillOuterRect(t,"rgba(0, 0, 0, 0.55)"),this.options.lineWidth?(this._fillInnerRect(t),this._strokeBorder(t,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth})):(this._strokeBorder(t,"rgb(0, 0, 0)",{lineDashWidth:7}),this._strokeBorder(t,"rgb(255, 255, 255)",{lineDashWidth:7,lineDashOffset:7})),t.scale(1/n,1/r)},_fillOuterRect:function(t,e){var i=this._getCoordinates(t),n=i.x,r=i.y;t.save(),t.fillStyle=e,t.beginPath(),t.moveTo(n[0]-1,r[0]-1),t.lineTo(n[3]+1,r[0]-1),t.lineTo(n[3]+1,r[3]+1),t.lineTo(n[0]-1,r[3]+1),t.lineTo(n[0]-1,r[0]-1),t.closePath(),t.moveTo(n[1],r[1]),t.lineTo(n[1],r[2]),t.lineTo(n[2],r[2]),t.lineTo(n[2],r[1]),t.lineTo(n[1],r[1]),t.closePath(),t.fill(),t.restore()},_fillInnerRect:function(t){var e=this._getCoordinates(t),i=e.x,n=e.y,r=this._caculateInnerPosition(i,(i[2]-i[1])/3),o=this._caculateInnerPosition(n,(n[2]-n[1])/3);t.save(),t.strokeStyle="rgba(255, 255, 255, 0.7)",t.lineWidth=this.options.lineWidth,t.beginPath(),t.moveTo(r[0],o[1]),t.lineTo(r[3],o[1]),t.moveTo(r[0],o[2]),t.lineTo(r[3],o[2]),t.moveTo(r[1],o[0]),t.lineTo(r[1],o[3]),t.moveTo(r[2],o[0]),t.lineTo(r[2],o[3]),t.stroke(),t.closePath(),t.restore()},_caculateInnerPosition:function(t,e){var i=[];return i[0]=t[1],i[1]=t[1]+e,i[2]=t[1]+2*e,i[3]=t[2],i},_getCoordinates:function(t){var e=this.getWidth(),i=this.getHeight(),n=e/2,r=i/2,o=this.getLeft(),s=this.getTop(),a=t.canvas;return{x:c.default.map([-(n+o),-n,n,n+(a.width-o-e)],Math.ceil),y:c.default.map([-(r+s),-r,r,r+(a.height-s-i)],Math.ceil)}},_strokeBorder:function(t,e,i){var n=i.lineDashWidth,r=i.lineDashOffset,o=i.lineWidth,s=this.getWidth()/2,a=this.getHeight()/2;t.save(),t.strokeStyle=e,t.setLineDash&&t.setLineDash([n,n]),r&&(t.lineDashOffset=r),o&&(t.lineWidth=o),t.beginPath(),t.moveTo(-s,-a),t.lineTo(s,-a),t.lineTo(s,a),t.lineTo(-s,a),t.lineTo(-s,-a),t.stroke(),t.restore()},_onMoving:function(){var t=this.getLeft(),e=this.getTop(),i=this.getWidth(),n=this.getHeight(),r=this.canvas.getWidth()-i,o=this.canvas.getHeight()-n;this.setLeft((0,a.clamp)(t,0,r)),this.setTop((0,a.clamp)(e,0,o))},_onScaling:function(t){var e=this.canvas.getPointer(t.e),i=this._calcScalingSizeFromPointer(e);this.scale(1).set(i)},_calcScalingSizeFromPointer:function(t){var e=t.x,i=t.y,n=this._calcTopLeftScalingSizeFromPointer(e,i),r=this._calcBottomRightScalingSizeFromPointer(e,i);return this._makeScalingSettings(n,r)},_calcTopLeftScalingSizeFromPointer:function(t,e){var i=this.getHeight()+this.top,n=this.getWidth()+this.left,r=(0,a.clamp)(e,0,i-1),o=(0,a.clamp)(t,0,n-1);return{top:r,left:o,width:n-o,height:i-r}},_calcBottomRightScalingSizeFromPointer:function(t,e){var i=this.canvas,n=i.width,r=i.height,o=this.left,s=this.top;return{width:(0,a.clamp)(t,o+1,n)-o,height:(0,a.clamp)(e,s+1,r)-s}},_makeScalingSettings:function(t,e){var i=t.width,n=t.height,r=e.height,o=e.width,s=t.left,a=t.top,c=void 0;switch(this.__corner){case"tl":c=t;break;case"tr":c={width:o,height:n,top:a};break;case"bl":c={width:i,height:r,left:s};break;case"br":c=e;break;case"ml":c={width:i,left:s};break;case"mt":c={height:n,top:a};break;case"mr":c={width:o};break;case"mb":c={height:r}}return c},isValid:function(){return 0<=this.left&&0<=this.top&&0<this.width&&0<this.height}});t.exports=o},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=l(i(3)),s=l(i(4)),a=l(i(108)),c=l(i(73));function l(t){return t&&t.__esModule?t:{default:t}}var u=c.default.componentNames,h=c.default.rejectMessages,f=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(d,a.default),n(d,[{key:"getCurrentSetting",value:function(){var t=this.getCanvasImage();return{flipX:t.flipX,flipY:t.flipY}}},{key:"set",value:function(t){var e=this.getCurrentSetting(),i=e.flipX!==t.flipX,n=e.flipY!==t.flipY;return i||n?(o.default.extend(e,t),this.setImageProperties(e,!0),this._invertAngle(i,n),this._flipObjects(i,n),s.default.resolve({flipX:e.flipX,flipY:e.flipY,angle:this.getCanvasImage().angle})):s.default.reject(h.flip)}},{key:"_invertAngle",value:function(t,e){var i=this.getCanvasImage(),n=i.angle;t&&(n*=-1),e&&(n*=-1),i.setAngle(parseFloat(n)).setCoords()}},{key:"_flipObjects",value:function(t,e){var i=this.getCanvas();t&&i.forEachObject(function(t){t.set({angle:parseFloat(-1*t.angle),flipX:!t.flipX,left:i.width-t.left}).setCoords()}),e&&i.forEachObject(function(t){t.set({angle:parseFloat(-1*t.angle),flipY:!t.flipY,top:i.height-t.top}).setCoords()}),i.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var t=this.getCurrentSetting();return this.set({flipX:!t.flipX,flipY:t.flipY})}},{key:"flipY",value:function(){var t=this.getCurrentSetting();return this.set({flipX:t.flipX,flipY:!t.flipY})}}]),d);function d(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,u.FLIP,t))}t.exports=f},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=a(i(106)),o=a(i(4)),s=a(i(108));function a(t){return t&&t.__esModule?t:{default:t}}var l=a(i(73)).default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,s.default),n(h,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(t){var e=this.getCurrentAngle()%360;t%=360;var i=this.getCanvasImage(),n=i.getCenterPoint();i.setAngle(t).setCoords(),this.adjustCanvasDimension();var r=i.getCenterPoint();return this._rotateForEachObject(n,r,t-e),o.default.resolve(t)}},{key:"_rotateForEachObject",value:function(r,t,o){var e=this.getCanvas(),s=r.x-t.x,a=r.y-t.y;e.forEachObject(function(t){var e=t.getCenterPoint(),i=c.default.util.degreesToRadians(o),n=c.default.util.rotatePoint(e,r,i);t.set({left:n.x-s,top:n.y-a,angle:(t.angle+o)%360}),t.setCoords()}),e.renderAll()}},{key:"rotate",value:function(t){var e=this.getCurrentAngle();return this.setAngle(e+t)}}]),h);function h(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,l.ROTATION,t))}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(106)),s=c(i(108)),a=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(u,s.default),n(u,[{key:"start",value:function(t){this.getCanvas().isDrawingMode=!0,this.setBrush(t)}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this.width=t.width||this.width,t.color&&(this.oColor=new o.default.Color(t.color)),e.width=this.width,e.color=this.oColor.toRgba()}},{key:"end",value:function(){this.getCanvas().isDrawingMode=!1}}]),u);function u(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,a.default.componentNames.FREE_DRAWING,t));return e.width=12,e.oColor=new o.default.Color("rgba(0, 0, 0, 0.5)"),e}t.exports=l},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(106)),s=c(i(108)),a=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=a.default.eventNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,s.default),n(h,[{key:"start",value:function(t){var e=this.getCanvas();e.defaultCursor="crosshair",e.selection=!1,this.setBrush(t),e.forEachObject(function(t){t.set({evented:!1})}),e.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(t){var e=this.getCanvas().freeDrawingBrush;t=t||{},this._width=t.width||this._width,t.color&&(this._oColor=new o.default.Color(t.color)),e.width=this._width,e.color=this._oColor.toRgba()}},{key:"end",value:function(){var t=this.getCanvas();t.defaultCursor="default",t.selection=!0,t.forEachObject(function(t){t.set({evented:!0})}),t.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e),n=[i.x,i.y,i.x,i.y];this._line=new o.default.Line(n,{stroke:this._oColor.toRgba(),strokeWidth:this._width,evented:!1}),this._line.set(a.default.fObjectOptions.SELECTION_STYLE),e.add(this._line),e.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_onFabricMouseMove",value:function(t){var e=this.getCanvas(),i=e.getPointer(t.e);this._line.set({x2:i.x,y2:i.y}),this._line.setCoords(),e.renderAll()}},{key:"_onFabricMouseUp",value:function(){var t=this.getCanvas(),e=this.graphics.createObjectProperties(this._line);this.fire(l.ADD_OBJECT,e),this._line=null,t.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}]),h);function h(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,a.default.componentNames.LINE,t));return e._width=12,e._oColor=new o.default.Color("rgba(0, 0, 0, 0.5)"),e._listeners={mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e)},e}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=a(i(106)),l=a(i(3)),u=a(i(4)),o=a(i(108)),h=a(i(73)),s=a(i(72));function a(t){return t&&t.__esModule?t:{default:t}}var f=h.default.eventNames,d={fill:"#000000",left:0,top:0},p={fill:"#000000",fontStyle:"normal",fontWeight:"normal",textAlign:"left",textDecoraiton:""},g=l.default.browser,v=s.default.makeStyleText({position:"absolute",padding:0,display:"none",border:"1px dotted red",overflow:"hidden",resize:"none",outline:"none","border-radius":0,"background-color":"transparent","-webkit-appearance":"none","z-index":9999,"white-space":"pre"}),m=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(b,o.default),n(b,[{key:"start",value:function(){var t=this.getCanvas();t.selection=!1,t.defaultCursor="text",t.on({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify}),this.useItext?t.forEachObject(function(t){"i-text"===t.type&&t.set({left:t.left-t.width/2,top:t.top-t.height/2,originX:"left",originY:"top"})}):this._createTextarea(),this.setCanvasRatio()}},{key:"end",value:function(){var t=this.getCanvas();t.selection=!0,t.defaultCursor="default",this.useItext?t.forEachObject(function(t){"i-text"===t.type&&(""===t.text?t.remove():t.set({left:t.left+t.width/2,top:t.top+t.height/2,originX:"center",originY:"center"}))}):(t.deactivateAllWithDispatch(),this._removeTextarea()),t.off({"mouse:down":this._listeners.mousedown,"object:selected":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:editing":this._listeners.modify})}},{key:"add",value:function(o,s){var a=this;return new u.default(function(t){var e=a.getCanvas(),i=null,n=h.default.fObjectOptions.SELECTION_STYLE,r=a._defaultStyles;a._setInitPos(s.position),s.styles&&(r=l.default.extend(r,s.styles)),a.useItext?(i=new c.default.IText(o,r),n=l.default.extend({},n,{originX:"left",originY:"top"})):i=new c.default.Text(o,r),i.set(n),i.on({mouseup:a._onFabricMouseUp.bind(a)}),e.add(i),e.getActiveObject()||e.setActiveObject(i),a.isPrevEditing=!0,t(a.graphics.createObjectProperties(i))})}},{key:"change",value:function(e,i){var n=this;return new u.default(function(t){e.set("text",i),n.getCanvas().renderAll(),t()})}},{key:"setStyle",value:function(i,n){var e=this;return new u.default(function(t){l.default.forEach(n,function(t,e){i[e]===t&&(n[e]=p[e]||"")},e),i.set(n),e.getCanvas().renderAll(),t()})}},{key:"getText",value:function(t){return t.getText()}},{key:"setSelectedInfo",value:function(t,e){this._selectedObj=t,this._isSelected=e}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var t=this.getCanvasElement(),e=parseInt(t.style.maxWidth,10),i=t.width/e;this._ratio=i}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_setInitPos",value:function(t){t=t||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=t.x,this._defaultStyles.top=t.y}},{key:"_createTextarea",value:function(){var t=this.getCanvasElement().parentNode,e=document.createElement("textarea");e.className="tui-image-eidtor-textarea",e.setAttribute("style",v),e.setAttribute("wrap","off"),t.appendChild(e),this._textarea=e,this._listeners=l.default.extend(this._listeners,{input:this._onInput.bind(this),keydown:this._onKeyDown.bind(this),blur:this._onBlur.bind(this),scroll:this._onScroll.bind(this)}),g.msie&&9===g.version?c.default.util.addListener(e,"keydown",this._listeners.keydown):c.default.util.addListener(e,"input",this._listeners.input),c.default.util.addListener(e,"blur",this._listeners.blur),c.default.util.addListener(e,"scroll",this._listeners.scroll)}},{key:"_removeTextarea",value:function(){var t=this.getCanvasElement().parentNode,e=t.querySelector("textarea");t.removeChild(e),this._textarea=null,g.msie&&g.version<10?c.default.util.removeListener(e,"keydown",this._listeners.keydown):c.default.util.removeListener(e,"input",this._listeners.input),c.default.util.removeListener(e,"blur",this._listeners.blur),c.default.util.removeListener(e,"scroll",this._listeners.scroll)}},{key:"_onInput",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,i=this._textarea.style;i.width=Math.ceil(e.getWidth()/t)+"px",i.height=Math.ceil(e.getHeight()/t)+"px"}},{key:"_onKeyDown",value:function(){var t=this,e=this.getCanvasRatio(),i=this._editingObj,n=this._textarea.style;setTimeout(function(){i.setText(t._textarea.value),n.width=Math.ceil(i.getWidth()/e)+"px",n.height=Math.ceil(i.getHeight()/e)+"px"},0)}},{key:"_onBlur",value:function(){var t=this.getCanvasRatio(),e=this._editingObj,i=this._editingObjInfos,n=this._textarea.value,r=e.getWidth()/t-i.width/t,o=e.getHeight()/t-i.height/t;if(1===t&&(r/=2,o/=2),this._textarea.style.display="none",e.set({left:i.left+r,top:i.top+o}),n.length){this.getCanvas().add(e);var s={id:l.default.stamp(e),type:e.type,text:n};this.fire(f.TEXT_CHANGED,s)}}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(t){var e=t.target,i=e.getFontSize()*e.getScaleY();e.setFontSize(i),e.setScaleX(1),e.setScaleY(1)}},{key:"_onFabricSelectClear",value:function(t){var e=this.getSelectedObj();this.isPrevEditing=!0,this.setSelectedInfo(t.target,!1),e&&""===e.text&&e.remove()}},{key:"_onFabricSelect",value:function(t){this.isPrevEditing=!0,this.setSelectedInfo(t.target,!0)}},{key:"_onFabricMouseDown",value:function(t){var e=t.target;e&&!e.isType("text")||(this.isPrevEditing?this.isPrevEditing=!1:this._fireAddText(t))}},{key:"_fireAddText",value:function(t){var e=t.target,i=t.e||{},n=this.getCanvas().getPointer(i);e||this.fire(f.ADD_TEXT,{originPosition:{x:n.x,y:n.y},clientPosition:{x:i.clientX||0,y:i.clientY||0}})}},{key:"_onFabricMouseUp",value:function(t){var e=(new Date).getTime();this._isDoubleClick(e)&&(this.useItext||this._changeToEditingMode(t.target),this.fire(f.TEXT_EDITING)),this._lastClickTime=e}},{key:"_isDoubleClick",value:function(t){return t-this._lastClickTime<500}},{key:"_changeToEditingMode",value:function(t){var e=this.getCanvasRatio(),i=this._textarea.style;this.isPrevEditing=!0,t.remove(),this._editingObj=t,this._textarea.value=t.getText(),this._editingObjInfos={left:this._editingObj.getLeft(),top:this._editingObj.getTop(),width:this._editingObj.getWidth(),height:this._editingObj.getHeight()},i.display="block",i.left=t.oCoords.tl.x/e+"px",i.top=t.oCoords.tl.y/e+"px",i.width=Math.ceil(t.getWidth()/e)+"px",i.height=Math.ceil(t.getHeight()/e)+"px",i.transform="rotate("+t.getAngle()+"deg)",i.color=t.getFill(),i["font-size"]=t.getFontSize()/e+"px",i["font-family"]=t.getFontFamily(),i["font-style"]=t.getFontStyle(),i["font-weight"]=t.getFontWeight(),i["text-align"]=t.getTextAlign(),i["line-height"]=t.getLineHeight()+.1,i["transform-origin"]="left top",this._textarea.focus()}}]),b);function b(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,b);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,h.default.componentNames.TEXT,t));return e._defaultStyles=d,e._isSelected=!1,e._selectedObj={},e._editingObj={},e._listeners={mousedown:e._onFabricMouseDown.bind(e),select:e._onFabricSelect.bind(e),selectClear:e._onFabricSelectClear.bind(e),scaling:e._onFabricScaling.bind(e)},e._textarea=null,e._ratio=1,e._lastClickTime=(new Date).getTime(),e._editingObjInfos={},e.isPrevEditing=!1,e.useItext=t.useItext,e}t.exports=m},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=c(i(106)),h=c(i(3)),s=c(i(4)),a=c(i(108)),f=c(i(73));function c(t){return t&&t.__esModule?t:{default:t}}var l=f.default.eventNames,d=f.default.rejectMessages,u={arrow:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},p=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(g,a.default),n(g,[{key:"add",value:function(c,l){var u=this;return new s.default(function(t,e){var i=u.getCanvas(),n=u._pathMap[c],r=f.default.fObjectOptions.SELECTION_STYLE,o=0<=Object.keys(f.default.defaultIconPath).indexOf(c),s=u.useDragAddIcon&&o,a=n?u._createIcon(n):null;a||e(d.invalidParameters),a.set(h.default.extend({type:"icon",fill:u._oColor},r,l,u.graphics.controlStyle)),i.add(a).setActiveObject(a),s&&u._addWithDragEvent(i),t(u.graphics.createObjectProperties(a))})}},{key:"_addWithDragEvent",value:function(e){var i=this;e.on({"mouse:move":function(t){e.selection=!1,i.fire(l.ICON_CREATE_RESIZE,{moveOriginPointer:e.getPointer(t.e)})},"mouse:up":function(t){i.fire(l.ICON_CREATE_END,{moveOriginPointer:e.getPointer(t.e)}),e.defaultCursor="default",e.off("mouse:up"),e.off("mouse:move"),e.selection=!0}})}},{key:"registerPaths",value:function(t){var i=this;h.default.forEach(t,function(t,e){i._pathMap[e]=t},this)}},{key:"setColor",value:function(t,e){this._oColor=t,e&&"icon"===e.get("type")&&(e.setFill(this._oColor),this.getCanvas().renderAll())}},{key:"getColor",value:function(t){return t.fill}},{key:"_createIcon",value:function(t){return new o.default.Path(t)}}]),g);function g(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,f.default.componentNames.ICON,t));return e._oColor="#000000",e._pathMap=u,e.useDragAddIcon=t.useDragAddIcon,e}t.exports=p},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=i(3),c=g(i(4)),s=g(i(106)),a=g(i(108)),l=g(i(118)),u=g(i(73)),h=g(i(119)),f=g(i(120)),d=g(i(121)),p=g(i(122));function g(t){return t&&t.__esModule?t:{default:t}}var v=u.default.rejectMessages,m=s.default.Image.filters;m.Mask=l.default,m.Blur=h.default,m.Sharpen=f.default,m.Emboss=d.default,m.ColorFilter=p.default;var b=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(y,a.default),n(y,[{key:"add",value:function(o,s){var a=this;return new c.default(function(t,e){var i=a._getSourceImage(),n=a.getCanvas(),r=a._getFilter(i,o);r||(r=a._createFilter(i,o,s)),r||e(v.invalidParameters),a._changeFilterValues(r,s),a._apply(i,function(){n.renderAll(),t({type:o,action:"add"})})})}},{key:"remove",value:function(r){var o=this;return new c.default(function(t,e){var i=o._getSourceImage(),n=o.getCanvas();i.filters.length||e(v.unsupportedOperation),o._removeFilter(i,r),o._apply(i,function(){n.renderAll(),t({type:r,action:"remove"})})})}},{key:"hasFilter",value:function(t){return!!this._getFilter(this._getSourceImage(),t)}},{key:"getOptions",value:function(t){var e=this._getSourceImage(),i=this._getFilter(e,t);return i?(0,o.extend)({},i.options):null}},{key:"_changeFilterValues",value:function(i,n){(0,o.forEach)(n,function(t,e){(0,o.isUndefined)(i[e])||(i[e]=t)}),(0,o.forEach)(i.options,function(t,e){(0,o.isUndefined)(n[e])||(i.options[e]=n[e])})}},{key:"_apply",value:function(t,e){t.applyFilters(e)}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(t,e,i){var n=void 0,r=this._getFabricFilterType(e),o=s.default.Image.filters[r];return o&&((n=new o(i)).options=i,t.filters.push(n)),n}},{key:"_getFilter",value:function(t,e){var i=null;if(t){var n=this._getFabricFilterType(e),r=t.filters.length,o=void 0,s=void 0;for(s=0;s<r;s+=1)if((o=t.filters[s]).type===n){i=o;break}}return i}},{key:"_removeFilter",value:function(t,e){var i=this._getFabricFilterType(e);t.filters=(0,o.filter)(t.filters,function(t){return t.type!==i})}},{key:"_getFabricFilterType",value:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}]),y);function y(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,u.default.componentNames.FILTER,t))}t.exports=b},function(t,e,i){var n,r=i(106),o=(n=r)&&n.__esModule?n:{default:n};var s=o.default.util.createClass(o.default.Image.filters.Mask,{applyTo:function(t){if(this.mask){var e=t.width,i=t.height,n=this._createCanvasOfMask(e,i),r=t.getContext("2d"),o=n.getContext("2d"),s=r.getImageData(0,0,e,i);this._drawMask(o,t,r),this._mapData(o,s,e,i),r.putImageData(s,0,0)}},_createCanvasOfMask:function(t,e){var i=o.default.util.createCanvasElement();return i.width=t,i.height=e,i},_drawMask:function(t){var e=this.mask,i=e.getElement(),n=e.getLeft(),r=e.getTop(),o=e.getAngle();t.save(),t.translate(n,r),t.rotate(o*Math.PI/180),t.scale(e.scaleX,e.scaleY),t.drawImage(i,-i.width/2,-i.height/2),t.restore()},_mapData:function(t,e,i,n){for(var r=e.data,o=t.getImageData(0,0,i,n).data,s=this.channel,a=e.width*e.height*4,c=0;c<a;c+=4)r[c+3]=o[c+s]}});t.exports=s},function(t,e,i){var n,r=i(106),o=(n=r)&&n.__esModule?n:{default:n};var s=o.default.util.createClass(o.default.Image.filters.Convolute,{type:"Blur",initialize:function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}});t.exports=s},function(t,e,i){var n,r=i(106),o=(n=r)&&n.__esModule?n:{default:n};var s=o.default.util.createClass(o.default.Image.filters.Convolute,{type:"Sharpen",initialize:function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]}});t.exports=s},function(t,e,i){var n,r=i(106),o=(n=r)&&n.__esModule?n:{default:n};var s=o.default.util.createClass(o.default.Image.filters.Convolute,{type:"Emboss",initialize:function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]}});t.exports=s},function(t,e,i){var n,r=i(106),c=(n=r)&&n.__esModule?n:{default:n};var o=c.default.util.createClass(c.default.Image.filters.BaseFilter,{type:"ColorFilter",initialize:function(t){t||(t={}),this.color=t.color||"#FFFFFF",this.threshold=t.threshold||45,this.x=t.x||null,this.y=t.y||null},applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,o=this.threshold,s=c.default.Color.sourceFromHex(this.color),a=void 0;for(this.x&&this.y&&(s=this._getColor(n,this.x,this.y)),a=0,e=r.length;a<e;a+=4)this._isOutsideThreshold(r[a],s[0],o)||this._isOutsideThreshold(r[a+1],s[1],o)||this._isOutsideThreshold(r[a+2],s[2],o)||(r[a]=r[a+1]=r[a+2]=r[a+3]=0);i.putImageData(n,0,0)},_isOutsideThreshold:function(t,e,i){var n=t-e;return Math.abs(n)>i},_getColor:function(t,e,i){var n=[0,0,0,0],r=t.data,o=4*(t.width*i+e);return n[0]=r[o],n[1]=r[1+o],n[2]=r[2+o],n[3]=r[3+o],n}});t.exports=o},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=h(i(106)),s=h(i(4)),a=h(i(108)),c=h(i(73)),l=h(i(124)),u=i(3);function h(t){return t&&t.__esModule?t:{default:t}}var f=c.default.rejectMessages,d=c.default.eventNames,p=c.default.keyCodes,g={strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0,lockSkewingX:!0,lockSkewingY:!0,lockUniScaling:!1,bringForward:!0,isRegular:!1},v=["rect","circle","triangle"],m=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(b,a.default),n(b,[{key:"start",value:function(){var t=this.getCanvas();this._isSelected=!1,t.defaultCursor="crosshair",t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:down":this._handlers.mousedown}),o.default.util.addListener(document,"keydown",this._handlers.keydown),o.default.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"end",value:function(){var t=this.getCanvas();this._isSelected=!1,t.defaultCursor="default",t.selection=!0,t.uniScaleTransform=!1,t.off({"mouse:down":this._handlers.mousedown}),o.default.util.removeListener(document,"keydown",this._handlers.keydown),o.default.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(t,e){this._type=t,e&&(this._options=(0,u.extend)(this._options,e))}},{key:"add",value:function(n,r){var o=this;return new s.default(function(t){var e=o.getCanvas();r=o._extendOptions(r);var i=o._createInstance(n,r);o._bindEventOnShape(i),e.add(i).setActiveObject(i),t(o.graphics.createObjectProperties(i))})}},{key:"change",value:function(i,n){var r=this;return new s.default(function(t,e){(0,u.inArray)(i.get("type"),v)<0&&e(f.unsupportedType),i.set(n),r.getCanvas().renderAll(),t()})}},{key:"_createInstance",value:function(t,e){var i=void 0;switch(t){case"rect":i=new o.default.Rect(e);break;case"circle":i=new o.default.Ellipse((0,u.extend)({type:"circle"},e));break;case"triangle":i=new o.default.Triangle(e);break;default:i={}}return i}},{key:"_extendOptions",value:function(t){var e=c.default.fObjectOptions.SELECTION_STYLE;return(t=(0,u.extend)({},g,this._options,e,t)).isRegular&&(t.lockUniScaling=!0),t}},{key:"_bindEventOnShape",value:function(t){var n=this,r=this.getCanvas();t.on({added:function(){n._shapeObj=this,l.default.setOrigins(n._shapeObj)},selected:function(){n._isSelected=!0,n._shapeObj=this,r.uniScaleTransform=!0,r.defaultCursor="default",l.default.setOrigins(n._shapeObj)},deselected:function(){n._isSelected=!1,n._shapeObj=null,r.defaultCursor="crosshair",r.uniScaleTransform=!1},modified:function(){var t=n._shapeObj;l.default.adjustOriginToCenter(t),l.default.setOrigins(t)},scaling:function(t){var e=r.getPointer(t.e),i=n._shapeObj;r.setCursor("crosshair"),l.default.resize(i,e,!0)}})}},{key:"_onFabricMouseDown",value:function(t){if(t.target||(this._isSelected=!1,this._shapeObj=!1),!this._isSelected&&!this._shapeObj){var e=this.getCanvas();this._startPoint=e.getPointer(t.e),e.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}}},{key:"_onFabricMouseMove",value:function(t){var e=this,i=this.getCanvas(),n=i.getPointer(t.e),r=this._startPoint.x,o=this._startPoint.y,s=r-n.x,a=o-n.y,c=this._shapeObj;c?(this._shapeObj.set({isRegular:this._withShiftKey}),l.default.resize(c,n),i.renderAll()):this.add(this._type,{left:r,top:o,width:s,height:a}).then(function(t){e.fire(d.ADD_OBJECT,t)})}},{key:"_onFabricMouseUp",value:function(){var e=this,t=this.getCanvas(),i=this._startPoint.x,n=this._startPoint.y,r=this._shapeObj;r?r&&(l.default.adjustOriginToCenter(r),this.fire(d.ADD_OBJECT_AFTER,this.graphics.createObjectProperties(r))):this.add(this._type,{left:i,top:n,width:20,height:20}).then(function(t){e.fire(d.ADD_OBJECT,t)}),t.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(t){t.keyCode===p.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(t){t.keyCode===p.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}}]),b);function b(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,b);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c.default.componentNames.SHAPE,t));return e._shapeObj=null,e._type="rect",e._options=(0,u.extend)({},g),e._isSelected=!1,e._startPoint={},e._withShiftKey=!1,e._handlers={mousedown:e._onFabricMouseDown.bind(e),mousemove:e._onFabricMouseMove.bind(e),mouseup:e._onFabricMouseUp.bind(e),keydown:e._onKeyDown.bind(e),keyup:e._onKeyUp.bind(e)},e}t.exports=m},function(t,e){var h={rect:1,circle:2,triangle:1},f={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};function l(t,e,i){var n=t.x,r=t.y,o=e.x,s=e.y,a=i*Math.PI/180;return{originX:(o-n)*Math.cos(a)-(s-r)*Math.sin(a)+n<n?"right":"left",originY:(o-n)*Math.sin(a)+(s-r)*Math.cos(a)+r<r?"bottom":"top"}}t.exports={setOrigins:function(t){var e=t.getPointByOrigin("left","top"),i=t.getPointByOrigin("right","top"),n=t.getPointByOrigin("right","bottom"),r=t.getPointByOrigin("left","bottom");t.origins={lt:e,rt:i,rb:n,lb:r}},resize:function(t,e,i){!function(t){return"center"===t.getOriginX()&&"center"===t.getOriginY()}(t)||(function(t,e){var i=e.getPointByOrigin("center","center"),n=l(i,t,-e.getAngle()),r=n.originX,o=n.originY,s=e.getPointByOrigin(r,o),a=e.getLeft()-(i.x-s.x),c=e.getTop()-(i.x-s.y);e.set({originX:r,originY:o,left:a,top:c}),e.setCoords()}(e,t),function(t){var e=t.getOriginX(),i=t.getOriginY(),n=e.substring(0,1)+i.substring(0,1);t.startPoint=t.origins[n]}(t)),i?function(t){var e=t.type,i=t.scaleX,n=t.scaleY,r=f[e],o=t[r.w]*i,s=t[r.h]*n;if(t.isRegular){var a=Math.max(i,n);o=t[r.w]*a,s=t[r.h]*a}var c={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};c[r.w]=o,c[r.h]=s,t.set(c)}(t):function(t,e){var i=e.type,n=e.strokeWidth,r=e.startPoint,o=h[i],s=f[i],a=!("triangle"!==e.type),c={},l=Math.abs(r.x-t.x)/o,u=Math.abs(r.y-t.y)/o;n<l&&(l-=n/o),n<u&&(u-=n/o),e.isRegular&&(l=u=Math.max(l,u),a&&(u=Math.sqrt(3)/2*l)),c[s.w]=l,c[s.h]=u,e.set(c)}(e,t),function(t,e){var i=e.startPoint,n=l(i,t,-e.getAngle()),r=n.originX,o=n.originY;e.setPositionByOrigin(i,r,o)}(e,t)},adjustOriginToCenter:function(t){var e=t.getPointByOrigin("center","center"),i=t.getOriginX(),n=t.getOriginY(),r=t.getPointByOrigin(i,n),o=t.getLeft()+(e.x-r.x),s=t.getTop()+(e.y-r.y);t.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:o,top:s}),t.setCoords()}}},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(126)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.drawingModes,l=s.default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,o.default),n(h,[{key:"start",value:function(t){t.getComponent(l.CROPPER).start()}},{key:"end",value:function(t){t.getComponent(l.CROPPER).end()}}]),h);function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.CROPPER))}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o,s=i(71),a=(o=s)&&o.__esModule?o:{default:o};var c=a.default.create,l=a.default.types,u=(n(h,[{key:"getName",value:function(){return this.name}},{key:"start",value:function(){throw new Error(c(l.UN_IMPLEMENTATION,"start"))}},{key:"stop",value:function(){throw new Error(c(l.UN_IMPLEMENTATION,"stop"))}}]),h);function h(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),this.name=t}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(126)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.drawingModes,l=s.default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,o.default),n(h,[{key:"start",value:function(t,e){t.getComponent(l.FREE_DRAWING).start(e)}},{key:"end",value:function(t){t.getComponent(l.FREE_DRAWING).end()}}]),h);function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.FREE_DRAWING))}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(126)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.drawingModes,l=s.default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,o.default),n(h,[{key:"start",value:function(t,e){t.getComponent(l.LINE).start(e)}},{key:"end",value:function(t){t.getComponent(l.LINE).end()}}]),h);function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.LINE_DRAWING))}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(126)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.drawingModes,l=s.default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,o.default),n(h,[{key:"start",value:function(t){t.getComponent(l.SHAPE).start()}},{key:"end",value:function(t){t.getComponent(l.SHAPE).end()}}]),h);function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.SHAPE))}t.exports=u},function(t,e,i){var n=function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t};function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=a(i(126)),s=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=s.default.drawingModes,l=s.default.componentNames,u=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(h,o.default),n(h,[{key:"start",value:function(t){t.getComponent(l.TEXT).start()}},{key:"end",value:function(t){t.getComponent(l.TEXT).end()}}]),h);function h(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.TEXT))}t.exports=u},function(t,e){},,function(t,e,i){var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.ICON,u={name:c.ADD_ICON,execute:function(e,t,i){var n=this;return e.getComponent(l).add(t,i).then(function(t){return n.undoData.object=e.getObject(t.id),t})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(u),t.exports=u},function(t,e,i){var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.ADD_IMAGE_OBJECT,execute:function(e,t){var i=this;return e.addImageObject(t).then(function(t){return i.undoData.object=e.getObject(t.id),t})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.commandNames,c=o.default.rejectMessages,l={name:a.ADD_OBJECT,execute:function(i,n){return new r.default(function(t,e){i.contains(n)?e(c.addedObject):(i.add(n),t(n))})},undo:function(i,n){return new r.default(function(t,e){i.contains(n)?(i.remove(n),t(n)):e(c.noObject)})}};n.default.register(l),t.exports=l},function(t,e,i){var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.SHAPE,u={name:c.ADD_SHAPE,execute:function(e,t,i){var n=this;return e.getComponent(l).add(t,i).then(function(t){return n.undoData.object=e.getObject(t.id),t})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(u),t.exports=u},function(t,e,i){var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.componentNames,c=o.default.commandNames,l=a.TEXT,u={name:c.ADD_TEXT,execute:function(e,t,i){var n=this;return e.getComponent(l).add(t,i).then(function(t){return n.undoData.object=e.getObject(t.id),t})},undo:function(t){return t.remove(this.undoData.object),r.default.resolve()}};n.default.register(u),t.exports=u},function(t,e,i){var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.rejectMessages,c=r.default.commandNames,l=s.FILTER,u={name:c.APPLY_FILTER,execute:function(t,e,i){var n=t.getComponent(l);if("mask"===e){var r=t.getObject(i.maskObjId);if(!r||!r.isType("image"))return Promise.reject(a.invalidParameters);i={mask:r}}return"mask"===e?(this.undoData.object=i.mask,t.remove(i.mask)):this.undoData.options=n.getOptions(e),n.add(e,i)},undo:function(t,e){var i=t.getComponent(l);if("mask"!==e)return this.undoData.options?i.add(e,this.undoData.options):i.remove(e);var n=this.undoData.object;return t.add(n),t.setActiveObject(n),i.remove(e)}};n.default.register(u),t.exports=u},function(t,e,i){var n=o(i(69)),c=o(i(4)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,l=r.default.rejectMessages,a=r.default.commandNames,u=s.ICON,h={name:a.CHANGE_ICON_COLOR,execute:function(r,o,s){var a=this;return new c.default(function(t,e){var i=r.getComponent(u),n=r.getObject(o);n||e(l.noObject),a.undoData.object=n,a.undoData.color=i.getColor(n),i.setColor(s,n),t()})},undo:function(t){var e=t.getComponent(u),i=this.undoData.object,n=i.object,r=i.color;return e.setColor(r,n),c.default.resolve()}};n.default.register(h),t.exports=h},function(t,e,i){var s=o(i(3)),n=o(i(69)),a=o(i(4)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var c=r.default.componentNames,l=r.default.rejectMessages,u=r.default.commandNames,h=c.SHAPE,f={name:u.CHANGE_SHAPE,execute:function(t,e,i){var n=this,r=t.getComponent(h),o=t.getObject(e);return o?(this.undoData.object=o,this.undoData.options={},s.default.forEachOwnProperties(i,function(t,e){n.undoData.options[e]=o[e]}),r.change(o,i)):a.default.reject(l.noObject)},undo:function(t){var e=t.getComponent(h),i=this.undoData,n=i.object,r=i.options;return e.change(n,r)}};n.default.register(f),t.exports=f},function(t,e,i){var n=s(i(69)),o=s(i(4)),r=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=r.default.componentNames,c=r.default.rejectMessages,l=r.default.commandNames,u=a.TEXT,h={name:l.CHANGE_TEXT,execute:function(t,e,i){var n=t.getComponent(u),r=t.getObject(e);return r?(this.undoData.object=r,this.undoData.text=n.getText(r),n.change(r,i)):o.default.reject(c.noObject)},undo:function(t){var e=t.getComponent(u),i=this.undoData,n=i.object,r=i.text;return e.change(n,r)}};n.default.register(h),t.exports=h},function(t,e,i){var s=o(i(3)),n=o(i(69)),a=o(i(4)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var c=r.default.componentNames,l=r.default.rejectMessages,u=r.default.commandNames,h=c.TEXT,f={name:u.CHANGE_TEXT_STYLE,execute:function(t,e,i){var n=this,r=t.getComponent(h),o=t.getObject(e);return o?(this.undoData.object=o,this.undoData.styles={},s.default.forEachOwnProperties(i,function(t,e){n.undoData.styles[e]=o[e]}),r.setStyle(o,i)):a.default.reject(l.noObject)},undo:function(t){var e=t.getComponent(h),i=this.undoData,n=i.object,r=i.styles;return e.setStyle(n,r)}};n.default.register(f),t.exports=f},function(t,e,i){var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.CLEAR_OBJECTS,execute:function(e){var i=this;return new r.default(function(t){i.undoData.objects=e.removeAll(),t()})},undo:function(t){return t.add(this.undoData.objects),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.FLIP,l={name:a.FLIP_IMAGE,execute:function(t,e){var i=t.getComponent(c);return this.undoData.setting=i.getCurrentSetting(),i[e]()},undo:function(t){return t.getComponent(c).set(this.undoData.setting)}};n.default.register(l),t.exports=l},function(t,e,i){var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.IMAGE_LOADER,l={name:a.LOAD_IMAGE,execute:function(t,e,i){var n=t.getComponent(c),r=n.getCanvasImage(),o=r?r.width:0,s=r?r.height:0,a=t.removeAll(!0).filter(function(t){return"cropzone"!==t.type});return a.forEach(function(t){t.evented=!0}),this.undoData={name:n.getImageName(),image:r,objects:a},n.load(e,i).then(function(t){return{oldWidth:o,oldHeight:s,newWidth:t.width,newHeight:t.height}})},undo:function(t){var e=t.getComponent(c),i=this.undoData,n=i.objects,r=i.name,o=i.image;return t.removeAll(!0),t.add(n),e.load(r,o)}};n.default.register(l),t.exports=l},function(t,e,i){var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.FILTER,l={name:a.REMOVE_FILTER,execute:function(t,e){var i=t.getComponent(c);return this.undoData.options=i.getOptions(e),i.remove(e)},undo:function(t,e){var i=t.getComponent(c),n=this.undoData.options;return i.add(e,n)}};n.default.register(l),t.exports=l},function(t,e,i){var n=s(i(69)),o=s(i(4)),r=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=r.default.commandNames,c=r.default.rejectMessages,l={name:a.REMOVE_OBJECT,execute:function(i,n){var r=this;return new o.default(function(t,e){r.undoData.objects=i.removeObjectById(n),r.undoData.objects.length?t():e(c.noObject)})},undo:function(t){return t.add(this.undoData.objects),o.default.resolve()}};n.default.register(l),t.exports=l},function(t,e,i){var n=o(i(69)),r=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var s={name:o(i(73)).default.commandNames.RESIZE_CANVAS_DIMENSION,execute:function(e,i){var n=this;return new r.default(function(t){n.undoData.size={width:e.cssMaxWidth,height:e.cssMaxHeight},e.setCssMaxDimension(i),e.adjustCanvasDimension(),t()})},undo:function(t){return t.setCssMaxDimension(this.undoData.size),t.adjustCanvasDimension(),r.default.resolve()}};n.default.register(s),t.exports=s},function(t,e,i){var n=o(i(69)),r=o(i(73));function o(t){return t&&t.__esModule?t:{default:t}}var s=r.default.componentNames,a=r.default.commandNames,c=s.ROTATION,l={name:a.ROTATE_IMAGE,execute:function(t,e,i){var n=t.getComponent(c);return this.undoData.angle=n.getCurrentAngle(),n[e](i)},undo:function(t){var e=t.getComponent(c),i=this.undoData.angle;return e.setAngle(i)}};n.default.register(l),t.exports=l},function(t,e,i){var o=a(i(3)),n=a(i(69)),s=a(i(4)),r=a(i(73));function a(t){return t&&t.__esModule?t:{default:t}}var c=r.default.commandNames,l=r.default.rejectMessages,u={name:c.SET_OBJECT_PROPERTIES,execute:function(t,e,i){var n=this,r=t.getObject(e);return r?(this.undoData.props={},o.default.forEachOwnProperties(i,function(t,e){n.undoData.props[e]=r[e]}),t.setObjectProperties(e,i),s.default.resolve()):s.default.reject(l.noObject)},undo:function(t,e){var i=this.undoData.props;return t.setObjectProperties(e,i),s.default.resolve()}};n.default.register(u),t.exports=u},function(t,e,i){var n=s(i(69)),r=s(i(4)),o=s(i(73));function s(t){return t&&t.__esModule?t:{default:t}}var a=o.default.commandNames,c=o.default.rejectMessages,l={name:a.SET_OBJECT_POSITION,execute:function(t,e,i){return t.getObject(e)?(this.undoData.objectId=e,this.undoData.props=t.getObjectProperties(e,["left","top"]),t.setObjectPosition(e,i),t.renderAll(),r.default.resolve()):r.default.reject(c.noObject)},undo:function(t){var e=this.undoData,i=e.objectId,n=e.props;return t.setObjectProperties(i,n),t.renderAll(),r.default.resolve()}};n.default.register(l),t.exports=l}],o.c=a,o.p="dist",o(0);function o(t){if(a[t])return a[t].exports;var e=a[t]={exports:{},id:t,loaded:!1};return s[t].call(e.exports,e,e.exports,o),e.loaded=!0,e.exports}var s,a});